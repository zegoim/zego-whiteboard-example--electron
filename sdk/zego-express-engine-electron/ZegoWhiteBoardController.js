!function(e,t){for(var o in t)e[o]=t[o]}(exports,function(e){var t={};function o(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(i,r,function(t){return e[t]}.bind(null,r));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=20)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(25)),function(e){e[e.PPT=1]="PPT",e[e.DOC=2]="DOC",e[e.ELS=4]="ELS",e[e.PDF=8]="PDF",e[e.IMG=16]="IMG",e[e.TXT=32]="TXT",e[e.PPTH5=512]="PPTH5",e[e.CUSTOM_H5=4096]="CUSTOM_H5"}(t.FileType||(t.FileType={})),function(e){e[e.Single=1]="Single",e[e.Multi=2]="Multi",e[e.Other=4]="Other"}(t.ActionType||(t.ActionType={})),function(e){e[e.Append=1]="Append",e[e.Update=2]="Update",e[e.Delete=4]="Delete",e[e.Move=8]="Move",e[e.Create=32]="Create"}(t.Action||(t.Action={})),function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.UnReDo=2]="UnReDo",e[e.Reload=3]="Reload"}(t.GraphicOperateType||(t.GraphicOperateType={})),function(e){e[e.Pencil=1]="Pencil",e[e.Text=2]="Text",e[e.Line=4]="Line",e[e.Rect=8]="Rect",e[e.Ellipse=16]="Ellipse",e[e.Laser=128]="Laser",e[e.Image=256]="Image",e[e.BgImage=512]="BgImage",e[e.RealTime=999]="RealTime"}(t.GraphicType||(t.GraphicType={})),function(e){e[e.Pc=1]="Pc",e[e.Mobile=2]="Mobile"}(t.Platform||(t.Platform={})),function(e){e[e.Init=1]="Init",e[e.Down=2]="Down",e[e.Move=3]="Move",e[e.DownMove=4]="DownMove",e[e.DownMoveUp=5]="DownMoveUp",e[e.DownNoMoveUp=6]="DownNoMoveUp",e[e.Leave=7]="Leave",e[e.DownLeave=8]="DownLeave"}(t.DrawState||(t.DrawState={})),function(e){e[e.success=1]="success",e[e.error=2]="error"}(t.ResultType||(t.ResultType={})),function(e){e[e.InProgress=1]="InProgress",e[e.Pending=2]="Pending"}(t.TaskStatus||(t.TaskStatus={})),function(e){e[e.BatchSelete=0]="BatchSelete",e[e.ClearPage=1]="ClearPage",e[e.EraserTool=2]="EraserTool"}(t.DeleteGraphicAction||(t.DeleteGraphicAction={})),function(e){e[e.None=0]="None",e[e.Scale=1]="Scale",e[e.Scroll=2]="Scroll"}(t.ZegoWhiteboardViewAuth||(t.ZegoWhiteboardViewAuth={})),function(e){e[e.None=0]="None",e[e.Append=1]="Append",e[e.Update=2]="Update",e[e.Delete=4]="Delete",e[e.Move=8]="Move",e[e.Clear=16]="Clear",e[e.Create=32]="Create"}(t.ZegoWhiteboardViewGraphicAuth||(t.ZegoWhiteboardViewGraphicAuth={})),function(e){e.Error="error",e.ViewAdd="viewAdd",e.ViewRemoved="viewRemoved",e.ViewScroll="viewScroll",e.WhiteboardAuthChange="whiteboardAuthChange",e.WhiteboardGraphicAuthChange="whiteboardGraphicAuthChange"}(t.ZegoEventType||(t.ZegoEventType={})),function(e){e.PushAddMod="pushAddMod",e.PushRemovedMod="pushRemovedMod",e.PushDrawPageGraphics="pushDrawPageGraphics",e.PushClearPageGraphics="pushClearPageGraphics",e.PushScroll="pushScroll",e.PushScale="pushScale",e.PushH5ExtraAppended="pushH5ExtraAppended",e.PushAuthChange="pushAuthChange",e.GetPageGraphicsList="getPageGraphicsList",e.AppendH5Extra="appendH5Extra",e.Scroll="scroll",e.Scale="scale"}(t.ZegoServiceEventType||(t.ZegoServiceEventType={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r="ontouchstart"in window||navigator.maxTouchPoints>0;t.default={reservedPrefix:{whiteboardZoom:"zego-whiteboard-zoom",fileWhiteboardCon:"zego-docsview-con",whiteboardCon:"zego-whiteboard-con",whiteboard:"zego-whiteboard",laserContainer:"zego-other-container",graphicsBgContainer:"zego-graphics-bg-container",graphicsBgImageContainer:"zego-graphics-bgImage-container",graphicsContainer:"zego-graphics-container",graphicsSvg:"zego-svg",textareaCon:"zego-textarea",laserCon:"zego-laser",graphics:"zego-graphics",boxContainer:"zego-box-container",graphicsBox:"zego-graphics-box"},basicState:{type:i.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen,size:6,fontSize:24,color:"#f54326",bgColor:"rgb(241, 243, 244)",attributes:'{"bold": false, "italic": false, "stroke": false}'},basicExtraState:{drawSize:0,drawFontSize:0,customImage:{url:"",w:80,h:80},defaultFileBgColor:"rgb(255, 255, 255, 0)"},realTimeState:{localDrawCount:10,remoteDrawDelay:4,remoteDrawCount:2,remoteDrawEndDelay:1e4},scaleModes:{sync:!1,response:!1},handWritingFactor:{step:.016,max_speed:1.2,min_speed:.05,max_width_factor:1.2,min_width_factor:.5,last_size:0,lastX:0,lastY:0},svgPath:{tops:[],bottoms:[]},isTouch:r,boxPadding:0,textareaBoxPadding:24,textareaHPadding:6,textareaVPadding:0,textareaConBorderWidth:1,lineHeight:1.5,boxBorderWidth:2,selectedBorderCss:"2px solid #b0b3b8",unSelectedBorderCss:"2px solid transparent",maxlength:200,scrollbarSize:20,initLaserX:0,initLaserY:0,hiddenLaserX:-100,hiddenLaserY:-100,hiddenLaserDelay:5e3,mouseEvents:{down:"mousedown",move:"mousemove",up:"mouseup",leave:"mouseleave",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend",mouseleave:"touchcancel"},calStandard:{sizeWidth:1280,placeWidth:128e4,minFontSize:r?1:12,maxFontSize:100,minLineWidth:1,maxLineWidth:100}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(40),r=o(1),a=o(0),n=o(27),s=o(28);t.createGraphicId=function(){return""+s(i.v4())};t.createZorderStep=function(){var e=Math.sqrt(Math.sqrt(+s(i.v4())))*Math.random()|0;return e>99?.3*e|0:e<3?e+10*Math.random()|0:e};t.removeElement=function(e){if(e){var t=e.parentNode;t?t.removeChild(e):e.remove?e.remove():e.removeNode()}};t.getElementChild=function(e){return e.children||e.childNodes};t.calSizeHandle=function(e,t,o,i){var n,s=r.default.calStandard,d=s.sizeWidth,h=s.minFontSize,c=s.minLineWidth;return i?n=Math.round(e*d/o):(n=Math.round(o*e/d),a.GraphicType.Text===t?n<h&&(n=h):n<c&&(n=c)),n};var d=function(e){var t=e[0],o=e[1],i=e[2],r=e[3];return[Math.min(t,i||t),Math.min(o,r||o)]};t.mapGraphicsData=function(e,t){var o;switch(e){case a.GraphicType.Pencil:o=function(e){for(var t=e.length,o=.1,i=t-4,r="M"+e[0]+", "+e[1],a=0;a<t-2;a+=2){var n=a?e[a-2]:e[0],s=a?e[a-1]:e[1],d=e[a+0],h=e[a+1],c=e[a+2],l=e[a+3],p=a!==i?e[a+4]:c,u=a!==i?e[a+5]:l;r+=" C"+(Number(d)+(c-n)/6*o)+","+(Number(h)+(l-s)/6*o)+","+(Number(c)-(p-d)/6*o)+","+(Number(l)-(u-h)/6*o)+","+c+","+l}return r}(t);break;case a.GraphicType.Line:o={x1:t[0],y1:t[1],x2:t[2]||t[0],y2:t[3]||t[1]};break;case a.GraphicType.Rect:var i=Math.abs((t[2]||t[0])-t[0])||1,r=Math.abs((t[3]||t[1])-t[1])||1,n=d(t);o={x:n[0],y:n[1],width:i,height:r};break;case a.GraphicType.Ellipse:var s=Math.abs((t[2]||t[0])-t[0])/2||.5,h=Math.abs((t[3]||t[1])-t[1])/2||.5,c=d(t);o={cx:c[0]+s,cy:c[1]+h,rx:s,ry:h};break;default:o=""}return o};t.mapHandWritingGraphicsData=function(e,t,o){var i=r.default.handWritingFactor,a=i.step,n=i.max_width_factor,s=i.min_width_factor,d=i.max_speed,h=i.min_speed,c=r.default.handWritingFactor,l=c.lastX,p=c.lastY,u=e.data,g=u.length,f=!0;r.default.svgPath.tops=[],r.default.svgPath.bottoms=[];for(var v={tx1:0,ty1:0,tx2:0,ty2:0,bx1:0,by1:0,bx2:0,by2:0,mtx1:0,mty1:0,mbx1:0,mby1:0},m=2;m<g;m+=2){2===m&&(l=u[0],p=u[1]);var b=l,y=p,w=u[m]-b,x=u[m+1]-y,I=Math.sqrt(Math.pow(w,2)+Math.pow(x,2));if(!(I<o/1280*3*2.5)){var E=I*a;E>d&&(E=d),E<h&&(E=h);var T=n*t,S=s*t,W=(T-S)*(1-E/d)+S;W>T&&(W=T),W<S&&(W=S);var H,C;if(H=W/2*x/I,C=W/2*w/I,v.tx1=l+H,v.ty1=p-C,v.tx2=u[m]+H,v.ty2=u[m+1]-C,v.bx1=l-H,v.by1=p+C,v.bx2=u[m]-H,v.by2=u[m+1]+C,f&&(v.tx1=l,v.ty1=p,v.bx1=l,v.by1=p),v.mtx1=(v.tx1+v.tx2)/2,v.mty1=(v.ty1+v.ty2)/2,v.mbx1=(v.bx1+v.bx2)/2,v.mby1=(v.by1+v.by2)/2,f)r.default.svgPath.tops.push("M"+l+" "+p+" L"+v.mtx1+" "+v.mty1),r.default.svgPath.bottoms.unshift("Q"+v.bx2+" "+v.by2+" "+v.mbx1+" "+v.mby1+" L"+l+" "+p);else if(r.default.svgPath.tops.join("").indexOf("M")<0&&r.default.svgPath.tops.push("M"+v.mtx1+" "+v.mty1),m===g-2){var L=u[g-2],_=u[g-1];E===h?r.default.svgPath.tops.push("Q"+L+" "+_+" "+L+" "+_):r.default.svgPath.tops.push("Q"+v.tx1+" "+v.ty1+" "+L+" "+_)}else r.default.svgPath.tops.push("Q"+v.tx1+" "+v.ty1+" "+v.mtx1+" "+v.mty1),r.default.svgPath.bottoms.unshift("Q"+v.bx2+" "+v.by2+" "+v.mbx1+" "+v.mby1);l=u[m],p=u[m+1],f=!1}}return r.default.svgPath.tops.concat(r.default.svgPath.bottoms).join(" ")};t.setAttributeHandle=function(e,t){t.forEach((function(t){e.setAttribute(t.attr,t.value)}))};t.createSvgElementHandle=function(e,t,o,i){var r,a=document.querySelector("#"+e);if(a)return i&&a.setAttribute("data-z",i+""),[r=a.querySelector("#"+t)];a=document.createElementNS("http://www.w3.org/2000/svg","svg");var n=document.createElementNS("http://www.w3.org/2000/svg","g");return r=document.createElementNS("http://www.w3.org/2000/svg",o),a.id=e,a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("version","1.1"),i&&a.setAttribute("data-z",i+""),r.id=t,n.appendChild(r),a.appendChild(n),[r,a]};t.simplifyPathData=function(e,t){void 0===t&&(t=1);var o=[],i=[];return e.forEach((function(e,t,o){t%2==0&&i.push({x:e,y:o[t+1]})})),n(i,t).forEach((function(e){o=o.concat([e.x,e.y])})),o};t.splitTextHandle=function(e){var t=e.split(",");return{beginX:t[0],beginY:t[1],text:t.slice(2).join(",")}};t.addTextBeginPlace=function(e,t,o){return parseInt(t)+","+parseInt(o)+","+e};t.bindStopsEvents=function(e,t){t.forEach((function(t){e.addEventListener(t,(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}))}))};t.checkColor=function(e){return/^#[0-9a-fA-F]{6}|rgba?\(*.+\d\)$/.test(e)};t.checkBrushSize=function(e){return/^([1-9]|[1-9]\d|100)$/.test(""+e)&&"number"==typeof e};t.checkTextSize=function(e){return/^([1-9]|[1-9]\d|100)$/.test(""+e)&&"number"==typeof e};t.getOffsetData=function(e){var t=0,o=0;if(e)for(t+=e.offsetTop,o+=e.offsetLeft;e.offsetParent;)t+=e.offsetParent.offsetTop,o+=e.offsetParent.offsetLeft,e=e.offsetParent;return{offsetTop:t,offsetLeft:o}};t.getScrollData=function(e){var t=0,o=0;if(e)for(t+=e.scrollTop,o+=e.scrollLeft;e.parentNode;)t+=e.parentNode.scrollTop||0,o+=e.parentNode.scrollLeft||0,e=e.parentNode;return{scrollTop:t,scrollLeft:o}};t.transGraphicsData=function(e,t){var o=e.length>1?a.ActionType.Multi:a.ActionType.Single,i=JSON.parse(JSON.stringify(e));return i.forEach((function(e){e.action_type=o,t&&(e.action=t),delete e.selected,delete e.fontSize,delete e.bgColor})),i};t.transColor=function(e,t){return t?e?"#"+(e=e.toString(16)).slice(2).padStart(6,"0"):r.default.basicState.color:(e=function(e){if(0===e.indexOf("#"))return e;var t=e.replace(/rgba?/,"").replace(/\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),o=parseFloat(t[3]||"1"),i=Math.floor(o*parseInt(t[0])+255*(1-o)),r=Math.floor(o*parseInt(t[1])+255*(1-o)),a=Math.floor(o*parseInt(t[2])+255*(1-o));return"#"+("0"+i.toString(16)).slice(-2)+("0"+r.toString(16)).slice(-2)+("0"+a.toString(16)).slice(-2)}(e),parseInt("0xFF"+e.split("#")[1]))};t.isNumber=function(e){return"number"==typeof e&&!isNaN(e)};t.transBezierBypointList=function(e){for(var t=e.length,o=.1,i=t-4,r=[e[0],e[1]],a=[],n=0;n<t-2;n+=2){var s=n?e[n-2]:e[0],d=n?e[n-1]:e[1],h=e[n+0],c=e[n+1],l=e[n+2],p=e[n+3],u=n!==i?e[n+4]:l,g=n!==i?e[n+5]:p,f=Number(h)+(l-s)/6*o,v=Number(c)+(p-d)/6*o,m=Number(l)-(u-h)/6*o,b=Number(p)-(g-c)/6*o;a.push([f,v,m,b,l,p])}return{moveTo:r,path:a}};t.isFloatGraphic=function(e){var t=e.type,o=e.attributes;return(t==a.GraphicType.Pencil||t==a.GraphicType.RealTime)&&JSON.parse(o||r.default.basicState.attributes).stroke}},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.appid="",this.roomid="",this.userid="",this.token="",this.isTestEnv=!0,this.version="",this.platform="",this.extra={},this.isProd=!1,this.isElectron=!1,this.logLevel=1,this.logCacheSend=[],this.logCacheMax=100,this.platform=e||"",this.isElectron=t,this.openLogServer()}return e.prototype.init=function(e){var t=e.appid,o=e.isTestEnv,i=e.version,r=e.isProd,a=e.liveroom;this.appid=(t||this.appid)+"",this.isTestEnv=o,this.version=i||this.version,this.isProd=r,a&&!this.platform.includes("liveroom")&&(this.platform+=",liveroom")},e.prototype.initRoom=function(e){var t=e.roomid,o=e.userid,i=e.token,r=e.logLevel;this.roomid=t||this.roomid,this.userid=o||this.userid,this.token=i||this.token,"number"==typeof r&&(this.logLevel=r)},e.prototype.setExtraConfig=function(e){Object.assign(this.extra,e)},e.prototype.getConfig=function(){return{appid:+this.appid,roomid:this.roomid,userid:this.userid,token:this.token,isTestEnv:this.isTestEnv}},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.log(0,e);if(this.logLevel>0);else{var i=console.debug;i(o)}},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.log(1,e);if(this.logLevel>1);else{var i=console.info;i(o)}},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.log(2,e);if(this.logLevel>2);else{var i=console.warn;i(o)}},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.log(3,e);if(this.logLevel>3);else{var i=console.error;i(o)}},e.prototype.writeLocalLog=function(e){},e.prototype.log=function(e,t){var o=this.isProd||this.isElectron?this.logParamList(e,t.join("")):t.join("");return this.isProd&&this.remoteWebSocketLog(e,o),this.isElectron&&this.writeLocalLog(o),o},e.prototype.openLogServer=function(){this.stopWebSocketServer(),this.websocket=new WebSocket("wss://weblogger-edu.zego.im/log")},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.close(),this.websocket=null)},e.prototype.remoteWebSocketLog=function(e,t){if(!("string"==typeof t&&t.length>4e3))if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState)this.openLogServer(),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var o="",i=0;i<this.logCacheSend.length;i++)(o+this.logCacheSend[i]).length>4e3&&(this.websocket.send(o),o=""),o=o+this.logCacheSend[i]+"\n";t=o+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.logParamList=function(e,t){var o=(new Date).toLocaleString(),r=t.indexOf(" "),a=t.substr(0,r)||t,n=t.substr(r+1,4500),s=i(i({time:o,level:e,action:a,content:n,appid:this.appid,userid:this.userid,roomid:this.roomid},this.extra),{version:this.version,platform:this.platform});return JSON.stringify(s)},e}(),a=function(e,t,o){var i=!(!e||!e.versions.electron);return{electron:i,platform:(i?e.platform:t)+","+o[o.length-2]+","+o[o.length-1]}}(window.process,navigator.platform,navigator.userAgent.split(" ")),n=a.electron,s=a.platform,d=n?"ec.":"web.";t.getLogAction=function(e,t){return""+d+e+t+" "},t.Logger=window.zegoLogger||(window.zegoLogger=new r(s,n))},function(e,t,o){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),a=((i={})[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal]="内部错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid]="参数错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkTimeout]="网络超时",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkDisconnect]="网络断开",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp]="网络回包错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorRequestTooMany]="请求过于频繁",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoLoginRoom]="未登录房间",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUserNotExist]="用户不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist]="白板view不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail]="创建白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewModifyFail]="修改白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNameLimit]="白板view名称或者content过长",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewParentNotExist]="白板view的parent不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNumLimit]="超过图元最大数量限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNotExist]="图元不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicCreateFail]="创建图元错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail]="修改图元错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicUnableDraw]="未开启绘制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit]="图元数据大小超过限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNumLimit]="超过图元最大数量限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicTextLimit]="文本字数超过上限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit]="图片图元大小超限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport]="不支持的图片类型",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl]="无效图片地址",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInitFail]="初始化失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGetListFail]="拉取白板view列表失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorCreateFail]="创建白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorDestroyFail]="销毁白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorAttachFail]="attach白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorClearFail]="清空白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorScrollFail]="滚动白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUndoFail]="撤销操作失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorRedoFail]="重做操作失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorLogFolderNotAccess]="日志目录无法创建或写入",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorCacheFolderNotAccess]="缓目录径无法创建或写入",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthScale]="无白板缩放权限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthScroll]="无白板滚动权限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic]="无图元创建权限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthUpdateGraphic]="无图元编辑权限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthMoveGraphic]="无图元移动权限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthDeleteGraphic]="无图元删除权限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthClearGraphic]="无白板清空权限",i),n={1003:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoLoginRoom,1014:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUserNotExist,1101:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist,1102:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail,1104:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewModifyFail,1114:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNumLimit,1201:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,1202:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,1212:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicCreateFail,1217:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,1219:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,1222:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,1223:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNumLimit,60003001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp,10001e3:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal,10001001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,110000001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl,110000003:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport,110000004:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit,110000005:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl,110000007:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorLogFolderNotAccess,110000008:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorCacheFolderNotAccess,110000009:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNameLimit,111001001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkDisconnect,111001002:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkTimeout,111101001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorRequestTooMany,112001003:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoLoginRoom,112001014:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUserNotExist,112001101:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist,112001102:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail,112001104:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewModifyFail,112001114:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNumLimit,112001201:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,112001202:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,112001212:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicCreateFail,112001217:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,112001219:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,112001222:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,112001223:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNumLimit};t.transError=function(e,t,o){return{code:e=n[e]||e,msg:t=a[e]&&o&&t?t:a[e]||t||a[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal]}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Docs="zegoeventdocs",e.Whiteboard="zegoeventwb"}(t.DomEvent||(t.DomEvent={})),function(e){e.WbInit="wbinit",e.WbDragTool="wbdragtool",e.WbScale="wbscale",e.WbDestroy="wbdestroy",e.WbError="wberror",e.Snapshot="snapshot",e.Page="page",e.Step="step",e.SyncDrag="syncDrag",e.Animation="targetclick",e.H5Snapshot="getH5SnapshotResult",e.DocsAspect="getAspectCache",e.ReloadView="reloadview"}(t.DomEventAction||(t.DomEventAction={}))},,function(e,t){!function(){if(-1!==window.navigator.userAgent.indexOf("Trident")){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}e.prototype=window.Event.prototype,window.CustomEvent=e,document.body.scrollTo||(Element.prototype.scrollTo=function(e,t){this.scrollLeft=e,this.scrollTop=t}),document.body.scrollBy||(Element.prototype.scrollBy=function(e,t){this.scrollLeft+=e,this.scrollTop+=t}),FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t=this,o=new FileReader;o.onload=function(e){for(var i="",r=new Uint8Array(o.result),a=r.byteLength,n=0;n<a;n++)i+=String.fromCharCode(r[n]);t.content=i,t.result=i,t.onload()},o.readAsArrayBuffer(e)})}}()},function(e,t,o){"use strict";var i,r=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},a=function(){var e={};return function(t){if(void 0===e[t]){var o=document.querySelector(t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}e[t]=o}return e[t]}}(),n=[];function s(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function d(e,t){for(var o={},i=[],r=0;r<e.length;r++){var a=e[r],d=t.base?a[0]+t.base:a[0],h=o[d]||0,c="".concat(d," ").concat(h);o[d]=h+1;var l=s(c),p={css:a[1],media:a[2],sourceMap:a[3]};-1!==l?(n[l].references++,n[l].updater(p)):n.push({identifier:c,updater:v(p,t),references:1}),i.push(c)}return i}function h(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var r=o.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var n=a(e.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(t)}return t}var c,l=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function p(e,t,o,i){var r=o?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=l(t,r);else{var a=document.createTextNode(r),n=e.childNodes;n[t]&&e.removeChild(n[t]),n.length?e.insertBefore(a,n[t]):e.appendChild(a)}}function u(e,t,o){var i=o.css,r=o.media,a=o.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var g=null,f=0;function v(e,t){var o,i,r;if(t.singleton){var a=f++;o=g||(g=h(t)),i=p.bind(null,o,a,!1),r=p.bind(null,o,a,!0)}else o=h(t),i=u.bind(null,o,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(o)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var o=d(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<o.length;i++){var r=s(o[i]);n[r].references--}for(var a=d(e,t),h=0;h<o.length;h++){var c=s(o[h]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}o=a}}}},function(e,t,o){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var o=function(e,t){var o=e[1]||"",i=e[3];if(!i)return o;if(t&&"function"==typeof btoa){var r=(n=i,s=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),d="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(d," */")),a=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[o].concat(a).concat([r]).join("\n")}var n,s,d;return[o].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(o,"}"):o})).join("")},t.i=function(e,o,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var a=0;a<this.length;a++){var n=this[a][0];null!=n&&(r[n]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);i&&r[d[0]]||(o&&(d[2]?d[2]="".concat(o," and ").concat(d[2]):d[2]=o),t.push(d))}},t}},,,,,,,,,,,function(e,t,o){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0});var a=o(21),n=o(37),s=o(39),d=o(3),h=function(e){function t(t){var o;d.Logger.init({appid:0,isTestEnv:!1,isProd:!0,version:"2.15.0",liveroom:!!t.loginRoom});var i=new n.ZegoWhiteboardService(new s.ZegoAdapter(t));return o=e.call(this,i)||this,i.onRemotePush(),o}return r(t,e),t.prototype.getVersion=function(){return"2.15.0"},t}(a.ZegoWhiteboardManager);t.default=h},function(e,t,o){"use strict";var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,a){function n(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var o,i,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e],i=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),o(22),o(7);var a=o(24),n=o(1),s=o(0),d=o(4),h=o(3),c=h.getLogAction.bind(null,"wb.m."),l=function(){function e(e){this.modIdMapInstance={},this.fileInfoMap={},this.signallingDelay=0,this.serviceHandle=e,this.registerLoadfileListener(),this.registerPushCallbackHandle(),this.registerPullCallbackHandle()}return e.prototype.registerLoadfileListener=function(){var e=this;document.body.addEventListener("loadfile",(function(t){var o=t.detail.fileID;e.fileInfoMap[o]=t.detail,h.Logger.info(c("update_file_info"),JSON.stringify({fileID:o,detail:t.detail}))}))},e.prototype.registerPushCallbackHandle=function(){var e=this;this.serviceHandle.bindListener(s.ZegoServiceEventType.PushClearPageGraphics,(function(t,o){e.signallingDelay?setTimeout((function(){e.clearGraphicsPushCallback(t,o)}),e.signallingDelay):e.clearGraphicsPushCallback(t,o)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushDrawPageGraphics,(function(t,o,i){e.signallingDelay?setTimeout((function(){e.drawGraphicsPushCallback(t,o,i)}),e.signallingDelay):e.drawGraphicsPushCallback(t,o,i)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushAddMod,(function(t){e.signallingDelay?setTimeout((function(){e.addModPushCallback(t)}),e.signallingDelay):e.addModPushCallback(t)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushRemovedMod,(function(t){e.signallingDelay?setTimeout((function(){e.removedModPushCallback(t)}),e.signallingDelay):e.removedModPushCallback(t)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushScroll,(function(t,o,i,r){e.signallingDelay?setTimeout((function(){e.scrollPushCallback(t,o,i,r)}),e.signallingDelay):e.scrollPushCallback(t,o,i,r)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushScale,(function(t,o,i,r){e.signallingDelay?setTimeout((function(){e.scalePushCallback(t,o,i,r)}),e.signallingDelay):e.scalePushCallback(t,o,i,r)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushH5ExtraAppended,(function(t,o){e.signallingDelay?setTimeout((function(){e.h5ExtraAppendedPushCallback(t,o)}),e.signallingDelay):e.h5ExtraAppendedPushCallback(t,o)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.PushAuthChange,(function(t,o){e.onPushAuthChange(t,o)}))},e.prototype.registerPullCallbackHandle=function(){var e=this;this.serviceHandle.bindListener(s.ZegoServiceEventType.GetPageGraphicsList,(function(t,o,i){var r=e.getMapInstance(t);r&&r.updateRemoteToLocal(o,i)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.AppendH5Extra,(function(t){var o=t.whiteboardID,i=t.code,r=t.msg,a=t.modExtra,n=t.isH5;0!==i&&(i===s.ZegoWhiteboardError.ZegoWhiteboardViewErrorAnimationInfoLimit?e.serviceHandle.actionCustomListener(s.ZegoEventType.Error,{code:i,msg:r}):n?e.h5ExtraAppendedPushCallback(o,a):e.serviceHandle.actionCustomListener(s.ZegoEventType.Error,{code:i,msg:r}))})),this.serviceHandle.bindListener(s.ZegoServiceEventType.Scroll,(function(t){var o=t.whiteboardID,i=t.code,r=t.horizontalPercent,a=t.verticalPercent,n=t.step;0!==i&&e.scrollPushCallback(o,r,a,n)})),this.serviceHandle.bindListener(s.ZegoServiceEventType.Scale,(function(t){var o=t.whiteboardID,i=t.code,r=t.mod_scale;0!==i&&e.scalePushCallback(o,r.scale,r.ofs_x,r.ofs_y)}))},e.prototype.addModPushCallback=function(e){var t=this.getMapInstance(e);t||(h.Logger.info(c("mod.remote_add"),JSON.stringify({whiteboardID:e})),t=new a.ZegoWhiteboardViewImpl(e,this.serviceHandle),this.setMapInstance(t)),this.serviceHandle.actionCustomListener(s.ZegoEventType.ViewAdd,t)},e.prototype.removedModPushCallback=function(e){var t=this.getMapInstance(e);t&&(h.Logger.info(c("mod.remote_removed"),JSON.stringify({whiteboardID:e})),t.destroyDomHandle(),t=null,this.deleteMapInstance(e),this.serviceHandle.actionCustomListener(s.ZegoEventType.ViewRemoved,e))},e.prototype.scrollPushCallback=function(e,t,o,i){var r=this.getMapInstance(e);r&&(h.Logger.warn(c("mod.remote_scroll"),"whiteboardID="+e+",hPercent="+t+",vPercent="+o+",step="+i),r.scrollToHandle(t,o,i,!1))},e.prototype.scalePushCallback=function(e,t,o,i){var r=this.getMapInstance(e);r&&(h.Logger.warn(c("mod.remote_scale"),"whiteboardID="+e+",scale="+t+",ofsX="+o+",ofsY="+i),n.default.scaleModes.response&&r.scaleToHandle(t,o,i,!1))},e.prototype.h5ExtraAppendedPushCallback=function(e,t){var o=this.getMapInstance(e);o&&(h.Logger.warn(c("mod.remote_extra"),"whiteboardID="+e+",modExtra="+t),o.playAnimation(t,!0))},e.prototype.clearGraphicsPushCallback=function(e,t){var o=this.getMapInstance(e);o&&o.clearLocalHandle(t)},e.prototype.drawGraphicsPushCallback=function(e,t,o){var i=this.getMapInstance(e);i&&i.updateRemoteToLocal(t,o)},e.prototype.onPushAuthChange=function(e,t){t&&this.serviceHandle.actionCustomListener(s.ZegoEventType.WhiteboardGraphicAuthChange,t),e&&(this.serviceHandle.actionCustomListener(s.ZegoEventType.WhiteboardAuthChange,e),e&&Object.values(this.modIdMapInstance).forEach((function(e){return e&&e.onAuthChange()})))},e.prototype.setFileInfo=function(e){var t;if(e.fileInfo){var o=e.fileInfo,i=o.fileID,r=o.fileName,a=this.fileInfoMap[i];(a=a&&a[r])&&(e.aspectWidth=a.width,e.aspectHeight=a.height,e.pageCount=a.pageCount,h.Logger.info(c("update_file_info"),JSON.stringify({fileID:i,detail:(t={fileID:i},t[r]=a,t)})))}},e.prototype.deleteMapInstance=function(e){delete this.modIdMapInstance[e]},e.prototype.getMapInstance=function(e){return this.modIdMapInstance[e]},e.prototype.setMapInstance=function(e){this.modIdMapInstance[e.getID()]=e},e.prototype.setActivitedView=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t.setActivited(t.getID()==e)}))},e.prototype.getActivitedView=function(){return Object.values(this.modIdMapInstance).find((function(e){return e.getActivited()}))},e.prototype.checkAttachingParent=function(e){return!!document.getElementById(e)},e.prototype.checkCreatingView=function(e){return!(!e||!e.roomID||!e.name||isNaN(+e.aspectWidth)||!+e.aspectWidth||isNaN(+e.aspectHeight)||!+e.aspectHeight||isNaN(+e.pageCount)||!+e.pageCount)},e.prototype.setViewSize=function(e){var t=this.getMapInstance(e);if(t){var o=t.getContentSize(),i=o.width,r=o.height;this.serviceHandle.setSize(e,i,r)}},e.prototype.createErrorStr=function(e){return void 0!==e.code?JSON.stringify(e):""+e},e.prototype.setDeferredRenderingTime=function(e){this.signallingDelay=e||0},e.prototype.clear=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t&&t.clearLaserHandle(e)})),h.Logger.info(c("clear"))},e.prototype.getViewList=function(){return i(this,void 0,void 0,(function(){var e,t,o=this;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.serviceHandle.getModList()];case 1:return e=i.sent(),Object.keys(this.modIdMapInstance).forEach((function(t){-1===e.indexOf(t)&&o.deleteMapInstance(t)})),e.forEach((function(e){o.modIdMapInstance[e]||o.setMapInstance(new a.ZegoWhiteboardViewImpl(e,o.serviceHandle)),o.setViewSize(e)})),h.Logger.info(c("getViewList"),JSON.stringify(Object.keys(this.modIdMapInstance))),[2,Object.values(this.modIdMapInstance).sort((function(e,t){return o.serviceHandle.getCreateTime(t.getID())-o.serviceHandle.getCreateTime(e.getID())}))];case 2:return t=i.sent(),h.Logger.error(c("getViewList"),this.createErrorStr(t)),[2,Promise.reject(void 0!==t.code?t:d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorGetListFail))];case 3:return[2]}}))}))},e.prototype.createView=function(e){var t=this;return new Promise((function(o,n){return i(t,void 0,void 0,(function(){var t,i,l,p;return r(this,(function(r){switch(r.label){case 0:if(!this.checkCreatingView(e))return t=d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误：roomID、name为字符串，aspectWidth、aspectHeight、pageCount为正整数",!0),h.Logger.error(c("createView"),JSON.stringify(t)),n(t),[2];this.setFileInfo(e),h.Logger.info(c("createView"),JSON.stringify(e)),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.serviceHandle.createMod(e)];case 2:return i=r.sent(),(l=this.getMapInstance(i))||(l=new a.ZegoWhiteboardViewImpl(i,this.serviceHandle),this.setMapInstance(l),h.Logger.info(c("createView"),"success")),o(l),[3,4];case 3:return p=r.sent(),h.Logger.error(c("createView"),this.createErrorStr(p)),n(void 0!==p.code?p:d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail)),[3,4];case 4:return[2]}}))}))}))},e.prototype.destroyView=function(e){var t=this;return new Promise((function(o,a){return i(t,void 0,void 0,(function(){var t,i,n;return r(this,(function(r){switch(r.label){case 0:if(!e||!e.getID)return t=d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist),h.Logger.error(c("destroyView"),JSON.stringify({whiteboardView:e,errorData:t})),a(t),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),i=e.getID(),[4,this.serviceHandle.destroyMod(i)];case 2:return r.sent(),this.deleteMapInstance(i),e.destroyDomHandle(),e=null,h.Logger.info(c("destroyView"),"success"),o(),[3,4];case 3:return n=r.sent(),h.Logger.error(c("destroyView"),this.createErrorStr(n)),a(void 0!==n.code?n:d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorDestroyFail)),[3,4];case 4:return[2]}}))}))}))},e.prototype.attachView=function(e,t){var o=this;return new Promise((function(i,r){if(!o.checkAttachingParent(t)){var a=d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewParentNotExist);return h.Logger.error(c("attachView"),JSON.stringify({parent:t,errorData:a})),void r(a)}if(!e||!e.getID){a=d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist);return h.Logger.error(c("attachView"),JSON.stringify({whiteboardView:e,errorData:a})),void r(a)}h.Logger.info(c("attachView"),JSON.stringify({whiteboardID:e.getID(),parent:t}));try{var n=e;n.init(t),o.setMapInstance(n),o.setActivitedView(n.getID()),h.Logger.info(c("attachView"),"success"),i()}catch(e){h.Logger.error(c("attachView"),o.createErrorStr(e)),r(d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorAttachFail))}}))},e.prototype.enableSyncScale=function(e){n.default.scaleModes.sync=!!e;var t=e&&this.getActivitedView();t&&t.syncScaleToHandle()},e.prototype.enableResponseScale=function(e){n.default.scaleModes.response=!!e;var t=e&&this.getActivitedView();if(t){var o=this.serviceHandle.getScale(t.getID()),i=o.scaleFactor,r=o.scaleOffsetX,a=o.scaleOffsetY;t.scaleToHandle(i,r,a,!1)}},e.prototype.enableHandwriting=function(e){if("boolean"==typeof e){var t=n.default.basicState.attributes,o=JSON.parse(t);o.stroke=!!e,n.default.basicState.attributes=JSON.stringify(o),this.serviceHandle.enableHandwriting(o.stroke)}else{var i=d.transError(s.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误",!0);h.Logger.error(c("enableHandwriting"),JSON.stringify(i))}},e.prototype.on=function(e,t){return h.Logger.info(c("on"),JSON.stringify({event:e})),this.serviceHandle.bindCustomListener(e,t)},e.prototype.off=function(e,t){return h.Logger.info(c("off"),JSON.stringify({event:e})),this.serviceHandle.deleteCustomListener(e,t)},e}();t.ZegoWhiteboardManager=l},function(e,t,o){var i=o(8),r=o(23);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};i(r,a);e.exports=r.locals||{}},function(e,t,o){(t=o(9)(!1)).push([e.i,"#zego-whiteboard-input {\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    padding: 0px;\n    border: none;\n}\n\n[id^='zego-whiteboard-zoom'] {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n\n[id^='zego-whiteboard-con'],\n[id^='zego-whiteboard-con'] > div {\n    transform-origin: 0 0;\n}\n\n[id^='zego-whiteboard'] {\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n    position: absolute;\n}\n[id^='zego-whiteboard'] *,\n[id^='zego-whiteboard'] ::after,\n[id^='zego-whiteboard'] ::before {\n    box-sizing: border-box !important;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-bg-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    display: flex;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-bgImage-container'] {\n    flex: 1;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: hidden;\n}\n\n[id^='zego-graphics-container'] [id^='zego-laser'] {\n    transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear;\n    -moz-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Firefox 4 */\n    -webkit-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Safari 和 Chrome */\n    -o-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear; /* Opera */\n    -ms-transition: transform 0.2s linear, left 0.2s linear, right 0.2s linear;\n    margin-left: -8px;\n    margin-top: -8px;\n}\n\n/* [id^='zego-graphics-container'] path.transition {\n    transition: transform 0.2s linear;\n    -moz-transition: transform 0.2s linear;\n    -webkit-transition: transform 0.2s linear;\n    -o-transition: transform 0.2s linear;\n    -ms-transition: transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] line.transition {\n    transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -moz-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -webkit-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -o-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n    -ms-transition: x1 0.2s linear, y1 0.2s linear, x2 0.2s linear, y2 0.2s linear, transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] rect.transition {\n    transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -moz-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -webkit-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -o-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n    -ms-transition: x 0.2s linear, y 0.2s linear, width 0.2s linear, height 0.2s linear, transform 0.2s linear;\n}\n\n[id^='zego-graphics-container'] ellipse.transition {\n    transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -moz-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -webkit-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -o-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n    -ms-transition: cx 0.2s linear, cy 0.2s linear, rx 0.2s linear, ry 0.2s linear, transform 0.2s linear;\n} */\n\n[id^='zego-whiteboard'] [id^='zego-box-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] svg {\n    transform-origin: 0px 0px 0px;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    margin: 0px;\n    padding: 0px;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n}\n[id^='zego-whiteboard'] textarea {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    border: none;\n    outline: none;\n    background: transparent;\n    resize: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    left: 0;\n    bottom: 0;\n    padding: 0 6px;\n    line-height: 1.5;\n    font-family: inherit;\n    font-size: inherit;\n    box-sizing: border-box;\n    color: inherit;\n    font-style: inherit;\n    font-weight: inherit;\n    white-space: pre-wrap;\n    word-break: break-all;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] pre {\n    display: block;\n    visibility: hidden;\n    margin: 0px 0px;\n    font-family: inherit;\n    font-size: inherit;\n    color: inherit;\n    font-style: inherit;\n    font-weight: inherit;\n    line-height: 1.5;\n    padding: 0 6px;\n}\n[id^='zego-graphics-box'] {\n    position: absolute;\n}\n[id^='zego-textarea'] {\n    position: absolute;\n    border: 1px dashed transparent;\n}\n[id^='zego-other-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    cursor: none;\n    overflow: hidden;\n}\n[id^='zego-other-container'] div {\n    box-sizing: border-box;\n}\n[id^='zego-laser'] {\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: rgba(255, 78, 51, 1);\n    border: 2px solid rgba(255, 144, 128, 1);\n    box-shadow: 0px 0px 8px 0px rgba(254, 94, 70, 0.7);\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n[id^='zego-box-container'] .img-editor-box,\n[id^='zego-box-container'] .graphics-box {\n    display: none;\n    position: absolute;\n    overflow: visible;\n    margin: 0;\n    padding: 0;\n    z-index: 2;\n    border: 2px solid #b0b3b8;\n    box-shadow: 0 0 1px 0 #ffffff, inset 0 0 1px 0 #ffffff;\n    transform-origin: 0px 0px 0px;\n    transition: border 0.3s;\n    -moz-transition: border 0.3s; /* Firefox 4 */\n    -webkit-transition: border 0.3s; /* Safari 和 Chrome */\n    -o-transition: border 0.3s; /* Opera */\n}\n\n[id^='zego-box-container'] .operation-point-desktop {\n    width: 12px;\n    height: 12px;\n    position: absolute;\n    background-color: #ffffff;\n    border: 2px solid #b0b3b8;\n}\n[id^='zego-box-container'] .operation-point-desktop:active,\n[id^='zego-box-container'] .operation-point-desktop:hover {\n    transform: scale(1.5);\n    border: 2px solid #eb98c7;\n}\n\n[id^='zego-box-container'] .operation-point-desktop.left-top {\n    left: -6px;\n    top: -6px;\n    cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-top {\n    right: -6px;\n    top: -6px;\n    cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left-bottom {\n    left: -6px;\n    bottom: -6px;\n    cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-bottom {\n    right: -6px;\n    bottom: -6px;\n    cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.top {\n    top: -6px;\n    cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right {\n    right: -6px;\n    cursor: ew-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.bottom {\n    bottom: -6px;\n    cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left {\n    left: -6px;\n    cursor: ew-resize;\n}\n",""]),e.exports=t},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,a){function n(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}d((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var o,i,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e],i=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),s=o(4),d=o(26),h=o(36),c=o(2),l=o(3),p=o(5),u=o(0),g=l.getLogAction.bind(null,"wb.v."),f=function(){function e(e,t){var o=this;this.operationModes=Object.freeze({none:!1,scroll:!0,draw:!0,scale:!0}),this.canDraw=!0,this.activited=!1,this.viewInfo={},this.scaleInfo={x:-1,y:-1,syncTimer:0},this.snapshotInstances={},this.handleDragStart=function(e){if(o.operationModes.scale&&o.toolInstance.getUserAuth().scale&&(o.viewInfo.zoomX=o.viewInfo.zoomY=0,o.viewInfo.zoom>1&&!o.canDraw&&o.parentDom)){var t=e instanceof MouseEvent?e:e.changedTouches[0],i=t.clientX,r=t.clientY;o.viewInfo.zoomX=i,o.viewInfo.zoomY=r}},this.handleDragEnd=function(e){o.handleDragMove(e,!0)},this.handleDragMove=function(e,t){if(o.operationModes.scale&&o.toolInstance.getUserAuth().scale&&o.viewInfo.zoom>1&&o.viewInfo.zoomX&&!o.canDraw){if(e instanceof MouseEvent&&!t&&e.buttons<1)return;"touchmove"===e.type&&e.preventDefault(),o.dragPage(e,!!t)}},this.preventDefaultDragEvent=function(e){e.preventDefault()},this.docsviewEventCallback=function(e){var t=e.detail,i=t.action;if(i!==p.DomEventAction.H5Snapshot&&i!==p.DomEventAction.DocsAspect&&l.Logger.info(g(p.DomEvent.Docs),JSON.stringify(t)),i===p.DomEventAction.Page)o.handleDocsPageEvent(t);else if(i===p.DomEventAction.Animation)o.serviceHandle.appendH5Extra(o.whiteboardID,t.data);else if(i===p.DomEventAction.DocsAspect)o.viewInfo.vpageAspecCache=t.data;else if(i===p.DomEventAction.H5Snapshot)o.getH5SnapshotResult(t);else if(i===p.DomEventAction.ReloadView)o.reinitView();else if(i===p.DomEventAction.WbError)o.toolInstance.sendError(t.data);else if(i===p.DomEventAction.Step)n.default.basicState.type===u.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector&&o.hideSelectBox();else if(i===p.DomEventAction.SyncDrag){var r=t,a=r.x,s=r.y,d=r.notify;o.viewInfo.isScroll||(o.viewInfo.zoomTX=a,o.viewInfo.zoomTY=s),d&&o.emitScaleFactor(a,s)}},this.whiteboardID=e,this.serviceHandle=t}return e.prototype.setWhiteboardTransform=function(e,t,o){o||(this.viewInfo.zoomTX=e,this.viewInfo.zoomTY=t);var i=this.viewInfo,r=i.viewWidth,a=i.viewHeight,n=i.zoom,s=i.direction,d=this.viewInfo.page||1;s===u.ZegoWhiteboardViewScrollDirection.Horizontal?e-=(d-1)*r*n:t-=(d-1)*a*n,this.whiteboardNode.style.cssText+="transform:translate("+e+"px,"+t+"px) scale("+n+");"},e.prototype.dragPage=function(e,t){var o=this.viewInfo,i=o.zoom,r=o.zoomTX,a=o.zoomTY,n=o.zoomX,s=o.zoomY,d=o.viewWidth,h=o.viewHeight,c=e instanceof MouseEvent?e:e.changedTouches[0],l=r+c.clientX-n,p=a+c.clientY-s,u=d*(1-i);l>0?l=0:l<u&&(l=u),u=h*(1-i),p>0?p=0:p<u&&(p=u),t&&(this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,this.emitScaleFactor(l,p)),this.setWhiteboardTransform(l,p,!t)},e.prototype.initDragEvents=function(){this.viewInfo.hasOwnProperty("offsetPageX")||(this.viewInfo.offsetPageX=0,this.viewInfo.offsetPageY=0,this.viewInfo.zoom=1,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,this.viewInfo.zoomTX=0,this.viewInfo.zoomTY=0),this.parentDom&&!this.getFileInfo()&&(this.parentDom.addEventListener("mousedown",this.handleDragStart),this.parentDom.addEventListener("mousemove",this.handleDragMove),this.parentDom.addEventListener("mouseup",this.handleDragEnd),this.parentDom.addEventListener("mouseleave",this.handleDragEnd),this.parentDom.addEventListener("touchstart",this.handleDragStart),this.parentDom.addEventListener("touchmove",this.handleDragMove),this.parentDom.addEventListener("touchend",this.handleDragEnd),this.parentDom.addEventListener("touchcancel",this.handleDragEnd))},e.prototype.updateBindEvents=function(){this.toolInstance.removeEventsHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),this.toolInstance.removeEventsHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),this.toolInstance.removeEventsHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),this.toolInstance.removeEventsHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector),this.toolInstance.removeEventsHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser);var e=n.default.basicState.type;switch(e){case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolEllipse:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolRect:case u.ZegoWhiteboardTool.ZegoWhitebaordViewToolCustomImage:this.toolInstance.bindEventsHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine);break;case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText:this.toolInstance.bindEventsHandle(e);break;case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser:this.toolInstance.getInstanceHandle(e),this.toolInstance.bindEventsHandle(e)}},e.prototype.initToolHandle=function(){this.toolInstance?(this.penetrateEventHandle(n.default.basicState.type),this.updateBindEvents(),this.toolInstance.zoomNode=this.zoomNode,this.toolInstance.conNode=this.parentDom,this.toolInstance.graphicsConNode=this.graphicsConNode,this.toolInstance.whiteboardNode=this.whiteboardNode,this.toolInstance.graphicsBoxConNode=this.graphicsBoxConNode):(this.toolInstance=new d.Tool({whiteboardID:this.whiteboardID,zoomNode:this.zoomNode,conNode:this.parentDom,graphicsConNode:this.graphicsConNode,whiteboardNode:this.whiteboardNode,graphicsBoxConNode:this.graphicsBoxConNode,serviceHandle:this.serviceHandle,viewInfo:this.viewInfo}),this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),this.setToolType(n.default.basicState.type),this.hookSetToolType())},e.prototype.updateStateSizeHandle=function(e,t){var o=this.viewInfo.viewWidth;e&&(n.default.basicState.size=e),t&&(n.default.basicState.fontSize=t);var i=n.default.basicState,r=i.size,a=i.fontSize;n.default.basicExtraState.drawSize=c.calSizeHandle(r,u.GraphicType.Line,o,!1),n.default.basicExtraState.drawFontSize=c.calSizeHandle(a,u.GraphicType.Text,o,!1)},e.prototype.getDocsViewAspect=function(e,t,o,i){var r,a=e.firstChild;if(a){var n=t.fileType,s="0"==e.getAttribute("data-mode"),d=Number(e.getAttribute("data-page")),h=a.clientWidth,c=a.clientHeight;if(h&&c||(h=+a.style.width.replace("px",""),c=+a.style.height.replace("px","")),n===u.FileType.PPTH5||n===u.FileType.CUSTOM_H5){var l=e.previousElementSibling;l&&(l.style.zIndex="0")}var p=null===(r=e.parentElement)||void 0===r?void 0:r.parentElement,g=p.clientWidth,f=p.clientHeight,v=s&&c>i;this.updateViewInfo({isScroll:s,isOriginScroll:v,direction:u.ZegoWhiteboardViewScrollDirection.Vertical,pageCount:d,width:h,height:c,viewWidth:o,viewHeight:i,page:this.viewInfo.page||1,zoom:this.viewInfo.zoom||1,parentWidth:g,parentHeight:f})}return{x:0,y:0,width:this.viewInfo.viewWidth,height:this.viewInfo.viewHeight}},e.prototype.getWhiteboardAspect=function(e,t,o){var i=this.getAspectRatio().split(":").map((function(e){return+e})),r=i[0],a=i[1];if(o){var n=this.viewInfo.pageCount,s=this.getWhiteboardLayout(e,t,r/n,a),d={parentWidth:e,parentHeight:t,width:s.width*n,height:s.height,viewWidth:s.width,viewHeight:s.height};return this.updateViewInfo(d),s}var h=this.serviceHandle.getPageCount(this.whiteboardID),c={zoom:1,page:1,pageCount:h,direction:h>1?u.ZegoWhiteboardViewScrollDirection.Horizontal:u.ZegoWhiteboardViewScrollDirection.Center,parentWidth:e,parentHeight:t},l=this.getWhiteboardLayout(e,t,r/h,a);return c.width=l.width*h,c.height=l.height,c.viewWidth=l.width,c.viewHeight=l.height,this.updateViewInfo(c),l},e.prototype.getWhiteboardLayout=function(e,t,o,i){var r=e,a=i*r/o;return(a>t||Math.abs(a-t)<=1)&&(r=t*e/a|0,a=t),{x:(e-r)/2,y:(t-(a|=0))/2,width:r,height:a}},e.prototype.checkParentSize=function(e,t){if(e<=0||t<=0){var o=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewParentNotExist);throw this.serviceHandle.actionCustomListener(u.ZegoEventType.Error,o),new Error("无法获取容器宽高")}},e.prototype.createModule=function(e){var t=this;e&&this.toolInstance&&this.stopLocalDrawHandle(this.serviceHandle.getScrollPercent(this.whiteboardID).verticalPercent);var o=this.getFileInfo(),i=document.getElementById(this.viewInfo.parent);o||(i.style.cssText+="position:relative;display:inherit!important;");var r=i.clientWidth,a=i.clientHeight;this.checkParentSize(r,a);var s=e&&!o?{x:this.viewInfo.zoomTX/this.viewInfo.viewWidth,y:this.viewInfo.zoomTY/this.viewInfo.viewHeight}:{x:0,y:0},d=o?this.getDocsViewAspect(i,o,r,a):this.getWhiteboardAspect(r,a,e),h=d.x,l=d.y,p=n.default.reservedPrefix,g=p.whiteboardZoom,f=p.whiteboardCon,v=p.whiteboard,m=p.boxContainer,b=p.graphicsContainer,y=document.createDocumentFragment();[b,m].forEach((function(e){var o=document.createElement("div");o.id=""+e+t.whiteboardID,y.appendChild(o)}));var w=c.getElementChild(y);this.graphicsConNode=w[0],this.graphicsBoxConNode=w[1],this.createGraphicsBox();var x=this.viewInfo,I=x.width,E=x.height,T=x.viewWidth,S=x.viewHeight;if(this.whiteboardNode=document.createElement("div"),this.whiteboardNode.id=""+v+this.whiteboardID,this.whiteboardNode.style.cssText+="width:"+I+"px;height:"+E+"px;",this.whiteboardNode.appendChild(y),o)this.parentDom=i,this.zoomNode=i.parentNode,i.innerHTML="",i.appendChild(this.whiteboardNode),this.handleDocsviewEvent(i);else{var W="left:"+h+"px;top:"+l+"px;width:"+T+"px;height:"+S+"px;overflow:hidden;";if(this.parentDom=i.querySelector("#"+f+this.whiteboardID),e&&this.parentDom)this.parentDom.innerHTML="",this.parentDom.style.cssText+=W,this.parentDom.appendChild(this.whiteboardNode),this.setWhiteboardTransform(s.x*T|0,s.y*S|0);else{var H=document.createElement("div");H.id=""+g+this.whiteboardID,this.zoomNode=H;var C=document.createElement("div");C.id=""+f+this.whiteboardID,C.style.cssText=W,C.appendChild(this.whiteboardNode),H.appendChild(C),i.appendChild(H),this.parentDom=C}}n.default.basicState.type!==u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText&&(this.parentDom.style.userSelect="none"),this.parentDom.addEventListener("dragenter",this.preventDefaultDragEvent),this.serviceHandle.setViewSize(this.whiteboardID,T,S),this.serviceHandle.setSize(this.whiteboardID,I,E)},e.prototype.activitView=function(){var e;if(this.setActivited(!0),this.parentDom){var t=(null===(e=this.getFileInfo())||void 0===e?void 0:e.fileID)||"";l.Logger.setExtraConfig({wbId:this.whiteboardID,fileID:t});var o=this.parentDom.parentElement;if(o){var i=o.id;o=o.parentElement,Array.from(c.getElementChild(o)).forEach((function(e){e.style.display=e.id===i?"block":"none"}))}var r=t?n.default.basicExtraState.defaultFileBgColor:n.default.basicState.bgColor;this.toolInstance.background.setBackgroundColor(r),this.setDragStyle(this.getToolType()||0)}},e.prototype.updateViewInfo=function(e){Object.assign(this.viewInfo,e)},e.prototype.isChangeStepInnerPage=function(e){var t,o=null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType;if(o===u.FileType.PPTH5||o===u.FileType.CUSTOM_H5){var i=this.viewInfo,r=i.page,a=i.pageCount;return r===Math.min(Math.round(e*a)+1,a)}return!1},e.prototype.stopLocalDrawHandle=function(e){try{var t=n.default.basicState.type,o=u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser,i=u.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector,r=u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText,a=this.isChangeStepInnerPage(e);switch(t){case o:var s=this.toolInstance.getInstanceHandle(o);!a&&s&&s.pushActualPlaceHandle();break;case i:var d=this.toolInstance.getInstanceHandle(i);if(!a&&d){var h=document.activeElement;h&&h.id&&this.whiteboardNode.querySelector("#"+h.id)&&"TEXTAREA"===h.tagName?h.blur():(this.toolInstance.updateOffsetAndScrollHandle(),d.mouseupHandle(),d.hideImageEditBox(),d.hideSelectBox())}break;case r:var c=document.activeElement;!a&&c&&c.id&&this.whiteboardNode.querySelector("#"+c.id)&&"TEXTAREA"===c.tagName&&c.blur();break;case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolRect:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine:case u.ZegoWhiteboardTool.ZegoWhiteboardViewToolEllipse:case u.ZegoWhiteboardTool.ZegoWhitebaordViewToolCustomImage:var l=this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine);!a&&l&&(this.toolInstance.updateOffsetAndScrollHandle(),l.mouseupHandle())}this.toolInstance.resetImageBox()}catch(e){}},e.prototype.setClassNameHandle=function(e){var t,o=n.default.reservedPrefix,i=o.whiteboard,r=o.whiteboardCon,a=o.whiteboardZoom;null===(t=this.zoomNode.parentNode)||void 0===t||t.querySelectorAll("[id^="+i+"]").forEach((function(t){-1===t.id.indexOf(""+r)&&-1===t.id.indexOf(""+a)&&(t.className=u.ZegoWhiteboardTool[e]||"")}))},e.prototype.penetrateEventHandle=function(e){var t,o=null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType;if((o===u.FileType.PPTH5||o===u.FileType.CUSTOM_H5)&&this.parentDom){var i=this.operationModes.none||e!==u.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick?"initial":"none";this.parentDom.style.pointerEvents=i,this.graphicsBoxConNode.style.pointerEvents=i}},e.prototype.jumpPage=function(e,t){var o,i=this.viewInfo,r=i.viewWidth,a=i.viewHeight,n=i.pageCount,s=i.direction;n>=1&&(s===u.ZegoWhiteboardViewScrollDirection.Horizontal?(o=Math.min(Math.round(e*n)+1,n))<=n&&(this.updateViewInfo({offsetPageX:(o-1)*r,page:o}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)):(o=Math.min(Math.round(t*n)+1,n))<=n&&(this.updateViewInfo({offsetPageY:(o-1)*a,page:o}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)));this.serviceHandle.actionCustomListener(u.ZegoEventType.ViewScroll,{id:this.whiteboardID,horizontalPercent:e,verticalPercent:t,page:this.getCurrentPage(),step:1})},e.prototype.handleDocsviewEvent=function(e){var t={action:p.DomEventAction.WbInit,data:this.whiteboardID};e.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:t})),e.addEventListener(p.DomEvent.Docs,this.docsviewEventCallback)},e.prototype.handleDocsPageEvent=function(e){var t,o=e.page,i=e.pageCount,r=e.step,a=e.percent,s=e.notify,d=e.ofsX,h=this.viewInfo,c=h.isScroll,l=h.viewHeight,p=h.zoom;this.viewInfo.page=o,this.viewInfo.pageCount=i,c||(this.viewInfo.offsetPageY=(o-1)*l),s&&c&&"number"==typeof d&&(t={scaleFactor:p,scaleOffsetX:d,scaleOffsetY:+n.default.scaleModes.sync},this.scaleInfo.y=0),this.emitScroll(0,a,r,s,t),this.serviceHandle.actionCustomListener(u.ZegoEventType.ViewScroll,{id:this.whiteboardID,horizontalPercent:0,verticalPercent:a,page:o,step:r})},e.prototype.getH5SnapshotResult=function(e){var t=e.dataUrl,o=e.snapshotId;this.snapshotInstances[o].getH5Snapshot(t)},e.prototype.hideSelectBox=function(){var e=this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);e.hideImageEditBox(),e.hideSelectBox()},e.prototype.hookSetToolType=function(){this.updateBindEvents(),this.hideSelectBox()},e.prototype.setDragStyle=function(e){if(this.parentDom){var t=this.toolInstance.getUserAuth(),o=t.scale,i=t.scroll,r=this.operationModes.scale&&!!o&&!e;this.parentDom.style.cursor=r?"move":"auto",this.parentDom.style.touchAction=r?"auto":"none";var a={action:p.DomEventAction.WbDragTool,enable:this.operationModes.scroll&&!!i,remoteScroll:!!i,isDrag:r};this.parentDom.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:a}))}},e.prototype.addImageGraphic=function(e,t,o){var i=this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),r=this.toolInstance.transLocationOrigin({clientX:t,clientY:o});return i.drawLocalGraphicImage(e,r.clientX,r.clientY)},e.prototype.initBackground=function(e){this.toolInstance.createBackground(this.whiteboardNode,e)},e.prototype.canReloadView=function(){var e=document.getElementById(this.viewInfo.parent);e.style.cssText+="position:relative;display:block!important;";var t=e.clientWidth,o=e.clientHeight;this.checkParentSize(t,o);var i=this.viewInfo,r=i.viewWidth,a=i.viewHeight,n=this.getWhiteboardAspect(t,o,!0),s=n.x,d=n.y,h=n.width,c=n.height;return!(Math.abs(r-h)<5&&Math.abs(a-c)<5)||(this.parentDom.style.cssText+="left:"+s+"px;top:"+d+"px;",l.Logger.info(g("reloadViewLayou"),JSON.stringify({w0:r,h0:a,w:h,h:c})),!1)},e.prototype.reinitView=function(){this.parentDom=null,this.init(this.viewInfo.parent,!0),this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser).updateLaserConSize()},e.prototype.updateLaser=function(){this.toolInstance.reverseZoomHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser);var e=this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser);e.updateLaserConSize(),e.pushActualPlaceHandle()},e.prototype.remoteUpdateBackgroundImage=function(e){this.toolInstance.background.remoteAddBackgroundImageGraphic(e)},e.prototype.remoteClearBackgroundImage=function(){this.toolInstance.background.updateToLocal(!0).clearBackgroundImage()},e.prototype.createGraphicsBox=function(){this.graphicsBoxConNode.innerHTML='\n        <div class="img-editor-box">\n            <div class="operation-point-desktop left-top cursor-nwse LT"></div>\n            <div class="operation-point-desktop right-top cursor-nesw RT"></div>\n            <div class="operation-point-desktop left-bottom cursor-nesw LB"></div>\n            <div class="operation-point-desktop right-bottom cursor-nwse RB"></div>\n            <div class="operation-point-desktop top cursor-ns T"></div>\n            <div class="operation-point-desktop right cursor-ew R"></div>\n            <div class="operation-point-desktop bottom cursor-ns B"></div>\n            <div class="operation-point-desktop left cursor-ew L"></div>\n        </div>\n        <div class="graphics-box"></div>'},e.prototype.emitScroll=function(e,t,o,i,r){this.serviceHandle.loadCurrentGraphics(this.whiteboardID,e,t),i&&this.serviceHandle.scroll(this.whiteboardID,e,t,o,r)},e.prototype.emitScaleFactor=function(e,t,o){if(!o){e=0|Math.abs(e),t=0|Math.abs(t);var i=this.viewInfo,r=i.zoom,a=i.width,s=i.height;e=e&&Number((e/a/r).toFixed(7)),t=t&&Number((t/s/r).toFixed(7)),this.scaleInfo.x=e,this.scaleInfo.y=t}n.default.scaleModes.sync&&this.serviceHandle.scale(this.whiteboardID,this.viewInfo.zoom,e,t)},e.prototype.scaleToHandle=function(e,t,o,i){var r=this;if(this.activited)if(this.scaleInfo.x=t,this.scaleInfo.y=o,this.viewInfo.zoom=e||1,this.getFileInfo()){this.scaleInfo.syncTimer&&clearTimeout(this.scaleInfo.syncTimer);var a=i?50:100;this.scaleInfo.syncTimer=window.setTimeout((function(){var a={action:p.DomEventAction.WbScale,scale:e,x:t,y:o,notify:i};r.parentDom&&r.parentDom.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:a})),r.updateLaser()}),a)}else{var n=this.viewInfo,s=n.viewWidth,d=n.viewHeight,h=n.width,c=n.height,l=n.zoom,u=-t*h*l,g=-o*c*l;i&&(u=s*(1-e)*.5|0,g=d*(1-e)*.5|0,this.emitScaleFactor(u,g)),this.setWhiteboardTransform(u,g),this.updateLaser()}},e.prototype.init=function(e,t){this.viewInfo.parent=e;var o=document.getElementById(""+n.default.reservedPrefix.whiteboard+this.whiteboardID);this.parentDom&&o||this.createModule(!!t),this.initToolHandle(),this.initBackground(!!t||!o),this.updateBindEvents(),this.updateStateSizeHandle(),this.initDragEvents(),this.activitView();var i=this.serviceHandle.getScrollPercent(this.whiteboardID),r=i.horizontalPercent,a=i.verticalPercent,s=i.pptStep;if(t){this.toolInstance.updateOffsetAndScrollHandle(),this.toolInstance.updateOffsetPage(),this.serviceHandle.isElectron?this.emitScroll(r,a,s,!1):(this.serviceHandle.reloadViewGraphics(this.whiteboardID,this.toolInstance.graphicList),this.updateRemoteToLocal(this.toolInstance.graphicList,[]));var d=this.scaleInfo,h=d.x,c=d.y;-1!==h&&-1!==c&&this.scaleToHandle(this.viewInfo.zoom,h,c,!1)}else{if(this.scrollToHandle(r,a,s,!1),n.default.scaleModes.response){var p=this.serviceHandle.getScale(this.whiteboardID),u=p.scaleFactor,f=p.scaleOffsetX,v=p.scaleOffsetY;this.scaleToHandle(u,f,v,!1)}this.playAnimation(this.serviceHandle.getH5Extra(this.whiteboardID),!1)}l.Logger.info(g("mod.init"),JSON.stringify({horizontalPercent:r,verticalPercent:a,step:s}));var m=this.zoomNode.parentNode,b=m.clientWidth,y=m.clientHeight;!t&&(Math.abs(b-this.viewInfo.parentWidth)>5||Math.abs(y-this.viewInfo.parentHeight)>5)&&this.reloadView()},e.prototype.getContentSize=function(){return{width:this.viewInfo.width,height:this.viewInfo.height}},e.prototype.setActivited=function(e){this.activited=e},e.prototype.getActivited=function(){return this.activited},e.prototype.scrollToHandle=function(e,t,o,i){if(this.activited)if(this.stopLocalDrawHandle(t),this.getFileInfo()){var r=this.serviceHandle.getScale(this.whiteboardID),a=r.scaleOffsetX,n=r.scaleOffsetY,s={action:p.DomEventAction.Page,percent:t,step:o||1,ofsX:a,ofsY:n,notify:i};this.parentDom&&this.parentDom.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:s}))}else this.emitScroll(e,t,1,i),this.jumpPage(e,t)},e.prototype.syncScaleToHandle=function(){var e=this.scaleInfo,t=e.x,o=e.y;-1!==t&&-1!==o&&this.emitScaleFactor(t,o,!0)},e.prototype.clearLaserHandle=function(e){this.toolInstance&&this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser).clearLaserHandle(e)},e.prototype.clearLocalHandle=function(e){e&&e.includes(1)?this.remoteClearBackgroundImage():(this.toolInstance.clearLocalHandle(),this.createGraphicsBox())},e.prototype.updateRemoteToLocal=function(e,t){var o=this.toolInstance.graphicList.some((function(e){return t.length&&t.includes(e.graphic_id)&&e.type==u.GraphicType.BgImage})),i=e.filter((function(e){return e.type==u.GraphicType.BgImage}));if(i.length){var r=i.pop();this.remoteUpdateBackgroundImage(r)}o&&this.remoteClearBackgroundImage(),e=e.filter((function(e){return e.type!==u.GraphicType.BgImage})),this.toolInstance.updatePushLocalHandle(e,t)},e.prototype.destroyDomHandle=function(){if(this.parentDom){l.Logger.info(g("mod.destroy_dom"),JSON.stringify({domID:this.parentDom.id}));var e={action:p.DomEventAction.WbDestroy,data:this.whiteboardID};this.parentDom.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:e})),c.removeElement(this.parentDom.parentElement),this.parentDom=null}},e.prototype.playAnimation=function(e,t){var o;if(this.activited){var i={action:p.DomEventAction.Animation,data:e,notify:!t};null===(o=this.parentDom)||void 0===o||o.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:i}))}},e.prototype.onAuthChange=function(){this.activited&&this.setDragStyle(this.getToolType()||0)},e.prototype.clear=function(){var e=this;if(this.operationModes.draw)if(this.toolInstance.getUserAuth().clear){l.Logger.info(g("mod.clear"),JSON.stringify({whiteboardID:this.whiteboardID}));var t=this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);t.hideImageEditBox(),t.hideSelectBox(),this.serviceHandle.clearView(this.whiteboardID,[0]).then((function(){e.clearLocalHandle(),l.Logger.info(g("mod.clear_cb"),"success")})).catch((function(t){var o=e.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorClearFail);l.Logger.error(g("mod.clear_cb"),JSON.stringify(o))}))}else this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthClearGraphic)},e.prototype.scroll=function(e,t){return isNaN(+e)||isNaN(+t)?(this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: horizontalPercent、verticalPercent取值为0~1",!0),!1):!!this.operationModes.scroll&&(this.toolInstance.getUserAuth().scroll?(l.Logger.info(g("mod.scroll"),JSON.stringify({params:{horizontalPercent:e,verticalPercent:t}})),e<0&&(e=0),e>1&&(e=1),t<0&&(t=0),t>1&&(t=1),e=Number(e.toFixed(7)),t=Number(t.toFixed(7)),l.Logger.info(g("mod.scroll"),JSON.stringify({transParams:{horizontalPercent:e,verticalPercent:t}})),this.viewInfo.pageCount>1&&this.viewInfo.page>0&&(this.scrollToHandle(e,t,1,!0),!0)):(this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthScroll),!1))},e.prototype.getCurrentScrollPercent=function(){return i(i({},this.serviceHandle.getScrollPercent(this.whiteboardID)),{direction:this.viewInfo.direction})},e.prototype.getHorizontalPercent=function(){return this.getCurrentScrollPercent().horizontalPercent},e.prototype.getVerticalPercent=function(){return this.getCurrentScrollPercent().verticalPercent},e.prototype.undo=function(){this.operationModes.draw&&(this.serviceHandle.isElectron?this.serviceHandle.undo(this.whiteboardID):this.toolInstance.undoNewHandle())},e.prototype.redo=function(){this.operationModes.draw&&(this.serviceHandle.isElectron?this.serviceHandle.redo(this.whiteboardID):this.toolInstance.redoNewHandle())},e.prototype.getAspectRatio=function(){return this.serviceHandle.getAspectRatio(this.whiteboardID)},e.prototype.getFileInfo=function(){return this.serviceHandle.getFileInfo(this.whiteboardID)},e.prototype.getID=function(){return this.whiteboardID},e.prototype.getName=function(){return this.serviceHandle.getModName(this.whiteboardID)},e.prototype.getCreateTime=function(){return this.serviceHandle.getCreateTime(this.whiteboardID)},e.prototype.getRoomID=function(){return this.serviceHandle.getRoomID(this.whiteboardID)},e.prototype.getCurrentPage=function(){return this.viewInfo.page||1},e.prototype.getPageCount=function(){return this.viewInfo.pageCount||1},e.prototype.setBackgroundColor=function(e){return c.checkColor(e)?!!this.toolInstance.enableDraw&&(n.default.basicState.bgColor=e,this.toolInstance.background.setBackgroundColor(e),!0):(this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: color仅支持16进制、rgba",!0),!1)},e.prototype.getBackgroundColor=function(){return n.default.basicState.bgColor},e.prototype.setBackgroundImage=function(e,t,o){return this.toolInstance.background.setBackgroundImage(e,t,o)},e.prototype.clearBackgroundImage=function(){this.toolInstance.background.clearBackgroundImage()},e.prototype.setToolType=function(e){var t;if(this.operationModes.none)return!1;if((e=e||0)===u.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick){var o=null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType;if(o!==u.FileType.PPTH5&&o!==u.FileType.CUSTOM_H5)return!1}if(-1===Object.keys(u.ZegoWhiteboardTool).indexOf(""+e)&&e){var i=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);return this.serviceHandle.actionCustomListener(u.ZegoEventType.Error,i),!1}return l.Logger.info(g("mod.setToolType"),JSON.stringify({params:e})),this.toolInstance?(this.parentDom.style.userSelect=e!==u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText?"none":"auto",this.canDraw=this.operationModes.draw&&!!e&&e!==u.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick,this.setClassNameHandle(e),this.setDragStyle(e),this.penetrateEventHandle(e),n.default.basicState.type===e||(n.default.basicState.type=e,this.hookSetToolType()),!0):(n.default.basicState.type=e,!0)},e.prototype.getToolType=function(){return n.default.basicState.type||null},e.prototype.setBrushColor=function(e){if(!c.checkColor(e)){var t=this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误：color仅支持16进制、rgba",!0);return l.Logger.error(g("mod.setBrushColor"),JSON.stringify(t)),!1}return l.Logger.info(g("mod.setBrushColor"),JSON.stringify({params:e})),n.default.basicState.color=e,!0},e.prototype.getBrushColor=function(){return n.default.basicState.color},e.prototype.setBrushSize=function(e){return c.checkBrushSize(e)?(this.updateStateSizeHandle(e),l.Logger.info(g("mod.setBrushSize"),JSON.stringify({params:e})),!0):(this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 画笔粗细为100内的正整数",!0),!1)},e.prototype.getBrushSize=function(){return n.default.basicState.size},e.prototype.setTextSize=function(e){return c.checkTextSize(e)?(this.updateStateSizeHandle(void 0,e),l.Logger.info(g("mod.setTextSize"),JSON.stringify({params:e})),!0):(this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 文本大小为100内的正整数",!0),!1)},e.prototype.setFontSize=function(e){return this.setTextSize(e)},e.prototype.getTextSize=function(){return n.default.basicState.fontSize},e.prototype.getFontSize=function(){return this.getTextSize()},e.prototype.setScaleFactor=function(e,t,o){var i=+e;(!i||i<1)&&(i=1),this.viewInfo.zoom!==i&&this.operationModes.scale&&this.getToolType()!==u.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick&&(this.toolInstance.getUserAuth().scale?(l.Logger.info(g("mod.setScaleFactor"),JSON.stringify({params:{zoom:i,x:t,y:o}})),this.scaleToHandle(i,t||0,o||0,!0)):this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthScale))},e.prototype.getScaleFactor=function(){return{scaleFactor:this.viewInfo.zoom,scaleOffsetX:0,scaleOffsetY:0}},e.prototype.getScaleOffsetX=function(){return this.getScaleFactor().scaleOffsetX},e.prototype.getScaleOffsetY=function(){return this.getScaleFactor().scaleOffsetY},e.prototype.setFontItalic=function(e){if("boolean"!=typeof e)return this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid),!1;var t=n.default.basicState.attributes,o=JSON.parse(t);return o.italic=e,n.default.basicState.attributes=JSON.stringify(o),l.Logger.info(g("mod.setFontItalic"),JSON.stringify({params:e,result:n.default.basicState.attributes})),!0},e.prototype.isFontItalic=function(){return JSON.parse(n.default.basicState.attributes).italic},e.prototype.setFontBold=function(e){"boolean"!=typeof e&&this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid),l.Logger.info(g("mod.setFontBold"),JSON.stringify({params:e}));var t=n.default.basicState.attributes,o=JSON.parse(t);return o.bold=e,n.default.basicState.attributes=JSON.stringify(o),l.Logger.info(g("mod.setFontBold"),JSON.stringify({params:e,result:n.default.basicState.attributes})),!0},e.prototype.isFontBold=function(){return JSON.parse(n.default.basicState.attributes).bold},e.prototype.clearCurrentPage=function(){this.toolInstance.clearPage(this.viewInfo.page||1)},e.prototype.deleteSelectedGraphics=function(){this.toolInstance.deleteSelectedGraphics(u.DeleteGraphicAction.BatchSelete)},e.prototype.addText=function(e,t,o){if(this.operationModes.draw&&this.getToolType()===u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText)if(!e||!c.isNumber(t)||!c.isNumber(o)||t<0||o<0||t>this.viewInfo.viewWidth||o>this.viewInfo.viewHeight)this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);else if(this.toolInstance.getUserAuth().create){var i=this.toolInstance.getInstanceHandle(u.ZegoWhiteboardTool.ZegoWhiteboardViewToolText);this.toolInstance.updateOffsetAndScrollHandle();var r=this.toolInstance.transLocationOrigin({clientX:t,clientY:o});t=r.clientX,o=r.clientY,i.addTextGraphics(e,t,o),l.Logger.info(g("mod.addText"),JSON.stringify({params:{text:e,positionX:t,positionY:o}}))}else this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic)},e.prototype.addImage=function(e,t,o,i,r){var a=this,d=this.viewInfo.viewWidth,h=this.viewInfo.viewHeight,p=u.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageGraphic,f=u.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageCustom;if(!i||e!==p&&e!==f||!c.isNumber(t)||!c.isNumber(o)||e===p&&(t<0||o<0||t>d||o>h)||e===f&&"string"!=typeof i){var v=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);return Promise.reject(v)}if(!this.operationModes.draw)return Promise.reject({});if(!this.toolInstance.getUserAuth().create){v=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic);return Promise.reject(v)}var m=e===p?10485760:512e3;if("string"==typeof i){var b=i;if(!b.startsWith("https://")){v=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl);return Promise.reject(v)}return new Promise((function(r,d){var h=!0,c=new XMLHttpRequest;c.open("HEAD",b,!0),c.onreadystatechange=function(){if(4==c.readyState){if(200!=c.status){h=!1;var p=404===c.status?u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl:u.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp;return d(s.transError(p))}var v=(c.getResponseHeader("Content-Type")||"").replace("image/",""),y=+c.getResponseHeader("Content-Length");if(!"jpg,jpeg,png,svg+xml".includes(v)){var w=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return d(w)}if(y>m){w=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return d(w)}if(l.Logger.info(g("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:o,address:i}})),e===f){n.default.basicExtraState.customImage.url=b;var x=new Image;x.setAttribute("crossOrigin","anonymous"),x.onload=function(){n.default.basicExtraState.customImage.w=x.width,n.default.basicExtraState.customImage.h=x.height},x.src=b,r(b)}else a.addImageGraphic(b,t,o).then(r)}},c.onerror=function(){if(h){var e=404===c.status?u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl:u.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp;d(s.transError(e))}},c.send(null)}))}if(this.serviceHandle.isElectron&&e===p&&"object"==typeof i){if(!/(\.jpg|\.jpeg|\.png|\.svg)$/.test((i=i).path)){v=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(v)}return l.Logger.info(g("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:o,address:i.path}})),this.serviceHandle.uploadImage(i.path,r).then((function(e){return a.addImageGraphic(e,t,o)}))}var y=(i=i).type.replace("image/","");if(!"jpg,jpeg,png,svg+xml".includes(y)){v=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(v)}if(i.size>m){v=s.transError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return Promise.reject(v)}return l.Logger.info(g("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:o,address:i.name}})),this.serviceHandle.uploadImage(i,r).then((function(e){return a.addImageGraphic(e,t,o)}))},e.prototype.setWhiteboardOperationMode=function(e){if(e&&c.isNumber(e)){var t=!!(e%2),o=!t&&[2,6,10,14].includes(e),i=!t&&[4,6,12,14].includes(e),r=!t&&[8,10,12,14].includes(e);this.operationModes=Object.freeze({none:t,scroll:o,draw:i,scale:r});var a=n.default.basicState.type;this.toolInstance&&(this.toolInstance.enableDraw=i),this.canDraw=i&&!!a&&a!==u.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick,this.setDragStyle(a),this.penetrateEventHandle(a),l.Logger.info(g("mod.setWhiteboardOperationMode"),JSON.stringify({params:e,result:this.operationModes}))}else this.toolInstance.sendError(u.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid)},e.prototype.snapshot=function(e){return r(this,void 0,void 0,(function(){var t,o,i;return a(this,(function(r){switch(r.label){case 0:return t=null==e?void 0:e.userData,o=new h.Snapshot(this.toolInstance,this.toolInstance.background),this.snapshotInstances[o.snapshotId]=o,[4,o.snapshot(t)];case 1:return i=r.sent(),delete this.snapshotInstances[o.snapshotId],[2,i]}}))}))},e.prototype.reloadView=function(){if(this.getFileInfo()){var e={action:p.DomEventAction.ReloadView,data:""};this.parentDom&&this.parentDom.dispatchEvent(new CustomEvent(p.DomEvent.Whiteboard,{detail:e}))}else this.canReloadView()&&this.reinitView()},e}();t.ZegoWhiteboardViewImpl=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ZegoWhiteboardViewSuccess=0]="ZegoWhiteboardViewSuccess",e[e.ZegoWhiteboardViewErrorInternal=3000001]="ZegoWhiteboardViewErrorInternal",e[e.ZegoWhiteboardViewErrorParamInvalid=3000002]="ZegoWhiteboardViewErrorParamInvalid",e[e.ZegoWhiteboardViewErrorNetworkTimeout=3000003]="ZegoWhiteboardViewErrorNetworkTimeout",e[e.ZegoWhiteboardViewErrorNetworkDisconnect=3000004]="ZegoWhiteboardViewErrorNetworkDisconnect",e[e.ZegoWhiteboardViewErrorInvalidRsp=3000005]="ZegoWhiteboardViewErrorInvalidRsp",e[e.ZegoWhiteboardViewErrorRequestTooMany=3000006]="ZegoWhiteboardViewErrorRequestTooMany",e[e.ZegoWhiteboardViewErrorVersionMismatch=3000007]="ZegoWhiteboardViewErrorVersionMismatch",e[e.ZegoWhiteboardViewErrorNoLoginRoom=3010001]="ZegoWhiteboardViewErrorNoLoginRoom",e[e.ZegoWhiteboardViewErrorUserNotExist=3010002]="ZegoWhiteboardViewErrorUserNotExist",e[e.ZegoWhiteboardViewErrorViewNotExist=3020001]="ZegoWhiteboardViewErrorViewNotExist",e[e.ZegoWhiteboardViewErrorViewCreateFail=3020002]="ZegoWhiteboardViewErrorViewCreateFail",e[e.ZegoWhiteboardViewErrorViewModifyFail=3020003]="ZegoWhiteboardViewErrorViewModifyFail",e[e.ZegoWhiteboardViewErrorViewNameLimit=3020004]="ZegoWhiteboardViewErrorViewNameLimit",e[e.ZegoWhiteboardViewErrorViewParentNotExist=3020005]="ZegoWhiteboardViewErrorViewParentNotExist",e[e.ZegoWhiteboardViewErrorViewNumLimit=3020006]="ZegoWhiteboardViewErrorViewNumLimit",e[e.ZegoWhiteboardViewErrorAnimationInfoLimit=3020007]="ZegoWhiteboardViewErrorAnimationInfoLimit",e[e.ZegoWhiteboardViewErrorGraphicNotExist=3030001]="ZegoWhiteboardViewErrorGraphicNotExist",e[e.ZegoWhiteboardViewErrorGraphicCreateFail=3030002]="ZegoWhiteboardViewErrorGraphicCreateFail",e[e.ZegoWhiteboardViewErrorGraphicModifyFail=3030003]="ZegoWhiteboardViewErrorGraphicModifyFail",e[e.ZegoWhiteboardViewErrorGraphicUnableDraw=3030004]="ZegoWhiteboardViewErrorGraphicUnableDraw",e[e.ZegoWhiteboardViewErrorGraphicDataLimit=3030005]="ZegoWhiteboardViewErrorGraphicDataLimit",e[e.ZegoWhiteboardViewErrorGraphicNumLimit=3030006]="ZegoWhiteboardViewErrorGraphicNumLimit",e[e.ZegoWhiteboardViewErrorGraphicTextLimit=3030007]="ZegoWhiteboardViewErrorGraphicTextLimit",e[e.ZegoWhiteboardViewErrorGraphicImageSizeLimit=3030008]="ZegoWhiteboardViewErrorGraphicImageSizeLimit",e[e.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport=3030009]="ZegoWhiteboardViewErrorGraphicImageTypeNotSupport",e[e.ZegoWhiteboardViewErrorGraphicIllegalUrl=3030010]="ZegoWhiteboardViewErrorGraphicIllegalUrl",e[e.ZegoWhiteboardViewErrorInitFail=3040001]="ZegoWhiteboardViewErrorInitFail",e[e.ZegoWhiteboardViewErrorGetListFail=3040002]="ZegoWhiteboardViewErrorGetListFail",e[e.ZegoWhiteboardViewErrorCreateFail=3040003]="ZegoWhiteboardViewErrorCreateFail",e[e.ZegoWhiteboardViewErrorDestroyFail=3040004]="ZegoWhiteboardViewErrorDestroyFail",e[e.ZegoWhiteboardViewErrorAttachFail=3040005]="ZegoWhiteboardViewErrorAttachFail",e[e.ZegoWhiteboardViewErrorClearFail=3040006]="ZegoWhiteboardViewErrorClearFail",e[e.ZegoWhiteboardViewErrorScrollFail=3040007]="ZegoWhiteboardViewErrorScrollFail",e[e.ZegoWhiteboardViewErrorUndoFail=3040008]="ZegoWhiteboardViewErrorUndoFail",e[e.ZegoWhiteboardViewErrorRedoFail=3040009]="ZegoWhiteboardViewErrorRedoFail",e[e.ZegoWhiteboardViewErrorLogFolderNotAccess=3040010]="ZegoWhiteboardViewErrorLogFolderNotAccess",e[e.ZegoWhiteboardViewErrorCacheFolderNotAccess=3040011]="ZegoWhiteboardViewErrorCacheFolderNotAccess",e[e.ZegoWhiteboardViewErrorNoAuthScale=3050001]="ZegoWhiteboardViewErrorNoAuthScale",e[e.ZegoWhiteboardViewErrorNoAuthScroll=3050002]="ZegoWhiteboardViewErrorNoAuthScroll",e[e.ZegoWhiteboardViewErrorNoAuthCreateGraphic=3050003]="ZegoWhiteboardViewErrorNoAuthCreateGraphic",e[e.ZegoWhiteboardViewErrorNoAuthUpdateGraphic=3050004]="ZegoWhiteboardViewErrorNoAuthUpdateGraphic",e[e.ZegoWhiteboardViewErrorNoAuthMoveGraphic=3050005]="ZegoWhiteboardViewErrorNoAuthMoveGraphic",e[e.ZegoWhiteboardViewErrorNoAuthDeleteGraphic=3050006]="ZegoWhiteboardViewErrorNoAuthDeleteGraphic",e[e.ZegoWhiteboardViewErrorNoAuthClearGraphic=3050007]="ZegoWhiteboardViewErrorNoAuthClearGraphic"}(t.ZegoWhiteboardError||(t.ZegoWhiteboardError={})),function(e){e[e.ZegoWhiteboardViewToolPen=1]="ZegoWhiteboardViewToolPen",e[e.ZegoWhiteboardViewToolText=2]="ZegoWhiteboardViewToolText",e[e.ZegoWhiteboardViewToolLine=4]="ZegoWhiteboardViewToolLine",e[e.ZegoWhiteboardViewToolRect=8]="ZegoWhiteboardViewToolRect",e[e.ZegoWhiteboardViewToolEllipse=16]="ZegoWhiteboardViewToolEllipse",e[e.ZegoWhiteboardViewToolSelector=32]="ZegoWhiteboardViewToolSelector",e[e.ZegoWhiteboardViewToolEraser=64]="ZegoWhiteboardViewToolEraser",e[e.ZegoWhiteboardViewToolLaser=128]="ZegoWhiteboardViewToolLaser",e[e.ZegoWhiteboardViewToolClick=256]="ZegoWhiteboardViewToolClick",e[e.ZegoWhitebaordViewToolCustomImage=512]="ZegoWhitebaordViewToolCustomImage"}(t.ZegoWhiteboardTool||(t.ZegoWhiteboardTool={})),function(e){e[e.ZegoWhiteboardOperationModeNone=1]="ZegoWhiteboardOperationModeNone",e[e.ZegoWhiteboardOperationModeScroll=2]="ZegoWhiteboardOperationModeScroll",e[e.ZegoWhiteboardOperationModeDraw=4]="ZegoWhiteboardOperationModeDraw",e[e.ZegoWhiteboardOperationModeZoom=8]="ZegoWhiteboardOperationModeZoom"}(t.ZegoWhiteboardOperationMode||(t.ZegoWhiteboardOperationMode={})),function(e){e[e.ZegoWhiteboardViewImageGraphic=0]="ZegoWhiteboardViewImageGraphic",e[e.ZegoWhiteboardViewImageCustom=1]="ZegoWhiteboardViewImageCustom"}(t.ZegoWhiteboardViewImageType||(t.ZegoWhiteboardViewImageType={})),function(e){e[e.ZegoWhiteboardViewImageFitModeLeft=0]="ZegoWhiteboardViewImageFitModeLeft",e[e.ZegoWhiteboardViewImageFitModeRight=1]="ZegoWhiteboardViewImageFitModeRight",e[e.ZegoWhiteboardViewImageFitModeBottom=2]="ZegoWhiteboardViewImageFitModeBottom",e[e.ZegoWhiteboardViewImageFitModeTop=3]="ZegoWhiteboardViewImageFitModeTop",e[e.ZegoWhiteboardViewImageFitModeCenter=4]="ZegoWhiteboardViewImageFitModeCenter"}(t.ZegoWhiteboardViewImageFitMode||(t.ZegoWhiteboardViewImageFitMode={})),function(e){e[e.Center=0]="Center",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(t.ZegoWhiteboardViewScrollDirection||(t.ZegoWhiteboardViewScrollDirection={}))},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var a=arguments[t],n=0,s=a.length;n<s;n++,r++)i[r]=a[n];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=o(2),n=o(0),s=o(4),d=o(1),h=o(29),c=o(30),l=o(31),p=o(32),u=o(33),g=o(35),f=o(3),v=f.getLogAction.bind(null,"wb.v."),m=function(){function e(e){this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0},this.graphicList=[],this.enableDraw=!0,this.graphicTaskList=[],this.undoList=[],this.redoList=[],this.doTaskSeq=0,this.canDo=!0,this.graphicExtraMap={},this.instancesMap={};var t=e.whiteboardID,o=e.zoomNode,i=e.conNode,r=e.serviceHandle,a=e.graphicsConNode,n=e.graphicsBoxConNode,s=e.viewInfo,d=e.whiteboardNode;this.whiteboardID=t,this.conNode=i,this.zoomNode=o,this.userNode=o.parentNode,this.graphicsConNode=a,this.whiteboardNode=d,this.graphicsBoxConNode=n,this.serviceHandle=r,this.viewInfo=s,this.updateOffsetAndScrollHandle(),this.initDrawHandle()}return e.prototype.getTranslateXY=function(e){if(!e)return{x:0,y:0};var t=e.match(/translate\((-?\d*.?\d*)px(\,\s*(-?\d*.?\d*)px)?\)/);return{x:+t[1]||0,y:+t[3]||0}},e.prototype.clearRealTimeInterval=function(e){clearInterval(this.graphicExtraMap[e].realTimeId),delete this.graphicExtraMap[e]},e.prototype.realTimeHandle=function(e,t){var o,i,r=this,a=t.graphic_id,s=t.is_end_draw,h=t.operate_id,c=this.graphicList.find((function(e){return e.graphic_id==a&&e.operate_id==h}));if(c){var l=d.default.realTimeState,p=l.remoteDrawDelay,u=l.remoteDrawCount,g=l.remoteDrawEndDelay;s?s&&(null===(i=this.graphicExtraMap[a])||void 0===i?void 0:i.realTimeId)&&(this.clearRealTimeInterval(a),f.Logger.info(v("gra.remote_draw_realtime_end"),a)):this.graphicExtraMap[a]&&this.graphicExtraMap[a].realTimeId?(o=c.data).push.apply(o,t.data):(this.graphicExtraMap[a]=this.graphicExtraMap[a]||{},this.graphicExtraMap[a].realTimeIndex=0,this.graphicExtraMap[a].realTimeId=setInterval((function(t){var o,i=r.graphicList.find((function(e){return e.graphic_id===t}));if(i&&r.graphicExtraMap[t]){var a=i.data,s=r.graphicExtraMap[t].realTimeIndex>=a.length;s?s&&Date.now()-r.graphicExtraMap[t].realTimeLast>g&&(i.is_end_draw=!0,r.clearRealTimeInterval(t),f.Logger.info(v("gra.remote_draw_realtime_timeout"),t)):(r.graphicExtraMap[t].realTimeLast=Date.now(),(i=JSON.parse(JSON.stringify(i))).data=a.slice(0,r.graphicExtraMap[t].realTimeIndex+=u),e.drawGraphicsHandle(i,n.GraphicOperateType.Remote))}else!i&&(null===(o=r.graphicExtraMap[t])||void 0===o?void 0:o.realTimeId)&&(r.clearRealTimeInterval(t),f.Logger.info(v("gra.remote_draw_realtime_deleted"),t))}),p,a))}},e.prototype.createHandle=function(e,t,o){var i=e.graphic_id;if(!this.graphicList.some((function(e){return e.graphic_id===i})))switch(this.graphicList.push(e),e.type){case n.GraphicType.Text:t.drawGraphicsHandle(e,!1);break;default:o.drawGraphicsHandle(e,n.GraphicOperateType.UnReDo)}},e.prototype.moveHandle=function(e,t){var o=e.graphic_id,i=e.x,r=e.y,a=e.type;if(a===n.GraphicType.Image)this.assingImageGraphicData(e,n.Action.Move),t.updateGraphicsImage(e);else{this.setDataToGraphicList(o,{x:i,y:r});var s=a===n.GraphicType.Laser?""+1/this.viewInfo.zoom:void 0;this.moveGraphicsHandle(o,i,r,s)}},e.prototype.updateHandle=function(e,t,o){switch(e.type){case n.GraphicType.Text:t.backUpdateGraphicsHandle(e);break;case n.GraphicType.Image:this.assingImageGraphicData(e,n.Action.Update),o.updateGraphicsImage(e);break;case n.GraphicType.BgImage:this.background.remoteAddBackgroundImageGraphic(e)}},e.prototype.assingImageGraphicData=function(e,t){var o=e.graphic_id;this.graphicList.some((function(i){if(i.graphic_id===o){if(Object.assign(i.data,e.data),Object.assign(i.oldData,e.oldData),t===n.Action.Move)i.x=e.x,i.y=e.y,i.px=e.px,i.py=e.py;else if(t===n.Action.Update){var r=i.data,a=r.x,s=r.y;i.initX=a-i.x,i.initY=s-i.y}return!0}return!1}))},e.prototype.reverseGraphicByMove=function(e){if(e.x=[e.px||0,e.px=e.x][0],e.y=[e.py||0,e.py=e.y][0],e.type===n.GraphicType.Image){var t=e.data,o=t.ex-t.x,i=t.ey-t.y;t.x=e.x+(e.initX||0),t.y=e.y+(e.initY||0),t.ex=t.x+o,t.ey=t.y+i}},e.prototype.resetImageGraphicOrigin=function(e){var t=e.data,o=t.x,i=t.y;e.initX=o-e.x,e.initY=i-e.y},e.prototype.createUndoData=function(e){var t=this;if(!e.length)return[];var o=JSON.parse(JSON.stringify(e)),i=o[0],r=i.action,s=i.type,d=i.oldData,h=i.data;if(r===n.Action.Create||r===n.Action.Append||r===n.Action.Update)switch(s){case n.GraphicType.Text:var c=a.splitTextHandle(d).text,l=a.splitTextHandle(h).text;if(!c&&!l)return[];c?(i.action=l?n.Action.Update:n.Action.Create,i.data=d,i.oldData=h):i.action=n.Action.Delete;break;case n.GraphicType.Pencil:case n.GraphicType.Line:case n.GraphicType.Rect:case n.GraphicType.Ellipse:i.action=n.Action.Delete;break;case n.GraphicType.Image:r===n.Action.Create?i.action=n.Action.Delete:(i.data=d,i.oldData=h,this.resetImageGraphicOrigin(i));case n.GraphicType.BgImage:r===n.Action.Create?i.action=n.Action.Delete:(i.data=d,i.oldData=h)}else r===n.Action.Delete?o.forEach((function(e){e.action=n.Action.Create,e.type===n.GraphicType.Image&&t.resetImageGraphicOrigin(e)})):r===n.Action.Move&&o.forEach((function(e){return t.reverseGraphicByMove(e)}));return o.forEach((function(e){e.operate_id=a.createGraphicId(),e.is_end_draw=!0})),o},e.prototype.reverseData=function(e){var t=this;e.length&&e.forEach((function(e){var o=e.action,i=e.data,r=e.oldData;switch(o){case n.Action.Create:e.action=n.Action.Delete;break;case n.Action.Delete:e.action=n.Action.Create;break;case n.Action.Move:t.reverseGraphicByMove(e);break;case n.Action.Update:e.data=r,e.oldData=i}e.operate_id=a.createGraphicId(),e.is_end_draw=!0}))},e.prototype.createBackground=function(e,t){this.background||(this.background=new g.Background(this,e)),t&&this.background.createContainer(e)},e.prototype.triggerAnimateHandle=function(e,t){t===n.GraphicOperateType.Remote?e.classList.add("transition"):e.classList.remove("transition")},e.prototype.transLocationHandle=function(e,t){var o=e.clientX,i=e.clientY,r=this.offsetData,a=r.offsetLeft,n=r.offsetTop,s=this.scrollData,d=s.scrollLeft,h=s.scrollTop,c=this.viewInfo,l=c.zoom,p=c.zoomTX,u=c.zoomTY,g={clientX:(o-a+d-p)/l+c.offsetPageX,clientY:(i-n+h-u)/l+c.offsetPageY};return t||(g.clientX=Math.round(g.clientX),g.clientY=Math.round(g.clientY)),g},e.prototype.transLocationOrigin=function(e){var t=e.clientX,o=e.clientY,i=this.viewInfo,r=i.offsetPageX,a=i.offsetPageY,n=i.zoom,s=this.whiteboardNode.parentNode,d=s.scrollLeft,h=s.scrollTop;return{clientX:Math.round(t+d/n+r),clientY:Math.round(o+h/n+a)}},e.prototype.bindEventsHandle=function(e){this.initDrawHandle();var t=this.instancesMap[e];t&&t.bindEventsHandle()},e.prototype.removeEventsHandle=function(e){var t=this.instancesMap[e];t&&t.removeEventsHandle()},e.prototype.moveGraphicsHandle=function(e,t,o,i){var r=this.getGraphicsHandle(e);if(r)if("g"===r.tagName){var n=a.getElementChild(r)[0];i=(i=n.getAttribute("transform")||"")&&i.includes("scale(")?i.replace(/.*(scale\(\d+(.\d+)?,(\s*)?\d+(.\d+)?\)).*/," $1"):"",n.setAttribute("transform","translate("+(t||0)+", "+(o||0)+")"+i)}else{var s="translate("+(t||0)+"px, "+(o||0)+"px)",d=r.style.transform.match(/scale\((\d*.?\d*)\)/),h=d?d[1]:"";!i&&h?s=s+" scale("+h+")":i&&(s=s+" scale("+i+")"),r.style.transform=s}},e.prototype.getGraphicsHandle=function(e,t){void 0===t&&(t=this.userNode);var o=t.querySelector("#"+d.default.reservedPrefix.graphics+e);return o&&(o=o.parentNode),o},e.prototype.batchGetGraphicsHandle=function(e,t){return void 0===e&&(e=this.userNode),e.querySelectorAll("[id^="+t+"]")},e.prototype.getBoxSelHandle=function(e){return"#"+d.default.reservedPrefix.graphicsBox+e},e.prototype.updateOffsetAndScrollHandle=function(){this.offsetData=a.getOffsetData(this.conNode),this.scrollData=a.getScrollData(this.conNode)},e.prototype.updateGraphicsOffsetHandle=function(e,t,o){var i=e.x,r=e.y;e.x=i+t,e.y=r+o},e.prototype.calMoveHandle=function(){var e=this.mousePoints,t=e.sx,o=e.sy,i=e.ex,r=e.ey;return-1!==t&&-1!==o?(this.mousePoints.boxX+=i-t,this.mousePoints.boxY+=r-o,[i-t,r-o]):[0,0]},e.prototype.updateMousePointsHandle=function(e,t){null==e||null==t?this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0}:(-1!==this.mousePoints.ex&&-1!==this.mousePoints.ey&&(this.mousePoints.sx=this.mousePoints.ex,this.mousePoints.sy=this.mousePoints.ey),this.mousePoints.ex=e,this.mousePoints.ey=t)},e.prototype.updateToRemoteNewHandle=function(e,t,o,i,r,s){if(void 0===o&&(o=!0),e.length){var d=a.transGraphicsData(e,t);if((!i||!i.isUndoAndRedo)&&(this.redoList.length=0),o){var h=this.graphicTaskList.length,c={taskStatus:h?n.TaskStatus.Pending:n.TaskStatus.InProgress,graphicList:d};!h&&this.graphicTaskList.push(c),this.syncUpdateToRemoteQueue(c)}else this.unSyncUpdateToRemoteQueue(d,i,r,s)}},e.prototype.unSyncUpdateToRemoteQueue=function(e,t,o,i){var r=this;this.serviceHandle.updateToRemoteHandle(this.whiteboardID,e,(function(){if(!t||!t.isUndoAndRedo){var i=r.createUndoData(e);r.undoList.push(i)}o&&o()}),(function(e){r.serviceHandle.actionCustomListener(n.ZegoEventType.Error,e),i&&i(e)}))},e.prototype.syncUpdateToRemoteQueue=function(e){var t=this;e.taskStatus===n.TaskStatus.Pending?-1===this.graphicTaskList.findIndex((function(e){return e.taskStatus===n.TaskStatus.Pending}))?this.graphicTaskList.push(e):this.mergegGraphicTaskList(e):this.serviceHandle.updateToRemoteHandle(this.whiteboardID,e.graphicList,(function(){t.graphicTaskCallbackHandle(n.ResultType.success)}),(function(e){t.graphicTaskCallbackHandle(n.ResultType.error,e)}))},e.prototype.filterUndoAndRedo=function(e){var t=this;return e.filter((function(e){var o=e.action,i=e.graphic_id,r=t.graphicList.some((function(e){return e.graphic_id===i}));return!r&&o===n.Action.Create||r&&(o===n.Action.Delete||o===n.Action.Move||o===n.Action.Update||o===n.Action.Append)}))},e.prototype.undoNewHandle=function(){var e=this;if((!this.graphicTaskList[0]||this.graphicTaskList[0].taskStatus!==n.TaskStatus.InProgress)&&this.canDo){var t=this.undoList.length;if(t){var o=this.filterUndoAndRedo(this.undoList[t-1]);o.length?(this.canDo=!1,this.updateToRemoteNewHandle(o,void 0,!1,{isUndoAndRedo:!0},(function(){e.undoList.pop();var t=JSON.parse(JSON.stringify(o));e.updateLocalHandle(t),e.reverseData(t),e.redoList.push(t),e.canDo=!0}),(function(t){e.canDo=!0}))):this.undoList.pop()}}},e.prototype.redoNewHandle=function(){var e=this;if((!this.graphicTaskList[0]||this.graphicTaskList[0].taskStatus!==n.TaskStatus.InProgress)&&this.canDo){var t=this.redoList.length;if(t){var o=this.filterUndoAndRedo(this.redoList[t-1]);o.length?(this.canDo=!1,this.updateToRemoteNewHandle(o,void 0,!1,{isUndoAndRedo:!0},(function(){e.redoList.pop();var t=JSON.parse(JSON.stringify(o));e.updateLocalHandle(t),e.reverseData(t),e.undoList.push(t),e.canDo=!0}),(function(t){e.canDo=!0}))):this.redoList.pop()}}},e.prototype.findLastTaskIndex=function(e,t){var o=this.graphicTaskList.slice(1);o.reverse();var i=o.findIndex((function(o){return o.graphicList[0][e]===t}));return-1!==i?o.length-i:-1},e.prototype.mergeMoveActionTaskList=function(e){var t=e.graphicList[0].operate_id,o=this.findLastTaskIndex("operate_id",t);-1===o?this.graphicTaskList.push(e):this.graphicTaskList.splice(o+1,1,e)},e.prototype.mergeOtherActionTaskList=function(e){switch(e.graphicList[0].type){case n.GraphicType.Text:this.mergeTextTaskList(e);break;case n.GraphicType.Pencil:this.mergePathTaskList(e);break;case n.GraphicType.Ellipse:case n.GraphicType.Rect:case n.GraphicType.Line:case n.GraphicType.Image:case n.GraphicType.BgImage:this.mergeOtherTaskList(e)}},e.prototype.mergeLaserTaskList=function(e){var t=e.graphicList[0],o=t.action,i=t.graphic_id;if(o===n.Action.Move){var r=this.findLastTaskIndex("graphic_id",i);-1===r?this.graphicTaskList.push(e):this.graphicTaskList.splice(r,1,e)}else this.graphicTaskList.push(e)},e.prototype.mergeTextTaskList=function(e){var t=e.graphicList[0].operate_id;this.findLastTaskIndex("operate_id",t);this.graphicTaskList.push(e)},e.prototype.mergePathTaskList=function(e){var t=e.graphicList[0],o=t.operate_id,i=t.action,r=this.findLastTaskIndex("operate_id",o);if(-1===r)this.graphicTaskList.push(e);else{var a=this.graphicTaskList[r];a.graphicList[0].action===n.Action.Create||i===n.Action.Update?this.graphicTaskList.push(e):a.graphicList.forEach((function(t,o){t.data=t.data.concat(e.graphicList[o].data)}))}},e.prototype.mergeOtherTaskList=function(e){var t=e.graphicList[0].operate_id,o=this.findLastTaskIndex("operate_id",t);-1===o?this.graphicTaskList.push(e):this.graphicTaskList[o].graphicList[0].action===n.Action.Create?this.graphicTaskList.push(e):this.graphicTaskList.splice(o,1,e)},e.prototype.mergegGraphicTaskList=function(e){var t=e.graphicList[0],o=t.action;t.type===n.GraphicType.Laser?this.mergeLaserTaskList(e):o===n.Action.Move?this.mergeMoveActionTaskList(e):this.mergeOtherActionTaskList(e)},e.prototype.graphicTaskCallbackHandle=function(e,t){var o=this.graphicTaskList[0];if(o)if(o.taskStatus===n.TaskStatus.InProgress){var i=o.graphicList[0],r=i.is_end_draw,a=i.type;if(r)if(e===n.ResultType.success){if(a!==n.GraphicType.Laser&&a!==n.GraphicType.BgImage){var s=this.createUndoData(o.graphicList);this.undoList.push(s)}}else{if(a!==n.GraphicType.Laser){s=this.createUndoData(o.graphicList);this.updateLocalHandle(s)}this.serviceHandle.actionCustomListener(n.ZegoEventType.Error,t)}else e===n.ResultType.error&&this.serviceHandle.actionCustomListener(n.ZegoEventType.Error,t);this.graphicTaskList.shift();var d=this.graphicTaskList[0];d&&(d.taskStatus=n.TaskStatus.InProgress)&&this.syncUpdateToRemoteQueue(d)}else o.taskStatus=n.TaskStatus.InProgress,this.syncUpdateToRemoteQueue(o)},e.prototype.updateLocalHandle=function(e){var t=this;f.Logger.info(v("gra.draw_local"),JSON.stringify(e)),this.updateOffsetAndScrollHandle();var o=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),i=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),r=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);r.hideImageEditBox(),r.hideSelectBox(),e.forEach((function(e){switch(e.action){case n.Action.Delete:t.deleteHandle(e.graphic_id,e.type);break;case n.Action.Create:e.type==n.GraphicType.BgImage||(t.createHandle(e,o,i),t.updateBoxHandle(e));break;case n.Action.Move:t.moveHandle(e,i),t.updateBoxHandle(e);break;case n.Action.Update:e.type==n.GraphicType.BgImage?t.updateHandle(e,o,i):(t.updateHandle(e,o,i),t.updateBoxHandle(e))}}))},e.prototype.updatePushLocalHandle=function(e,t){var o=this;f.Logger.info(v("gra.remote_draw"),JSON.stringify({graphicList:e,delGraphicList:t,actionMsg:"transValue"})),this.updateOffsetAndScrollHandle(),e.sort((function(e,t){return(e.zorder||0)-(t.zorder||0)})),t.forEach((function(e){return o.deleteHandle(e)}));var r=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser],a=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText],s=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine],h=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector];h&&h.updateSelectorBoxHandle(e,t),e.forEach((function(e){var t=e.graphic_id,h=e.type,c=o.graphicList.some((function(o){return t===o.graphic_id&&(e.type!==n.GraphicType.RealTime&&(Object.assign(o,e),h===n.GraphicType.Image&&Object.assign(o.data,e.data)),!0)}));c||(h===n.GraphicType.Image&&(e.oldData=i({},e.data)),o.graphicList.push(e));var l="#"+d.default.reservedPrefix.graphicsBox+t;switch(c=c&&!!o.whiteboardNode.querySelector(l),h){case n.GraphicType.Laser:r.drawGraphicsHandle(e,!1);break;case n.GraphicType.Text:c?a.updateGraphicsHandle(e):a.drawGraphicsHandle(e,!1),o.updateBoxHandle(e);break;default:h===n.GraphicType.RealTime?o.realTimeHandle(s,e):(c?(h===n.GraphicType.Pencil&&e.is_end_draw&&o.graphicExtraMap[t]&&(o.clearRealTimeInterval(t),f.Logger.info(v("gra.remote_draw_realtime_end"),t)),s.updateGraphicsHandle(e)):s.drawGraphicsHandle(e,n.GraphicOperateType.Remote),o.updateBoxHandle(e))}}))},e.prototype.deleteHandle=function(e,t){var o;if(t==n.GraphicType.BgImage)this.background.updateToLocal(!0).clearBackgroundImage();else{a.removeElement(this.getBoxHandle(e));var i=this.getGraphicsHandle(e);a.removeElement("g"===(null==i?void 0:i.tagName)?i.parentNode:i);var r=this.graphicList.findIndex((function(t){return t.graphic_id===e}));if(-1!==r){var s=null===(o=this.graphicExtraMap[e])||void 0===o?void 0:o.realTimeId;s&&clearInterval(s),this.graphicList.splice(r,1)}}},e.prototype.updateBoxHandle=function(e,t){if(e.type===n.GraphicType.Laser)return null;var o=this.getBoxInfoByGraphic(e);if(!o)return null;var i=o.x,r=o.y,a=o.width,s=o.height,h=e.type,c=e.graphic_id,l=e.selected,p=e.zorder,u=this.getBoxHandle(c);if(!u){(u=document.createElement("div")).setAttribute("id",""+d.default.reservedPrefix.graphicsBox+c),h===n.GraphicType.Text&&(u.style.pointerEvents="initial");var g=null;if(p)for(var f=this.graphicsBoxConNode.querySelectorAll("[data-z]"),v=0;v<f.length;v++)if(+(f[v].getAttribute("data-z")||"")>p){g=f[v];break}this.graphicsBoxConNode.insertBefore(u,g),p&&this.updateGraphicsDomIndex(p)}var m="width:"+a+"px;height:"+s+"px;border:"+(l&&!0!==t?d.default.selectedBorderCss:d.default.unSelectedBorderCss)+";";return"blur"!==t&&(m+="left:"+i+"px;top:"+r+"px;"),u.style.cssText+=m,p&&u.setAttribute("data-z",p+""),u},e.prototype.updateBoxBorder=function(e,t){if(e.type!==n.GraphicType.Laser){var o=this.getBoxHandle(e.graphic_id);o&&(o.style.border=e.selected&&!t?d.default.selectedBorderCss:d.default.unSelectedBorderCss)}},e.prototype.updateGraphicsDomIndex=function(e){var t=this,o=Array.from(this.graphicsBoxConNode.querySelectorAll('[data-z="'+e+'"]')).map((function(e){return e.id.replace(/\D/g,"")}));if(o.length>1){var i=Array.from(this.graphicsConNode.querySelectorAll('[data-z="'+e+'"]')),r=i.map((function(e){return e.id.replace(/\D/g,"")}));if(o.join()!==r.join()){var a=i[i.length-1].nextSibling;o.forEach((function(e){t.graphicsConNode.insertBefore(i[r.findIndex((function(t){return t===e}))],a)}))}}},e.prototype.getInstanceHandle=function(e){var t=this.instancesMap[e];if(!t){switch(e){case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser:t=new h.Laser(this);break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine:t=new c.SvgGraphics(this);break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText:t=new l.TextareaGraphics(this);break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser:t=new p.Eraser(this);break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector:t=new u.Selector(this)}this.instancesMap[e]=t}return t},e.prototype.getUserID=function(){return this.serviceHandle.getUserID()},e.prototype.getUserAuth=function(){return this.serviceHandle.getUserAuth()},e.prototype.getBoxHandle=function(e){var t=this.getBoxSelHandle(e);return this.userNode.querySelector(t)},e.prototype.setGraphicsDomZorder=function(e){var t=e.graphic_id,o=e.type,i=e.zorder,r=d.default.reservedPrefix,a=r.textareaCon,s=r.graphicsSvg,h=r.graphicsBox,c=o===n.GraphicType.Text?"#"+a+t:"#"+s+t,l=this.whiteboardNode.querySelector(c);l&&i&&l.setAttribute("data-z",i+""),c="#"+h+t,(l=this.whiteboardNode.querySelector(c))&&i&&l.setAttribute("data-z",i+"")},e.prototype.appendGraphicsDomHandle=function(e,t){if(n.GraphicType.Laser===t)this.graphicsConNode.appendChild(e);else{var o=+(e.getAttribute("data-z")||"");if(o)for(var i=this.graphicsConNode.querySelectorAll("[data-z]"),r=0;r<i.length;r++)if(+(i[r].getAttribute("data-z")||"")>o)return void this.graphicsConNode.insertBefore(e,i[r]);var a=this.graphicsConNode.querySelector("[id^="+d.default.reservedPrefix.laserCon+"]");this.graphicsConNode.insertBefore(e,a)}},e.prototype.getImageDomHandle=function(e){var t=d.default.reservedPrefix,o=t.graphics,i=t.graphicsBox;return[this.userNode.querySelector("#"+o+e),this.userNode.querySelector("#"+i+e)]},e.prototype.appendImageDomHandle=function(e,t){var o=d.default.reservedPrefix,i=o.graphicsSvg,r=o.graphics,a=o.laserCon,n=o.graphicsBox,s=document.createElementNS("http://www.w3.org/2000/svg","g"),h=document.createElementNS("http://www.w3.org/2000/svg","image");h.id=""+r+e,s.appendChild(h);var c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.id=""+i+e,c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("version","1.1"),c.appendChild(s);var l=document.createElement("div");if(l.id=""+n+e,t){c.setAttribute("data-z",t+""),l.setAttribute("data-z",t+"");for(var p=this.graphicsConNode.querySelectorAll("[data-z]"),u=0;u<p.length;u++)if(+(p[u].getAttribute("data-z")||"")>t){this.graphicsConNode.insertBefore(c,p[u]);var g=this.graphicsBoxConNode.querySelectorAll("[data-z]")[u];return void this.graphicsBoxConNode.insertBefore(l,g)}}var f=this.graphicsConNode.querySelector("[id ^= "+a+"]");this.graphicsConNode.insertBefore(c,f),this.graphicsBoxConNode.appendChild(l)},e.prototype.resetImageBox=function(){var e=this;this.graphicList.forEach((function(t){if(t.type===n.GraphicType.Image){var o=e.getBoxHandle(t.graphic_id),i=t.y+(t.initY||0);o&&Math.abs(Number(o.style.top.replace("px",""))-i)>3&&e.updateBoxHandle(t)}}))},e.prototype.checkMultipointHandle=function(e){return e.touches.length>1},e.prototype.downCommonHandle=function(e){if(window.TouchEvent&&e instanceof TouchEvent){if(this.checkMultipointHandle(e))return!1;"touchstart"!==e.type&&e.preventDefault()}else if(e instanceof MouseEvent&&(e.button||"mouseup"!==e.type&&!e.buttons))return!1;return this.updateOffsetAndScrollHandle(),!0},e.prototype.updateProtoGraphic=function(e){if(e)Object.assign(this.protoGraphic,e);else{var t=d.default.basicState.type;this.protoGraphic=i(i({zorder:0,graphic_id:"",data:[],oldData:"",selected:!1,x:0,y:0,px:0,py:0},d.default.basicState),{type:t,operate_id:"",is_end_draw:!0})}},e.prototype.updateGraphicsDataHandle=function(e){var t=null;switch(this.protoGraphic.type){case n.GraphicType.Pencil:(t=this.protoGraphic.data)[t.length-2]===e.clientX&&t[t.length-1]===e.clientY||(t.push(e.clientX),t.push(e.clientY));break;case n.GraphicType.Image:(t=this.protoGraphic.data).ex=e.clientX,t.ey=e.clientY;break;default:(t=this.protoGraphic.data).splice(2,2,e.clientX,e.clientY)}},e.prototype.initDrawHandle=function(){this.updateProtoGraphic(),this.updateMousePointsHandle()},e.prototype.getBoxInfoByGraphic=function(e){var t=e.type,o=e.graphic_id,i=this.getGraphicsHandle(o);if(!i)return null;var r=a.isFloatGraphic(e),s=t===n.GraphicType.Text||t===n.GraphicType.Image?0:e.size||d.default.basicState.size,h=this.viewInfo,c=h.zoom,l=h.offsetPageY,p=h.isScroll,u=d.default.boxBorderWidth,g=i.getBoundingClientRect(),f=g.left,v=g.top,m=g.width,b=g.height;!p&&v>l&&(v-=l);var y=this.transLocationHandle({clientX:f,clientY:v},r),w=y.clientX,x=y.clientY;return{x:f=Math.floor(w-u-s/2),y:v=Math.floor(x-u-s/2),width:m=Math.ceil(m/c+s+u),height:b=Math.ceil(b/c+s+u)}},e.prototype.getMouseStartPoint=function(e,t){var o;if(e instanceof MouseEvent){var i=e,r=i.clientX,a=i.clientY;o=this.transLocationHandle({clientX:r,clientY:a},t)}else{var n=e.touches[0];r=n.clientX,a=n.clientY;o=this.transLocationHandle({clientX:r,clientY:a},t)}return o},e.prototype.getMouseChangedPoint=function(e,t){var o;if(e instanceof MouseEvent){var i=e,r=i.clientX,a=i.clientY;o=this.transLocationHandle({clientX:r,clientY:a},t)}else{var n=e.changedTouches[0];r=n.clientX,a=n.clientY;o=this.transLocationHandle({clientX:r,clientY:a},t)}return o},e.prototype.getWhiteboardNodeRect=function(){var e=this.offsetData,t=e.offsetLeft,o=e.offsetTop,i=this.viewInfo,r=i.zoom,a=i.viewWidth,n=i.viewHeight;return r>1?{left:t,top:o,right:t+a,bottom:o+n}:this.whiteboardNode.getBoundingClientRect()},e.prototype.isTouchLeaveWhenMove=function(e,t){if(d.default.isTouch&&window.TouchEvent&&e instanceof TouchEvent){var o=e.changedTouches[0],i=o.clientX,r=o.clientY,a=t.left,n=t.right,s=t.top,h=t.bottom;return i<=a||i>=n||r<=s||r>=h}return!1},e.prototype.setDataToGraphicList=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];for(var i=0,a=this.graphicList.length;i<a;i++){var n=this.graphicList[i];if(e===n.graphic_id){Object.assign.apply(Object,r([n],t));break}}},e.prototype.getDataFromGraphicList=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];for(var i={},r=function(o,r){var n=a.graphicList[o];if(e===n.graphic_id)return t.forEach((function(e){i[e]=n[e]})),"break"},a=this,n=0,s=this.graphicList.length;n<s;n++){var d=r(n,s);if("break"===d)break}return i},e.prototype.filterExistingHandle=function(e){var t=this;return e.filter((function(e){var o=e.graphic_id;return e.action===n.Action.Create||t.graphicList.some((function(e){return e.graphic_id===o}))}))},e.prototype.clearLocalHandle=function(){this.graphicTaskList.length=0;var e=d.default.basicState.type;if(e!==n.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick&&!e){var t=this.getInstanceHandle(e===n.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen||e===n.ZegoWhiteboardTool.ZegoWhiteboardViewToolRect||e===n.ZegoWhiteboardTool.ZegoWhiteboardViewToolEllipse||e===n.ZegoWhiteboardTool.ZegoWhitebaordViewToolCustomImage?n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine:e);t.removeEventsHandle(),t.bindEventsHandle()}this.undoList.length=0,this.redoList.length=0;var o=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),i=o.findLaserHandle(),r=this.graphicList.find((function(e){return e.type===n.GraphicType.BgImage}));this.graphicList.length=0,r&&this.graphicList.push(r),this.graphicsConNode.innerHTML="",i&&o.addLaserHandle(i)},e.prototype.reverseZoomHandle=function(e){var t=this;if(e===n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser){var o=this.viewInfo.zoom;this.batchGetGraphicsHandle(this.graphicsConNode,d.default.reservedPrefix.laserCon).forEach((function(e){var i=e.style.transform,r=t.getTranslateXY(i),a=r.x,n=r.y;e.style.transform="translate("+a+"px, "+n+"px) scale("+1/o+")"}))}},e.prototype.getGraphicIsEndDraw=function(e){return this.serviceHandle.getGraphicIsEndDraw(e)},e.prototype.clearPage=function(e){this.enableDraw&&(this.updateGraphicPage(),this.graphicList.forEach((function(t){var o;t.selected=null===(o=t.page)||void 0===o?void 0:o.includes(e)})),this.deleteSelectedGraphics(n.DeleteGraphicAction.ClearPage))},e.prototype.deleteSelectedGraphics=function(e){var t=this;if(this.enableDraw){var o=this.getUserID(),i=this.getUserAuth().delete,r=0,s=0,d=this.graphicList.filter((function(e){var a=!!e.selected&&e.type!==n.GraphicType.BgImage&&t.getGraphicIsEndDraw(e.graphic_id),d=i||o===e.creator_id;return a&&r++,a&&d&&s++,a&&d}));if(r!==s&&this.sendError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthDeleteGraphic),d.length){var h=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);h.hideImageEditBox(),h.hideSelectBox(),d.forEach((function(e){e.is_end_draw=!0,e.operate_id=a.createGraphicId(),t.deleteHandle(e.graphic_id)})),f.Logger.info(v("mod.deleteSelectedGraphics"),JSON.stringify({action:e,page:this.viewInfo.page,params:d.map((function(e){return e.graphic_id+","+e.page}))})),this.updateToRemoteNewHandle(d,n.Action.Delete)}}},e.prototype.updateGraphicPage=function(){var e=this,t=this.graphicList.filter((function(t){return e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id))}));this.viewInfo.vpageAspecCache?t.forEach((function(t){var o=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),i=o||{offsetTop:0,offsetHeight:0},r=i.offsetTop,a=i.offsetHeight,n=e.getPageByAspec(r,r+a);t.page=n||[e.viewInfo.page||1]})):!this.serviceHandle.getFileInfo(this.whiteboardID)&&this.conNode?t.forEach((function(t){var o=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),i=[];if(1===e.viewInfo.direction){var r=o||{offsetLeft:0,offsetWidth:0},a=r.offsetLeft,n=r.offsetWidth;i=e.getPageByViewInfo(a,a+n,e.viewInfo.viewWidth)}else{var s=o||{offsetTop:0,offsetHeight:0},d=s.offsetTop,h=s.offsetHeight;i=e.getPageByViewInfo(d,d+h,e.viewInfo.viewHeight)}t.page=i||[e.viewInfo.page||1]})):this.graphicList.forEach((function(t){t.page=[e.viewInfo.page||1]}))},e.prototype.getPageByAspec=function(e,t){var o=this.viewInfo.vpageAspecCache;if(!o.hasOwnProperty("2"))return[1];for(var i=o.vs,a=o[i].h;a<=e&&o[i+1];)a+=o[i+1].h,i++;for(var n=i;a<=t&&o[n+1];)a+=o[n+1].h,n++;if(n===i)return[o[i].p];if(n-i>1){var s=new Array(n-i-1).fill(null);return s=s.map((function(e,t){return o[i+t+1].p})),r([o[i].p],s,[o[n].p])}return[o[i].p,o[n].p]},e.prototype.getPageByViewInfo=function(e,t,o){var i=Math.floor(e/o)+1,a=Math.floor(t/o)+1;if(a===i)return[i];if(a-i>1){var n=new Array(a-i-1).fill(null).map((function(e,t){return i+t+1}));return r([i],n,[a])}return[i,a]},e.prototype.toolAddEL=function(e,t,o){e.addEventListener(t,o);var i=d.default.mouseEvents[t];i&&e.addEventListener(i,o)},e.prototype.toolRmEl=function(e,t,o){e.removeEventListener(t,o);var i=d.default.mouseEvents[t];i&&e.removeEventListener(i,o)},e.prototype.sendError=function(e,t,o){var i=s.transError(e,t,o);return this.serviceHandle.actionCustomListener(n.ZegoEventType.Error,i),i},e.prototype.updateOffsetPage=function(){var e=this.viewInfo,t=e.page,o=e.viewWidth,i=e.viewHeight,r=e.direction;e.isScroll||(r===n.ZegoWhiteboardViewScrollDirection.Horizontal?this.viewInfo.offsetPageX=(t-1)*o:this.viewInfo.offsetPageY=(t-1)*i)},e}();t.Tool=m},function(e,t,o){var i;!function(){"use strict";function r(e,t,o){var i=t.x,r=t.y,a=o.x-i,n=o.y-r;if(0!==a||0!==n){var s=((e.x-i)*a+(e.y-r)*n)/(a*a+n*n);s>1?(i=o.x,r=o.y):s>0&&(i+=a*s,r+=n*s)}return(a=e.x-i)*a+(n=e.y-r)*n}function a(e,t){var o=e.length-1,i=[e[0]];return function e(t,o,i,a,n){for(var s,d=a,h=o+1;h<i;h++){var c=r(t[h],t[o],t[i]);c>d&&(s=h,d=c)}d>a&&(s-o>1&&e(t,o,s,a,n),n.push(t[s]),i-s>1&&e(t,s,i,a,n))}(e,0,o,t,i),i.push(e[o]),i}function n(e,t,o){if(e.length<=2)return e;var i=void 0!==t?t*t:1;return e=a(e=o?e:function(e,t){for(var o,i,r,a,n,s=e[0],d=[s],h=1,c=e.length;h<c;h++)o=e[h],r=s,a=void 0,n=void 0,a=(i=o).x-r.x,n=i.y-r.y,a*a+n*n>t&&(d.push(o),s=o);return s!==o&&d.push(o),d}(e,i),i)}void 0===(i=function(){return n}.call(t,o,t,e))||(e.exports=i)}()},function(e,t,o){e.exports=function(e,t){var o,i,r,a,n,s,d,h;for(o=3&e.length,i=e.length-o,r=t,n=3432918353,s=461845907,h=0;h<i;)d=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24,++h,r=27492+(65535&(a=5*(65535&(r=(r^=d=(65535&(d=(d=(65535&d)*n+(((d>>>16)*n&65535)<<16)&4294967295)<<15|d>>>17))*s+(((d>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(d=0,o){case 3:d^=(255&e.charCodeAt(h+2))<<16;case 2:d^=(255&e.charCodeAt(h+1))<<8;case 1:r^=d=(65535&(d=(d=(65535&(d^=255&e.charCodeAt(h)))*n+(((d>>>16)*n&65535)<<16)&4294967295)<<15|d>>>17))*s+(((d>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(2),a=o(0),n=o(1),s=function(){function e(e){var t=this;this.bindFlag=!1,this.authFlag=!0,this.laserInfo={hiddenX:-100,hiddenY:-100,initX:0,initY:0,touchLeaveRect:{left:0,top:0,right:0,bottom:0}},this.mousemoveHandle=function(e){if(t.toolInstance.enableDraw){if(!t.toolInstance.getUserAuth().create)return t.authFlag&&t.toolInstance.sendError(a.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic),void(t.authFlag=!1);if(window.TouchEvent&&e instanceof TouchEvent&&e.preventDefault(),t.laserInfo.touchLeaveRect.right||(t.laserInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect()),t.toolInstance.isTouchLeaveWhenMove(e,t.laserInfo.touchLeaveRect))t.mouseleaveHandle();else{t.toolInstance.updateOffsetAndScrollHandle();var o=t.getMouseChangedPoint(e),i=t.addLaserHandle(void 0,o);i.x=o.clientX,i.y=o.clientY,i.is_end_draw=!0,i.operate_id=r.createGraphicId(),t.drawGraphicsHandle(i,!0),t.toolInstance.updateToRemoteNewHandle([t.calLaserActualPlaceHandle(i)],a.Action.Move)}}},this.mouseleaveHandle=function(){t.authFlag=!0,t.laserHiddenHandle()},this.wheelHandle=function(e){var o;e.preventDefault();var i=t.toolInstance.whiteboardID,r=n.default.reservedPrefix.whiteboard,a=null===(o=document.querySelector("#"+r+i))||void 0===o?void 0:o.parentNode,s=a.getBoundingClientRect(),d=s.width;s.height!==a.scrollHeight&&(a.scrollTop+=Number(e.deltaY.toFixed(7))),d!==a.scrollWidth&&(a.scrollLeft+=Number(e.deltaX.toFixed(7)))},this.toolInstance=e,this.laserContainerNode=this.addLaserConDomHandle(),this.updateZIndexHandle(-1)}return e.prototype.transLocationHandle=function(e){var t=e.clientX,o=e.clientY,i=this.toolInstance,r=i.offsetData,a=i.scrollData,n=r.offsetLeft,s=r.offsetTop,d=a.scrollTop,h=a.scrollLeft,c=this.toolInstance.conNode,l=c.scrollLeft,p=c.scrollTop;return{clientX:Math.round(t-n+h-l),clientY:Math.round(o-s+d-p)}},e.prototype.getMouseChangedPoint=function(e){var t;if(e instanceof MouseEvent){var o=e,i=o.clientX,r=o.clientY;t=this.transLocationHandle({clientX:i,clientY:r})}else{var a=e.changedTouches[0];i=a.clientX,r=a.clientY;t=this.transLocationHandle({clientX:i,clientY:r})}return t},e.prototype.laserHiddenHandle=function(e){var t=this.findLaserHandle(e);if(t){var o=this.laserInfo,i=o.hiddenX,n=o.hiddenY;Object.assign(t,{x:i,y:n,px:0,py:0}),this.toolInstance.moveGraphicsHandle(t.graphic_id,i,n),e||(t.is_end_draw=!0,t.operate_id=r.createGraphicId(),this.toolInstance.updateToRemoteNewHandle([t],a.Action.Move))}},e.prototype.addLaserHandle=function(e,t){var o=this.toolInstance.graphicList;if(!e){var s=this.findLaserHandle();if(s)return s;var d=this.laserInfo,h=d.initX,c=d.initY,l=d.hiddenX,p=d.hiddenY;e=i(i({graphic_id:r.createGraphicId(),creator_id:this.toolInstance.getUserID()},n.default.basicState),{type:a.GraphicType.Laser,x:l,y:p,px:0,py:0,data:[h,c],zorder:this.toolInstance.serviceHandle.createZorder()})}return(e=e).operate_id=r.createGraphicId(),e.is_end_draw=!0,o.push(e),this.drawGraphicsHandle(e,!0),this.toolInstance.updateToRemoteNewHandle([this.calLaserActualPlaceHandle(e)],a.Action.Create),e},e.prototype.findLaserHandle=function(e){var t=this.toolInstance.getUserID();return this.toolInstance.graphicList.find((function(o){return e?o.graphic_id===e:o.type===a.GraphicType.Laser&&o.creator_id===t}))},e.prototype.addLaserConDomHandle=function(){var e=this.toolInstance.whiteboardID,t=""+n.default.reservedPrefix.laserContainer+e,o=this.toolInstance.userNode.querySelector("#"+t);return o||((o=document.createElement("div")).id=t,this.toolInstance.zoomNode.appendChild(o),this.updateLaserConSize(o),o)},e.prototype.updateZIndexHandle=function(e){this.laserContainerNode.style.zIndex=""+e,this.laserContainerNode.style.visibility=-1===e?"hidden":"visible"},e.prototype.drawGraphicsHandle=function(e,t){var o=this.toolInstance.getUserID(),i=e.graphic_id,r=e.data,s=e.creator_id,d=e.x,h=e.y;if(s===o&&!t){t=!0;var c=this.calLaserPlaceHandle(d,h),l=c.x,p=c.y;e.x=l,e.y=p,d=l,h=p}var u=n.default.reservedPrefix,g=""+u.graphics+i,f=""+u.laserCon+i,v=this.toolInstance.userNode.querySelector("#"+g);if(!v){v=document.createElement("div");var m=document.createElement("div");v.id=g,m.id=f,m.appendChild(v),t?this.laserContainerNode.appendChild(m):this.toolInstance.appendGraphicsDomHandle(m,a.GraphicType.Laser)}var b="transform:translate("+(d||0)+"px, "+(h||0)+"px)"+(t?";":"scale("+1/this.toolInstance.viewInfo.zoom+");")+"left:"+r[0]+"px;top:"+r[1]+"px;";v.parentNode.style.cssText=b},e.prototype.bindEventsHandle=function(){if(this.updateZIndexHandle("initial"),!this.bindFlag){this.bindFlag=!0;var e=n.default.mouseEvents;this.toolInstance.toolAddEL(this.laserContainerNode,e.move,this.mousemoveHandle),this.toolInstance.toolAddEL(this.laserContainerNode,e.leave,this.mouseleaveHandle),this.toolInstance.viewInfo.isScroll&&this.laserContainerNode.addEventListener("wheel",this.wheelHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1,this.updateZIndexHandle(-1);var e=n.default.mouseEvents;this.toolInstance.toolRmEl(this.laserContainerNode,e.move,this.mousemoveHandle),this.toolInstance.toolRmEl(this.laserContainerNode,e.leave,this.mouseleaveHandle),this.laserContainerNode.removeEventListener("wheel",this.wheelHandle)}},e.prototype.calLaserActualPlaceHandle=function(e){var t=(e=JSON.parse(JSON.stringify(e))).x,o=e.y,i=this.toolInstance.viewInfo,r=i.zoom,a=i.zoomTX,n=i.zoomTY,s=i.offsetPageX,d=i.offsetPageY,h=this.toolInstance.conNode,c=h.scrollLeft,l=h.scrollTop;return e.x=Math.round((t+8+c-a)/r+s),e.y=Math.round((o+8+l-n)/r+d),e},e.prototype.calLaserPlaceHandle=function(e,t){var o=this.toolInstance.viewInfo,i=o.zoom,r=o.zoomTX,a=o.zoomTY,n=o.offsetPageX,s=o.offsetPageY,d=this.toolInstance.conNode,h=d.scrollLeft,c=d.scrollTop;return{x:e=Math.round((e-n)*i+r-h),y:t=Math.round((t-s)*i+a-c)}},e.prototype.pushActualPlaceHandle=function(){var e=this.findLaserHandle();e&&(this.toolInstance.updateOffsetAndScrollHandle(),e.is_end_draw=!0,e.operate_id=r.createGraphicId(),this.toolInstance.updateToRemoteNewHandle([this.calLaserActualPlaceHandle(e)],a.Action.Move))},e.prototype.clearLaserHandle=function(e){var t;(t=e?this.toolInstance.graphicList.filter((function(t){return t.creator_id===e}))[0]:this.findLaserHandle())&&(t.is_end_draw=!0,t.operate_id=r.createGraphicId(),this.toolInstance.deleteHandle(t.graphic_id),this.toolInstance.updateToRemoteNewHandle([t],a.Action.Delete))},e.prototype.updateLaserConSize=function(e){var t,o="z-index:"+((e=e||this.laserContainerNode).style.zIndex||"initial")+";";if(this.toolInstance.viewInfo.isScroll){var i=this.toolInstance.whiteboardID,r=n.default.reservedPrefix.whiteboard,a=null===(t=document.querySelector("#"+r+i))||void 0===t?void 0:t.parentNode,s=a.getBoundingClientRect(),d=s.width,h=s.height;h!==a.scrollHeight&&(o+="width:"+(d-18)+"px;"),d!==a.scrollWidth&&(o+="height:"+(h-18)+"px;")}e.style.cssText=o},e}();t.Laser=s},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(4),a=o(2),n=o(0),s=o(1),d=function(){function e(e){var t=this;this.bindFlag=!1,this.tolerance=1,this.isIos11=navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1"),this.upSwitch=!1,this.mouseInfo={moveCount:0,moveTaskId:0,touchLeaveRect:{left:0,top:0,right:0,bottom:0},isHandWriting:!1,handWritingTimer:0,handWritingLastPoint:null,handWritingLastSize:null},this.mousedownHandle=function(e){if(t.toolInstance.enableDraw)if(t.toolInstance.getUserAuth().create){if(t.toolInstance.downCommonHandle(e)){t.upSwitch=!0,s.default.svgPath.tops.length=0,s.default.svgPath.bottoms.length=0,t.mouseInfo.isHandWriting=JSON.parse(s.default.basicState.attributes).stroke;var o=t.mouseInfo.isHandWriting&&s.default.basicState.type==n.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen,r=t.toolInstance.getMouseStartPoint(e,o),d=r.clientX,h=r.clientY,c=t.toolInstance.whiteboardNode;t.mouseInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect();var l=s.default.basicExtraState.customImage.url,p=s.default.basicState.type===n.ZegoWhiteboardTool.ZegoWhitebaordViewToolCustomImage&&l?n.GraphicType.Image:s.default.basicState.type,u=p===n.GraphicType.Image?{x:d,y:h,ex:0,ey:0,url:l,hash:""}:[d,h],g=a.createGraphicId();t.toolInstance.updateMousePointsHandle(d,h),t.toolInstance.updateProtoGraphic(i(i({creator_id:t.toolInstance.getUserID(),graphic_id:g,operate_id:g,is_end_draw:!1},s.default.basicState),{type:p,x:0,y:0,px:0,py:0,data:u,zorder:t.toolInstance.serviceHandle.createZorder()})),p===n.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen&&(t.toolInstance.protoGraphic.oldData=[d,h]),t.realTimeStartHandle(),t.mouseInfo.moveCount=0,t.mouseInfo.moveTaskId=0,t.toolInstance.toolAddEL(c,s.default.mouseEvents.move,t.mousemoveHandle)}}else t.toolInstance.sendError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic)},this.mousemoveHandle=function(e){if(!(window.TouchEvent&&e instanceof TouchEvent)||t.toolInstance.downCommonHandle(e))if(t.toolInstance.isTouchLeaveWhenMove(e,t.mouseInfo.touchLeaveRect))t.mouseupHandle();else{var o=t.toolInstance.protoGraphic;t.mouseInfo.isHandWriting?t.drawGraphicsHandWritingHandle(o,e):t.drawGraphicsPathHandle(o,e)}},this.mouseupHandle=function(){t.mouseInfo.handWritingTimer&&(clearTimeout(t.mouseInfo.handWritingTimer),t.mouseInfo.handWritingTimer=0);var e=t.toolInstance,o=e.protoGraphic,r=e.graphicList,d=e.whiteboardNode;if(o&&o.graphic_id&&t.upSwitch){t.toolInstance.toolRmEl(d,s.default.mouseEvents.move,t.mousemoveHandle),t.upSwitch=!1,t.mouseInfo.moveCount=0,t.mouseInfo.moveTaskId=0,t.drawGraphicsExceptionHandle(o);var h=o.graphic_id,c=o.type;if(t.toolInstance.updateBoxHandle(o)){if(c===n.GraphicType.Pencil){var l=t.toolInstance.getGraphicsHandle(h);if(!l)return;var p=o.oldData;if(o.data=p.slice(),t.mouseInfo.isHandWriting)t.drawGraphicsPencilSegment(o,n.GraphicOperateType.Local);else a.getElementChild(l)[0].setAttribute("d",a.mapGraphicsData(n.GraphicType.Pencil,o.data))}else if(c===n.GraphicType.Image){var u=(p=o.data).x,g=p.y,f=p.ex,v=p.ey,m=t.toolInstance.getUserAuth().create;if(u===f||g===v||!m){t.toolInstance.deleteHandle(o.graphic_id),t.toolInstance.initDrawHandle();var b=n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic;return void(!m&&t.toolInstance.sendError(b))}t.checkImageRect(p),o.initX=p.x,o.initY=p.y,o.oldData=i({},p)}o.is_end_draw=!0;var y=JSON.parse(JSON.stringify(o));t.toolInstance.setGraphicsDomZorder(y),r.push(y),t.realTimeEndHandle()}else c!==n.GraphicType.Image&&(o.is_end_draw=!0,t.realTimeEndHandle());t.toolInstance.initDrawHandle()}},this.toolInstance=e,this.tolerance=this.toolInstance.serviceHandle.isElectron?.3:1}return e.prototype.drawGraphicsExceptionHandle=function(e){var t=e.type,o=e.data;t!==n.GraphicType.Image&&o.length<4&&(o[2]=o[0]+1,o[3]=o[1]+1,this.drawGraphicsHandle(e,n.GraphicOperateType.Local))},e.prototype.isMouseMoveWithNoKeydown=function(e,t){return t instanceof MouseEvent&&!t.buttons&&(this.toolInstance.toolRmEl(this.toolInstance.whiteboardNode,s.default.mouseEvents.move,this.mousemoveHandle),this.toolInstance.deleteHandle(e),this.toolInstance.initDrawHandle(),!0)},e.prototype.catchMouseMoveException=function(){var e=this;this.mouseInfo.moveTaskId||(this.mouseInfo.moveTaskId=window.setTimeout((function(){if(e.mouseInfo.moveCount<5){var t=e.toolInstance.userNode.querySelector("#zego-whiteboard-input");t||((t=document.createElement("input")).id="zego-whiteboard-input",t.tabIndex=-1,e.toolInstance.userNode.insertBefore(t,e.toolInstance.userNode.firstChild)),t.focus()}}),200)),this.mouseInfo.moveCount++},e.prototype.realTimeStartHandle=function(){var e=this.toolInstance.protoGraphic;e.type!==n.GraphicType.Image&&this.toolInstance.updateToRemoteNewHandle([e],n.Action.Create)},e.prototype.realTimeDrawHandle=function(){var e=this.toolInstance.protoGraphic;e.type!==n.GraphicType.Image&&(e.type===n.GraphicType.Pencil?this.mouseInfo.isHandWriting?this.realTimeHandWrittingSend(e):this.readlTimeNormalSend(e):this.toolInstance.updateToRemoteNewHandle([e],n.Action.Update))},e.prototype.realTimeEndHandle=function(){var e=this.toolInstance.protoGraphic,t=e.type===n.GraphicType.Image?n.Action.Create:n.Action.Update;this.toolInstance.updateToRemoteNewHandle([e],t)},e.prototype.appendPath=function(e,t){var o,i=this;if(t.length){var r=JSON.parse(JSON.stringify(e));r.data=t,(o=e.oldData).push.apply(o,t),this.toolInstance.serviceHandle.isAppendPathLimit(this.toolInstance.whiteboardID,e).then((function(o){o?(e.oldData.splice(r.oldData.length,t.length),i.mouseupHandle()):i.toolInstance.updateToRemoteNewHandle([r],n.Action.Append)}))}},e.prototype.readlTimeNormalSend=function(e){var t=s.default.realTimeState.localDrawCount,o=e.data;if(o.length%t==2){var i=a.simplifyPathData(o.slice(o.length-t),this.tolerance);this.appendPath(e,i)}},e.prototype.realTimeHandWrittingSend=function(e){var t=e.data,o=t.slice(e.oldData.length,t.length);this.appendPath(e,o)},e.prototype.drawGraphicsHandWritingHandle=function(e,t){var o=this;this.mouseInfo.handWritingTimer||(this.mouseInfo.handWritingTimer=window.setTimeout((function(){o.drawGraphicsPathHandle(e,t),clearTimeout(o.mouseInfo.handWritingTimer),o.mouseInfo.handWritingTimer=0}),s.default.handWritingFactor.step))},e.prototype.drawGraphicsPathHandle=function(e,t){var o=this.mouseInfo.isHandWriting&&e.type==n.GraphicType.Pencil,i=this.toolInstance.getMouseChangedPoint(t,o);this.toolInstance.updateGraphicsDataHandle(i);var r=e.type===n.GraphicType.Image?n.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageCustom:void 0;this.realTimeDrawHandle(),this.drawGraphicsHandle(e,n.GraphicOperateType.Local,r)},e.prototype.isHandWriting=function(e,t){return t==n.GraphicOperateType.Local?this.mouseInfo.isHandWriting:JSON.parse(e.attributes).stroke},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,s.default.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolAddEL(e,s.default.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolAddEL(e,s.default.mouseEvents.leave,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,s.default.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolRmEl(e,s.default.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolRmEl(e,s.default.mouseEvents.leave,this.mouseupHandle)}},e.prototype.drawGraphicsHandle=function(e,t,o){switch(e.type){case n.GraphicType.Pencil:case n.GraphicType.RealTime:this.isHandWriting(e,t)?this.drawGraphicsPencilSegment(e,t):this.drawGraphicsPath(e,t);break;case n.GraphicType.Line:this.drawGraphicsLine(e,t);break;case n.GraphicType.Ellipse:this.drawGraphicsEllipse(e,t);break;case n.GraphicType.Rect:this.drawGraphicsRect(e,t);break;case n.GraphicType.Image:o===n.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageCustom?this.drawLocalCustomImage(e):this.drawReomteGraphicImage(e)}},e.prototype.updateGraphicsHandle=function(e){switch(e.type){case n.GraphicType.Pencil:this.isHandWriting(e,n.GraphicOperateType.Remote)?this.drawGraphicsPencilSegment(e,n.GraphicOperateType.Remote):this.drawGraphicsPath(e,n.GraphicOperateType.Remote);break;case n.GraphicType.Line:this.drawGraphicsLine(e,n.GraphicOperateType.Remote);break;case n.GraphicType.Ellipse:this.drawGraphicsEllipse(e,n.GraphicOperateType.Remote);break;case n.GraphicType.Rect:this.drawGraphicsRect(e,n.GraphicOperateType.Remote);break;case n.GraphicType.Image:this.updateGraphicsImage(e)}},e.prototype.drawGraphicsLine=function(e,t,o,i,r,d){void 0===o&&(o="none"),void 0===i&&(i=1),void 0===r&&(r="round"),void 0===d&&(d="round");var h=e.data,c=e.graphic_id,l=e.color,p=e.x,u=e.y,g=a.mapGraphicsData(n.GraphicType.Line,h),f=g.x1,v=g.y1,m=g.x2,b=g.y2,y=""+s.default.reservedPrefix.graphicsSvg+c,w=""+s.default.reservedPrefix.graphics+c,x=a.createSvgElementHandle(y,w,"line",e.zorder);x[1]&&this.toolInstance.appendGraphicsDomHandle(x[1],n.GraphicType.Line),this.toolInstance.triggerAnimateHandle(x[0],t),a.setAttributeHandle(x[0],[{attr:"fill",value:o},{attr:"opacity",value:i},{attr:"stroke",value:l},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:r},{attr:"stroke-linecap",value:d},{attr:"x1",value:f},{attr:"y1",value:v},{attr:"x2",value:m},{attr:"y2",value:b},{attr:"transform",value:"translate("+(p||0)+", "+(u||0)+")"}])},e.prototype.drawGraphicsRect=function(e,t,o,i,r,d){void 0===o&&(o="none"),void 0===i&&(i=1),void 0===r&&(r="round"),void 0===d&&(d="round");var h=e.data,c=e.graphic_id,l=e.color,p=e.x,u=e.y,g=a.mapGraphicsData(n.GraphicType.Rect,h),f=g.width,v=g.height,m=g.x,b=g.y,y=""+s.default.reservedPrefix.graphicsSvg+c,w=""+s.default.reservedPrefix.graphics+c,x=a.createSvgElementHandle(y,w,"rect",e.zorder);x[1]&&this.toolInstance.appendGraphicsDomHandle(x[1],n.GraphicType.Rect),this.toolInstance.triggerAnimateHandle(x[0],t),a.setAttributeHandle(x[0],[{attr:"fill",value:o},{attr:"opacity",value:i},{attr:"stroke",value:l},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:r},{attr:"stroke-linecap",value:d},{attr:"width",value:f},{attr:"height",value:v},{attr:"x",value:m},{attr:"y",value:b},{attr:"transform",value:"translate("+(p||0)+", "+(u||0)+")"}])},e.prototype.drawGraphicsPath=function(e,t,o,i,r){void 0===o&&(o="none"),void 0===i&&(i="round"),void 0===r&&(r="round");var d=t===n.GraphicOperateType.Local?e.oldData:e.data;if(d&&d.length){var h=e.color,c=e.graphic_id,l=e.x,p=e.y,u=a.mapGraphicsData(n.GraphicType.Pencil,d),g=""+s.default.reservedPrefix.graphicsSvg+c,f=""+s.default.reservedPrefix.graphics+c,v=a.createSvgElementHandle(g,f,"path",e.zorder);v[1]&&this.toolInstance.appendGraphicsDomHandle(v[1],n.GraphicType.Pencil),this.toolInstance.triggerAnimateHandle(v[0],t),a.setAttributeHandle(v[0],[{attr:"fill",value:o},{attr:"d",value:u},{attr:"stroke",value:h},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:i},{attr:"stroke-linecap",value:r},{attr:"transform",value:"translate("+(l||0)+", "+(p||0)+")"}])}},e.prototype.drawGraphicsPencilSegment=function(e,t){var o=e.color,i=e.graphic_id,r=e.x,d=e.y,h=e.is_end_draw,c=this.toolInstance.viewInfo.viewWidth,l=a.mapHandWritingGraphicsData(e,this.getSize(e,t),c),p=""+s.default.reservedPrefix.graphicsSvg+i,u=""+s.default.reservedPrefix.graphics+i,g=a.createSvgElementHandle(p,u,"path",e.zorder);g[1]&&this.toolInstance.appendGraphicsDomHandle(g[1],n.GraphicType.Pencil),this.toolInstance.triggerAnimateHandle(g[0],t),(null==l?void 0:l.includes("M"))&&a.setAttributeHandle(g[0],[{attr:"fill",value:o},{attr:"d",value:l},{attr:"stroke-width",value:0},{attr:"transform",value:"translate("+(r||0)+", "+(d||0)+")"}]),h&&(s.default.svgPath.tops.length=0,s.default.svgPath.bottoms.length=0)},e.prototype.drawGraphicsEllipse=function(e,t,o,i,r,d){void 0===o&&(o="none"),void 0===i&&(i=1),void 0===r&&(r="round"),void 0===d&&(d="round");var h=e.color,c=e.data,l=e.graphic_id,p=e.x,u=e.y,g=a.mapGraphicsData(n.GraphicType.Ellipse,c),f=g.cx,v=g.cy,m=g.rx,b=g.ry,y=""+s.default.reservedPrefix.graphicsSvg+l,w=""+s.default.reservedPrefix.graphics+l,x=a.createSvgElementHandle(y,w,"ellipse",e.zorder);x[1]&&this.toolInstance.appendGraphicsDomHandle(x[1],n.GraphicType.Ellipse),this.toolInstance.triggerAnimateHandle(x[0],t),a.setAttributeHandle(x[0],[{attr:"fill",value:o},{attr:"opacity",value:i},{attr:"stroke",value:h},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:r},{attr:"stroke-linecap",value:d},{attr:"cx",value:f},{attr:"cy",value:v},{attr:"rx",value:m},{attr:"ry",value:b},{attr:"transform",value:"translate("+(p||0)+", "+(u||0)+")"}])},e.prototype.drawLocalGraphicImage=function(e,t,o){var d=this;return new Promise((function(h,c){if(!d.toolInstance.getUserAuth().create)return c(r.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic));var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){var r=d.toolInstance.graphicList,c=d.getScaleRect(l.width,l.height),p=c.width,u=c.height,g={x:t,y:o,ex:t+p,ey:o+u,url:e,hash:""},f=a.createGraphicId(),v=d.toolInstance.serviceHandle.createZorder(),m=""+s.default.reservedPrefix.graphicsSvg+f,b=""+s.default.reservedPrefix.graphics+f,y=a.createSvgElementHandle(m,b,"image",v);if(y[1]&&d.toolInstance.appendGraphicsDomHandle(y[1],n.GraphicType.Image),a.setAttributeHandle(y[0],[{attr:"width",value:p},{attr:"height",value:u},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:e},{attr:"transform",value:"translate("+t+", "+o+")"}]),d.isIos11&&y[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),d.toolInstance.updateProtoGraphic(i(i({creator_id:d.toolInstance.getUserID(),graphic_id:f,operate_id:f,is_end_draw:!0},s.default.basicState),{type:n.GraphicType.Image,x:0,y:0,px:0,py:0,initX:t,initY:o,data:g,oldData:i({},g),zorder:v})),d.toolInstance.updateOffsetAndScrollHandle(),d.toolInstance.updateBoxHandle(d.toolInstance.protoGraphic)){var w=JSON.parse(JSON.stringify(d.toolInstance.protoGraphic));w.is_end_draw=!0,r.push(w),d.toolInstance.updateToRemoteNewHandle([w],n.Action.Create)}d.toolInstance.initDrawHandle(),h(e)},l.onerror=c,l.src=e}))},e.prototype.drawLocalCustomImage=function(e){var t=e.graphic_id,o=s.default.basicExtraState.customImage,i=o.w,r=o.h,d=e.data,h=d.x,c=d.y,l=d.ex,p=d.ey,u=d.url,g=""+s.default.reservedPrefix.graphicsSvg+t,f=""+s.default.reservedPrefix.graphics+t,v=a.createSvgElementHandle(g,f,"image",e.zorder);v[1]&&this.toolInstance.appendGraphicsDomHandle(v[1],n.GraphicType.Image);var m=Number((Math.abs(l-h)/i).toFixed(7)),b=Number((Math.abs(p-c)/r).toFixed(7));a.setAttributeHandle(v[0],[{attr:"width",value:i},{attr:"height",value:r},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:u},{attr:"transform",value:"translate("+Math.min(h,l)+", "+Math.min(c,p)+") scale("+m+", "+b+")"}]),this.isIos11&&v[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u)},e.prototype.drawReomteGraphicImage=function(e){var t=this,o=e.graphic_id,i=e.zorder,r=e.data;this.checkImageRect(r);var n=r.x,s=r.y,d=r.ex,h=r.ey,c=r.url;this.toolInstance.appendImageDomHandle(o,i);var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){var i=t.toolInstance.getImageDomHandle(o),r=i[0],p=i[1];if(r&&p){var u=t.getScaleRect(l.width,l.height),g=u.width,f=u.height,v=Number(((d-n)/g).toFixed(7)),m=Number(((h-s)/f).toFixed(7));a.setAttributeHandle(r,[{attr:"width",value:g},{attr:"height",value:f},{attr:"crossorigin",value:"anonymous"},{attr:"href",value:c},{attr:"transform",value:"translate("+n+", "+s+") scale("+v+", "+m+")"}]),t.isIos11&&r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);var b=t.toolInstance.getBoxInfoByGraphic(e);if(b){var y=b.x,w=b.y,x=b.width,I=b.height;p.style.cssText+="width:"+x+"px;height:"+I+"px;left:"+y+"px;top:"+w+"px;"}}},l.src=c},e.prototype.updateGraphicsImage=function(e){var t=e.graphic_id,o=e.data;this.checkImageRect(o);var i=o.x,r=o.y,n=o.ex,d=o.ey,h=""+s.default.reservedPrefix.graphicsSvg+t,c=""+s.default.reservedPrefix.graphics+t,l=a.createSvgElementHandle(h,c,"image",e.zorder)[0];if(l){var p=+l.getAttribute("width"),u=+l.getAttribute("height"),g=Number(((n-i)/p).toFixed(7)),f=Number(((d-r)/u).toFixed(7));l.setAttribute("transform","translate("+i+", "+r+") scale("+g+", "+f+")")}},e.prototype.checkImageRect=function(e){var t=e.x,o=e.y,i=e.ex,r=e.ey;t>i&&(e.x=i,e.ex=t),o>r&&(e.y=r,e.ey=o)},e.prototype.getScaleRect=function(e,t){var o=this.toolInstance.viewInfo,i=o.viewWidth,r=o.viewHeight;if(e>i||t>r){var a=Math.min(i/e,r/t);e=e*a|0,t=t*a|0}return{width:e,height:t}},e.prototype.getSize=function(e,t){return t===n.GraphicOperateType.Local?s.default.basicExtraState.drawSize:a.calSizeHandle(e.size,e.type,this.toolInstance.viewInfo.viewWidth,!1)},e}();t.SvgGraphics=d},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),a=o(2),n=o(1),s=function(){function e(e){var t=this;this.bindFlag=!1,this.canCreate=!0,this.chInput=!1,this.allowTouchEnd=!0,this.mouseupHandle=function(e){e instanceof MouseEvent?t.upEventHandle(e):t.allowTouchEnd&&(t.upEventHandle(e),t.allowTouchEnd=!1)},this.upEventHandle=function(e){if(t.toolInstance.enableDraw)if(t.toolInstance.getUserAuth().create){if(t.toolInstance.downCommonHandle(e))if(t.canCreate){var o=t.toolInstance.getMouseChangedPoint(e),i=o.clientX,a=o.clientY;if(!t.checkAddHandle(i,a))return;t.addTextGraphics("",i,a)}else t.canCreate=!0}else t.toolInstance.sendError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic)},this.toolInstance=e}return e.prototype.updateContentHandle=function(e){var t=n.default.textareaHPadding,o=e.value,i=e.previousSibling,r=Number(i.style.maxWidth.split("px")[0])-2*t,a=i.parentNode,s=document.createElement("span");s.style.cssText="position: absolute; z-index: -100; font-size: inherit; font-family: inherit; visibility: hidden; display: inline-block;line-height: 1;",a.appendChild(s);for(var d="",h=0,c=0,l=o;c<l.length;c++){var p=l[c];if("\n"===p)d+="\n",h=0;else{var u=this.textSizeHandle(s,p).width;(h+=u)>r?(d+="\n"+p,h=u):d+=p}}a.removeChild(s),i.innerHTML=d,e.value=d},e.prototype.addTextareaDomHandle=function(e){var t=e.graphic_id,o=e.data,i=document.createElement("textarea"),r=""+n.default.reservedPrefix.graphics+t;i.setAttribute("id",r),i.setAttribute("tabindex","-1"),i.setAttribute("spellcheck","false"),i.setAttribute("maxlength",""+n.default.maxlength),navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1")&&(i.style.padding="0 "+Math.max(n.default.textareaHPadding-3,0)+"px");var s=a.splitTextHandle(o).text;return i.value=s,i},e.prototype.addPreDomHandle=function(e){var t=e.size,o=e.data,i=e.type,r=a.splitTextHandle(o).text,s=document.createElement("pre");s.innerHTML=r;var d=a.calSizeHandle(t,i,this.toolInstance.viewInfo.viewWidth,!1),h=n.default.textareaHPadding,c=n.default.textareaVPadding;return h*=2,c*=2,s.style.cssText="min-height:"+(d*n.default.lineHeight+c)+"px;min-width:"+(d+h)+"px;",s},e.prototype.addTextareaConDomHandle=function(e){var t=e.size,o=e.color,i=e.data,r=e.graphic_id,s=e.type,d=e.attributes,h=e.zorder,c=JSON.parse(d||n.default.basicState.attributes),l=c.bold,p=c.italic,u=a.calSizeHandle(t,s,this.toolInstance.viewInfo.viewWidth,!1),g=a.splitTextHandle(i),f=g.beginX,v=g.beginY,m=document.createElement("div"),b=""+n.default.reservedPrefix.textareaCon+r;return m.setAttribute("id",b),h&&m.setAttribute("data-z",h+""),m.style.cssText="font-size:"+u+"px;font-style:"+(p?"italic":"normal")+";font-weight:"+(l?"bold":"normal")+";left:"+f+"px;top:"+v+"px;color:"+o+";caret-color:"+o+";",m},e.prototype.textSizeHandle=function(e,t){return" "===t&&(t=t.replace(/ /g,"&nbsp")),e.innerHTML=t,{width:e.getBoundingClientRect().width,height:e.getBoundingClientRect().height}},e.prototype.checkValueHandle=function(e){var t=n.default.maxlength;return e.length>t&&(e=e.slice(0,t)),e},e.prototype.initHeightHandle=function(e){var t=e.previousSibling;e.scrollTop=0,e.style.height="initial",t.style.height="initial",t.style.maxHeight="initial"},e.prototype.updateHeightHandle=function(e){var t=n.default.textareaHPadding,o=n.default.lineHeight,i=this.toolInstance.viewInfo.zoom,r=e.previousSibling,a=r.style.height,s=Number(r.style.maxHeight.split("px")[0]),d=(Number(r.style.maxWidth.split("px")[0])+2*t)/i,h=e.parentNode.style.fontSize,c=Number(h.split("px")[0]);e.style.width=d+"px",e.style.height=c*o+"px";var l=e.scrollHeight+"px";e.scrollHeight*i>s&&(l=a),r.style.height=l,e.style.height=l},e.prototype.inputCallbackHandle=function(e){var t=e.target,o=t.previousSibling,i=this.checkValueHandle(t.value);t.value=i,o.innerHTML=i,this.updateHeightHandle(t),!this.chInput&&this.updateToRemoteHandle(e)},e.prototype.chInputCallbackHandle=function(e){this.chInput=!1,this.updateToRemoteHandle(e)},e.prototype.updateToRemoteHandle=function(e){var t=e.target,o=t.parentNode,i=this.toolInstance.graphicList,s=t.id.split(n.default.reservedPrefix.graphics)[1],d=t.value,h=this.toolInstance.getDataFromGraphicList(s,"data").data,c=a.splitTextHandle(h),l=c.beginX,p=c.beginY,u=i.findIndex((function(e){return e.graphic_id===s})),g=i[u];g&&("blur"===e.type?(g.is_end_draw=!0,d?(this.updateContentHandle(t),this.toolInstance.updateBoxHandle(g,"blur"),g.data=a.addTextBeginPlace(t.value,l,p),this.toolInstance.updateToRemoteNewHandle([g],r.Action.Update)):(a.removeElement(o),a.removeElement(this.toolInstance.getBoxHandle(s)),i.splice(u,1),this.toolInstance.updateToRemoteNewHandle([g],r.Action.Delete)),this.toolInstance.initDrawHandle()):this.toolInstance.getUserAuth().update||g.creator_id===this.toolInstance.getUserID()?(this.updateContentHandle(t),g.is_end_draw=!1,g.data=a.addTextBeginPlace(t.value,l,p),this.toolInstance.updateToRemoteNewHandle([g],r.Action.Update)):t.blur())},e.prototype.bindTextareaInputEventHandle=function(e){var t=this;e.addEventListener("input",(function(e){t.inputCallbackHandle(e)})),e.addEventListener("compositionstart",(function(e){t.chInput=!0})),e.addEventListener("compositionend",(function(e){t.chInputCallbackHandle(e)})),e.addEventListener("keydown",(function(e){9===e.keyCode&&e.preventDefault()}))},e.prototype.bindTextareaFocusEvent=function(e,t){var o=this,i=t.data,r=a.splitTextHandle(i),s=r.beginX,d=r.beginY;e.addEventListener("focus",(function(e){var t=e.target;t.parentNode.style.borderColor="red";var i=t.id.split(n.default.reservedPrefix.graphics)[1];o.toolInstance.setDataToGraphicList(i,{oldData:a.addTextBeginPlace(t.value,s,d)})}))},e.prototype.bindTextareaBlurEvents=function(e){var t=this;e.addEventListener("blur",(function(e){var o=t.toolInstance.graphicsBoxConNode,i=e.target,r=i.parentNode,a=i.id.split(n.default.reservedPrefix.graphics)[1];t.initHeightHandle(i),t.updatePointerEvents(2,o.querySelector(t.toolInstance.getBoxSelHandle(a))),r.style.borderColor="transparent",t.canCreate=!1,t.updateToRemoteHandle(e),t.allowTouchEnd||(t.allowTouchEnd=!0)}))},e.prototype.updatePointerEvents=function(e,t){var o=this,i=this.toolInstance.graphicsBoxConNode;1===e?(Array.prototype.slice.call(a.getElementChild(i),0).forEach((function(e){var t=o.toolInstance.getGraphicsHandle(e.id.split(n.default.reservedPrefix.graphicsBox)[1]);t&&"DIV"===t.nodeName&&(e.style.pointerEvents="initial")})),i.style.pointerEvents="none",t&&(t.style.pointerEvents="none")):(i.style.pointerEvents="initial",t&&(t.style.pointerEvents="initial"))},e.prototype.checkAddHandle=function(e,t){var o=this.calMaxSizeHandle(e,t),i=o.maxWidth,s=o.maxHeight,d=this.toolInstance.viewInfo.viewWidth,h=n.default.textareaHPadding,c=n.default.basicState,l=n.default.lineHeight,p=n.default.textareaVPadding,u=a.calSizeHandle(c.fontSize,r.GraphicType.Text,d,!1);return 2*h+u+12<i&&2*p+u*l+12<s},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,n.default.mouseEvents.up,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,n.default.mouseEvents.up,this.mouseupHandle)}},e.prototype.addTextGraphics=function(e,t,o){var s=this.toolInstance,d=s.protoGraphic,h=s.graphicList,c=a.createGraphicId();this.toolInstance.updateProtoGraphic(i(i({creator_id:this.toolInstance.getUserID(),graphic_id:c,operate_id:c,is_end_draw:!!e,x:0,y:0,px:0,py:0,zorder:this.toolInstance.serviceHandle.createZorder(),data:a.addTextBeginPlace(e,t+"",o+"")},n.default.basicState),{size:n.default.basicState.fontSize}));var l=i({},d);h.push(l),this.drawGraphicsHandle(l,!e),this.toolInstance.setGraphicsDomZorder(l);var p=this.toolInstance.updateBoxHandle(l);!e&&this.updatePointerEvents(1,p),this.toolInstance.updateToRemoteNewHandle([l],r.Action.Create)},e.prototype.drawGraphicsHandle=function(e,t){var o=e.x,i=e.y,s=this.addTextareaDomHandle(e),d=this.addPreDomHandle(e),h=this.addTextareaConDomHandle(e);h.appendChild(d),h.appendChild(s),h.style.transform="translate("+(o||0)+"px, "+(i||0)+"px)",this.toolInstance.appendGraphicsDomHandle(h,r.GraphicType.Text),this.bindTextareaInputEventHandle(s),this.bindTextareaFocusEvent(s,e);var c=n.default.mouseEvents;a.bindStopsEvents(s,[c.down,c.move,c.up]),t&&(this.initMaxSizeHandle(s),s.focus(),this.updatePointerEvents(1,null)),this.bindTextareaBlurEvents(s)},e.prototype.updateGraphicsHandle=function(e){var t=e.graphic_id,o=e.data,i=e.size,r=e.color,s=e.x,d=e.y,h=e.type,c=e.attributes,l=JSON.parse(c||n.default.basicState.attributes),p=l.bold,u=l.italic,g=a.calSizeHandle(i,h,this.toolInstance.viewInfo.viewWidth,!1),f=a.splitTextHandle(o),v=f.beginX,m=f.beginY,b=f.text,y=this.toolInstance.getGraphicsHandle(t);if(y){var w=a.getElementChild(y),x=w[0],I=w[1];I.value=b,y.style.cssText="font-size: "+g+"px;font-style:"+(u?"italic":"normal")+";font-weight:"+(p?"bold":"normal")+";left: "+v+"px;top: "+m+"px;color: "+r+";transform: translate("+s+"px, "+d+"px);caret-color:"+r+";";var E=b.split("\n").length*g*n.default.lineHeight+2*n.default.textareaVPadding;x.innerHTML=b,x.style.height=E+"px",x.style.maxWidth="initial",x.style.maxHeight="initial",I.value=b,I.style.height=E+"px"}},e.prototype.focusHandle=function(e){this.toolInstance.setDataToGraphicList(e,{selected:!1});var t=this.toolInstance.getBoxHandle(e);t&&(t.style.borderColor="transparent"),this.updatePointerEvents(1,t);var o=this.toolInstance.getGraphicsHandle(e);if(o){var i=a.getElementChild(o)[1];this.initMaxSizeHandle(i),o.style.borderColor="red",i.style.height="100%",i.focus();var n=this.toolInstance.graphicList.filter((function(t){return t.graphic_id===e}))[0];n.operate_id=a.createGraphicId(),n.is_end_draw=!1,this.toolInstance.updateToRemoteNewHandle([n],r.Action.Update)}},e.prototype.backUpdateGraphicsHandle=function(e){var t=e.graphic_id,o=e.data,i=a.splitTextHandle(o).text,r=this.toolInstance.getGraphicsHandle(t);if(r){var n=a.getElementChild(r),s=n[0];n[1].value=i,s.innerHTML=i;var d=r.getBoundingClientRect(),h=d.width,c=d.height,l=this.toolInstance.getBoxHandle(t);l&&(l.style.cssText+="width:"+h+"px;height:"+c+"px;"),this.toolInstance.setDataToGraphicList(t,{data:o})}},e.prototype.initMaxSizeHandle=function(e){var t=e.getBoundingClientRect(),o=t.left,i=t.top,r=this.toolInstance.transLocationHandle({clientX:o,clientY:i}),a=r.clientX,n=r.clientY,s=this.calMaxSizeHandle(a,n),d=s.maxWidth,h=s.maxHeight,c=e.previousSibling;c.style.maxHeight=h+"px",c.style.maxWidth=d+"px"},e.prototype.calMaxSizeHandle=function(e,t){var o,i=this.toolInstance.viewInfo,r=i.isScroll,a=i.isOriginScroll,s=i.width,d=i.height,h=i.viewWidth,c=i.viewHeight,l=i.zoom,p=i.zoomTX,u=i.zoomTY,g=i.offsetPageX,f=i.offsetPageY,v=0;return r?(o=Math.floor(s-e),v=Math.floor(d-t),a&&(o-=n.default.scrollbarSize,v-=n.default.scrollbarSize)):(o=Math.floor(h-e*l+g*l-p),v=Math.floor(c-t*l+f*l-u)),{maxWidth:o-=2*n.default.boxBorderWidth*l,maxHeight:v-=2*n.default.boxBorderWidth*l}},e}();t.TextareaGraphics=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r=o(1),a=function(){function e(e){var t=this;this.bindFlag=!1,this.mouseInfo={touchLeaveRect:{left:0,top:0,right:0,bottom:0}},this.boxRectMap={},this.mousedownHandle=function(e){if(t.toolInstance.enableDraw){var o=t.toolInstance,a=o.whiteboardNode,n=o.graphicList;t.mouseInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect(),n.forEach((function(e){if(e.type!==i.GraphicType.Laser){var o=t.toolInstance.getBoxHandle(e.graphic_id);o&&(t.boxRectMap[e.graphic_id]=o.getBoundingClientRect())}})),t.mousemoveHandle(e),t.toolInstance.toolAddEL(a,r.default.mouseEvents.move,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.enableDraw){var o=e instanceof MouseEvent?e:e.changedTouches[0],i=o.clientX,r=o.clientY;if(t.toolInstance.isTouchLeaveWhenMove(e,t.mouseInfo.touchLeaveRect))t.mouseupHandle();else{var a=0,n="";t.toolInstance.graphicList.forEach((function(e){var o=t.boxRectMap[e.graphic_id];if(o){var s=o.left,d=o.right,h=o.top,c=o.bottom;if(i>=s&&i<=d&&r>=h&&r<=c){var l=e.zorder||1;(!a||l>a)&&(a=l,n=e.graphic_id)}}})),t.toolInstance.graphicList.forEach((function(e){e.selected=!!n&&(e.graphic_id===n&&t.toolInstance.getGraphicIsEndDraw(e.graphic_id)),t.toolInstance.updateBoxBorder(e)}))}}},this.mouseupHandle=function(){t.boxRectMap={};var e=t.toolInstance.whiteboardNode;t.toolInstance.toolRmEl(e,r.default.mouseEvents.move,t.mousemoveHandle),t.toolInstance.deleteSelectedGraphics(i.DeleteGraphicAction.EraserTool)},this.toolInstance=e}return e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,r.default.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolAddEL(e,r.default.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolAddEL(e,r.default.mouseEvents.leave,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,r.default.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolRmEl(e,r.default.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolRmEl(e,r.default.mouseEvents.leave,this.mouseupHandle)}},e}();t.Eraser=a},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(34),a=o(2),n=o(0),s=o(1),d=function(){function e(e){var t=this;this.bindFlag=!1,this.authFlag=!0,this.noMoveUp=!0,this.isWillMove=!1,this.mouseInfo={moveCount:0,touchLeaveRect:{left:0,top:0,right:0,bottom:0}},this.moveSelectedGraphicIds="",this.userId="",this.selectBoxMap={l:0,t:0,r:0,b:0,box:document.createElement("div")},this.mousedownHandle=function(e){if(t.toolInstance.enableDraw&&t.toolInstance.downCommonHandle(e)&&t.imageTool.startEditTarget(e,t.mousemoveHandle)){t.setGraphicsBox(),t.authFlag=!0,t.imageTool.editBoxMap.interrupt=!1;var o=t.selectBoxMap,r=o.l,d=o.t,h=o.r,c=o.b,l=t.toolInstance.getMouseStartPoint(e),p=l.clientX,u=l.clientY,g=t.toolInstance.getUserAuth(),f=t.toolInstance,v=f.graphicList,m=f.whiteboardNode;t.mouseInfo.touchLeaveRect=t.toolInstance.getWhiteboardNodeRect();var b=t.getCoveredMaxZorderGraphic(e);if(b){var y=b.rect,w=y.left,x=y.top,I=y.right,E=y.bottom,T=t.toolInstance.transLocationHandle({clientX:w,clientY:x}),S=t.toolInstance.transLocationHandle({clientX:I,clientY:E});w=T.clientX,x=T.clientY,I=S.clientX,E=S.clientY;var W=b.graphic,H=W.graphic_id,C=W.selected,L=W.type,_=W.creator_id,Z=g.update||_===t.userId;C||(v.forEach((function(e){e.selected=e.graphic_id===H})),L===n.GraphicType.Image?Z?(t.imageTool.initEditBox(b.graphic),t.hideSelectBox(H)):(t.initSelectBox(w,x,I,E),t.toolInstance.sendError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthUpdateGraphic)):(t.hideImageEditBox(),t.initSelectBox(w,x,I,E))),C&&L===n.GraphicType.Text&&1==v.filter((function(e){return e.selected})).length&&(Z?(t.noMoveUp=H,setTimeout((function(){return t.hideSelectBox(H)}),50)):t.toolInstance.sendError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthUpdateGraphic)),t.isWillMove=!0}else{h>r&&r<=p&&p<=h&&d<=u&&u<=c?t.isWillMove=!0:t.hideSelectBox()}t.mouseInfo.moveCount=0,t.moveSelectedGraphicIds="",t.toolInstance.updateMousePointsHandle(p,u),t.isWillMove?v.forEach((function(e){e.selected&&(g.move||e.creator_id===t.userId)&&(e.px=e.x,e.py=e.y,e.is_end_draw=!1,e.operate_id=a.createGraphicId())})):(t.toolInstance.updateProtoGraphic(i(i({graphic_id:a.createGraphicId()},s.default.basicState),{x:0,y:0,px:0,py:0,data:[p,u]})),t.hideImageEditBox(),t.hideSelectBox()),t.toolInstance.toolAddEL(m,s.default.mouseEvents.move,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.enableDraw){if(e instanceof MouseEvent&&!e.buttons)return t.resetMouse();if(t.imageTool.moveEditTarget(e))if(t.toolInstance.isTouchLeaveWhenMove(e,t.mouseInfo.touchLeaveRect))t.mouseupHandle();else{t.mouseInfo.moveCount++,t.noMoveUp=!1;var o=t.toolInstance.getMouseChangedPoint(e);if(t.isWillMove)t.updateGraphicsOnMoving(o);else{t.toolInstance.updateGraphicsDataHandle(o);var i=t.toolInstance.protoGraphic;t.svgTool.drawGraphicsRect(i,n.GraphicOperateType.Local,i.color,.3),t.mouseInfo.moveCount%10==0&&t.updateBoxBorderOnSelector()}}}},this.mouseupHandle=function(){if(!t.toolInstance.enableDraw||!0===t.noMoveUp)return t.imageTool.endEditTarget(),void t.resetMouse();if(t.isWillMove){var e=t.selectBoxMap,o=e.l,i=e.t,r=e.r,a=e.b;if(t.selectBoxMap.l=+t.selectBoxMap.box.style.left.replace("px",""),t.selectBoxMap.t=+t.selectBoxMap.box.style.top.replace("px",""),t.selectBoxMap.r=t.selectBoxMap.l+r-o,t.selectBoxMap.b=t.selectBoxMap.t+a-i,!t.noMoveUp){var s=t.toolInstance.graphicList.filter((function(e){return!!t.moveSelectedGraphicIds.includes(e.graphic_id)&&(e.is_end_draw=!0,!0)}));t.toolInstance.updateToRemoteNewHandle(s,n.Action.Move)}}else t.setSelectBox(!0);!t.imageTool.editBoxMap.interrupt&&t.noMoveUp&&t.toolInstance.getGraphicIsEndDraw(t.noMoveUp)&&t.toolInstance.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText).focusHandle(t.noMoveUp);t.resetMouse()},this.toolInstance=e,this.userId=e.getUserID(),this.svgTool=e.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),this.imageTool=new r.ImageTool(e),this.setGraphicsBox()}return e.prototype.setGraphicsBox=function(){this.selectBoxMap.box=this.toolInstance.whiteboardNode.querySelector(".graphics-box"),this.imageTool.setEditorBox()},e.prototype.initSelectBox=function(e,t,o,i){var r=this;this.selectBoxMap.l=e,this.selectBoxMap.t=t,this.selectBoxMap.r=o,this.selectBoxMap.b=i,o-=e,i-=t,this.toolInstance.graphicList.forEach((function(e){return r.toolInstance.updateBoxBorder(e)})),this.selectBoxMap.box.style.cssText+="left:"+e+"px;top:"+t+"px;width:"+o+"px;height:"+i+"px;display:block;"},e.prototype.hideSelectBox=function(e){var t=this;this.selectBoxMap.l=0,this.selectBoxMap.t=0,this.selectBoxMap.r=0,this.selectBoxMap.b=0,this.selectBoxMap.box.style.display="none",e?this.toolInstance.graphicList.forEach((function(e){!e.selected||e.type!==n.GraphicType.Image&&e.type!==n.GraphicType.Text?t.toolInstance.updateBoxBorder(e):t.toolInstance.updateBoxBorder(e,!0)})):this.toolInstance.graphicList.forEach((function(e){e.selected=!1,t.toolInstance.updateBoxBorder(e)}))},e.prototype.setSelectBox=function(e){var t,o=this;if("none"===(null===(t=this.imageTool.editBoxMap.parent)||void 0===t?void 0:t.style.display)){var i=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,a=0,s=0,d=0,h=0;if(this.toolInstance.graphicList.forEach((function(e){if(e.selected){var t=o.toolInstance.getBoxInfoByGraphic(e);if(t){h++,e.type===n.GraphicType.Image&&d++;var c=t.x,l=t.y,p=t.width,u=t.height;i=Math.min(i,c),r=Math.min(r,l),a=Math.max(a,c+p),s=Math.max(s,l+u)}}o.toolInstance.updateBoxBorder(e)})),a>0&&s>0){this.selectBoxMap.l=i,this.selectBoxMap.t=r,this.selectBoxMap.r=a,this.selectBoxMap.b=s;var c="left:"+i+"px;top:"+r+"px;width:"+(a-=i)+"px;height:"+(s-=r)+"px;display:block;";if(e&&1==d&&1==h){var l=this.toolInstance.graphicList.find((function(e){return e.selected&&e.type==n.GraphicType.Image}));l&&(l.creator_id==this.userId||this.toolInstance.getUserAuth().update)&&(c=c.replace("block","none"),this.toolInstance.updateBoxBorder(l,!0),this.imageTool.initEditBox(l))}this.selectBoxMap.box.style.cssText+=c}else this.selectBoxMap.l=0,this.selectBoxMap.t=0,this.selectBoxMap.r=0,this.selectBoxMap.b=0,this.selectBoxMap.box.style.display="none"}},e.prototype.resetMouse=function(){var e=this.toolInstance,t=e.protoGraphic,o=e.whiteboardNode;this.toolInstance.toolRmEl(o,s.default.mouseEvents.move,this.mousemoveHandle);var i=this.toolInstance.getGraphicsHandle(t.graphic_id);a.removeElement(null==i?void 0:i.parentElement),this.toolInstance.initDrawHandle(),this.isWillMove=!1,this.noMoveUp=!0},e.prototype.getCanMovedGraphicList=function(){var e=this,t=0,o=0,i=[],r=!this.moveSelectedGraphicIds,a=this.toolInstance.getUserAuth().move,s=this.toolInstance.graphicList.filter((function(n){if(n.selected){if(t++,!r&&e.moveSelectedGraphicIds.includes(n.graphic_id))return o++,!0;if(r&&(a||n.creator_id===e.userId))return o++,i.push(n.graphic_id),!0}return e.authFlag&&e.toolInstance.updateBoxBorder(n,!0),!1}));return r&&(this.moveSelectedGraphicIds=i.join(",")),t!==o&&(this.authFlag&&this.toolInstance.sendError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthMoveGraphic),this.authFlag=!1),s},e.prototype.updateGraphicsOnMoving=function(e){var t=this,o=e.clientX,i=e.clientY,r=this.getCanMovedGraphicList();if(r.length){this.toolInstance.updateMousePointsHandle(o,i);var a=this.toolInstance.calMoveHandle(),s=a[0],d=a[1],h=this.imageTool.editBoxMap,c=h.tdiff,l=h.parent,p=h.graphic,u=null==p?void 0:p.graphic_id,g=1==r.length&&(r[0].creator_id==this.userId||!!this.toolInstance.getUserAuth().update);r.forEach((function(e){t.toolInstance.updateGraphicsOffsetHandle(e,s,d);var o=e.graphic_id,i=e.type;if(i===n.GraphicType.Image){var r=(e.initX||0)+e.x|0,a=(e.initY||0)+e.y|0,h=e.data,p=e.oldData;p.x=h.x,p.y=h.y,p.ex=h.ex,p.ey=h.ey,h.ex=r+h.ex-h.x,h.ey=a+h.ey-h.y,h.x=r,h.y=a,t.toolInstance.moveGraphicsHandle(o,r,a),u===o&&(r-=c,a-=c,t.imageTool.editBoxMap.tx1=r,t.imageTool.editBoxMap.ty1=a,l.style.cssText+="transform:translate("+r+"px,"+a+"px)"),t.toolInstance.updateBoxHandle(e,g)}else i!==n.GraphicType.Laser&&(t.toolInstance.moveGraphicsHandle(o,e.x,e.y),t.toolInstance.updateBoxHandle(e))}));var f=this.selectBoxMap,v=f.l,m=f.t,b=this.toolInstance.mousePoints,y=b.boxX,w=b.boxY;this.selectBoxMap.box.style.cssText+="left:"+(v+y)+"px;top:"+(m+w)+"px;",this.mouseInfo.moveCount%10==0&&this.toolInstance.updateToRemoteNewHandle(r,n.Action.Move)}},e.prototype.updateBoxBorderOnSelector=function(){var e=this,t=this.toolInstance.graphicList,o=this.toolInstance.getGraphicsHandle(this.toolInstance.protoGraphic.graphic_id);if(o){var i=o.getBoundingClientRect(),r=i.left,a=i.right,s=i.top,d=i.bottom;t.forEach((function(t){if(t.type!==n.GraphicType.Laser){var o=e.toolInstance.getGraphicsHandle(t.graphic_id);if(o){var i=o.getBoundingClientRect(),h=i.left,c=i.top,l=i.right,p=i.bottom;h===l&&l++,c===p&&p++,t.selected=Math.max(r,h)<Math.min(a,l)&&Math.max(s,c)<Math.min(d,p)&&e.toolInstance.getGraphicIsEndDraw(t.graphic_id)}}})),this.setSelectBox()}},e.prototype.getCoveredMaxZorderGraphic=function(e){var t=this,o=e instanceof MouseEvent?e:e.changedTouches[0],i=o.clientX,r=o.clientY,a=0,s=null,d=null;return this.toolInstance.graphicList.forEach((function(e){if(e.type!==n.GraphicType.Laser&&t.toolInstance.getGraphicIsEndDraw(e.graphic_id)){var o=t.toolInstance.getBoxHandle(e.graphic_id);if(o){var h=o.getBoundingClientRect(),c=h.left,l=h.top,p=h.right,u=h.bottom;if(i>=c&&i<=p&&r>=l&&r<=u){var g=e.zorder||1;(!a||g>a)&&(a=g,s=e,d=h)}}}})),s&&d?{graphic:s,rect:d}:null},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolAddEL(e,s.default.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolAddEL(e,s.default.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolAddEL(e,s.default.mouseEvents.leave,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance.whiteboardNode;this.toolInstance.toolRmEl(e,s.default.mouseEvents.down,this.mousedownHandle),this.toolInstance.toolRmEl(e,s.default.mouseEvents.up,this.mouseupHandle),this.toolInstance.toolRmEl(e,s.default.mouseEvents.leave,this.mouseupHandle)}},e.prototype.hideImageEditBox=function(){this.imageTool.hideEditBox()},e.prototype.hideImageEditBoxByList=function(e){this.imageTool.hideEditBoxByList(e)},e.prototype.hideImageEditBoxByIds=function(e){this.imageTool.hideEditBoxByIds(e)},e.prototype.updateSelectorBoxHandle=function(e,t){if(this.hideImageEditBoxByIds(t),this.hideImageEditBoxByList(e),"none"!=this.selectBoxMap.box.style.display){var o=e.map((function(e){return e.graphic_id}));o.push.apply(o,t),this.toolInstance.graphicList.forEach((function(e){o.includes(e.graphic_id)&&(e.selected=!1)})),this.setSelectBox(!0)}},e}();t.Selector=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(2),r=o(0),a=o(1),n=function(){function e(e){this.editBoxMap={w:0,h:0,tx:0,ty:0,x:0,y:0,mx:0,my:0,tx1:0,ty1:0,w0:0,h0:0,board:8,wdiff:9,tdiff:4,interrupt:!1,target:null,graphic:null,parent:document.createElement("div"),box:document.createElement("div"),img:document.createElementNS("http://www.w3.org/2000/svg","image")},this.toolInstance=e,this.setEditorBox()}return e.prototype.startEditTarget=function(e,t){this.endEditTarget();var o=e.target,n=o.className;if(n.includes("operation-point-desktop")){var s=this.editBoxMap.graphic;s&&((this.toolInstance.getUserAuth().update||s.creator_id===this.toolInstance.getUserID())&&(s.operate_id=i.createGraphicId(),s.is_end_draw=!1,this.toolInstance.updateToRemoteNewHandle([s],r.Action.Update)),Object.assign(s.oldData,s.data)),this.editBoxMap.target=o;var d=window.getComputedStyle(this.editBoxMap.parent),h=d.transform.match(/(-?\d+),\s?(-?\d+)\)$/)||[],c=this.toolInstance.getMouseChangedPoint(e),l=c.clientX,p=c.clientY;this.editBoxMap.w=+d.width.replace("px",""),this.editBoxMap.h=+d.height.replace("px",""),this.editBoxMap.tx=+h[1]||0,this.editBoxMap.ty=+h[2]||0,this.editBoxMap.x=l,this.editBoxMap.y=p;var u=n.substr(n.lastIndexOf(" ")+1);"L"==u?this.editBoxMap.mx=l+this.editBoxMap.w:"R"==u?this.editBoxMap.mx=l-this.editBoxMap.w:"T"==u?this.editBoxMap.my=p+this.editBoxMap.h:"B"==u?this.editBoxMap.my=p-this.editBoxMap.h:"LT"==u?(this.editBoxMap.mx=l+this.editBoxMap.w,this.editBoxMap.my=p+this.editBoxMap.h):"RB"==u?(this.editBoxMap.mx=l-this.editBoxMap.w,this.editBoxMap.my=p-this.editBoxMap.h):"LB"==u?(this.editBoxMap.mx=l+this.editBoxMap.w,this.editBoxMap.my=p-this.editBoxMap.h):"RT"==u&&(this.editBoxMap.mx=l-this.editBoxMap.w,this.editBoxMap.my=p+this.editBoxMap.h);var g=this.toolInstance,f=g.whiteboardNode,v=g.conNode;return this.toolInstance.toolAddEL(f,a.default.mouseEvents.move,t),v.style.cursor=n.replace(/.+cursor-(\w+).+/,"$1")+"-resize",!1}return!0},e.prototype.moveEditTarget=function(e){var t=this.editBoxMap,o=t.target,i=t.interrupt;if(!o)return!i;var r=o.className.substr(o.className.lastIndexOf(" ")+1),a=this.toolInstance.getMouseChangedPoint(e),n=a.clientX,s=a.clientY;return this["moveEditTarget"+r](n,s),!1},e.prototype.endEditTarget=function(){var e=this.editBoxMap,t=e.target,o=e.graphic;if(t&&o)if(this.toolInstance.getUserAuth().update||o.creator_id===this.toolInstance.getUserID()){var i=o.data,a=i.x,n=i.y;o.initX=a-o.x,o.initY=n-o.y,o.is_end_draw=!0,this.toolInstance.updateToRemoteNewHandle([o],r.Action.Update)}else{Object.assign(o.data,o.oldData),this.initEditBox(o);var s=this.editBoxMap,d=s.w,h=s.h,c=s.tx1,l=s.ty1;this.updateSVGImageAttr(d,h,c,l,!0),this.toolInstance.sendError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthUpdateGraphic)}this.editBoxMap.target=null,this.toolInstance.conNode.style.cursor="auto"},e.prototype.setEditorBox=function(){this.editBoxMap.parent=this.toolInstance.whiteboardNode.querySelector(".img-editor-box")},e.prototype.initEditBox=function(e){var t,o=e.graphic_id,i=null===(t=this.toolInstance.getGraphicsHandle(o))||void 0===t?void 0:t.children[0];if(i){var r=this.editBoxMap,a=r.parent,n=r.board,s=r.wdiff,d=r.tdiff,h=e.data,c=h.x,l=h.y,p=h.ex-c+s,u=h.ey-l+s;c-=d,l-=d,c|=0,l|=0,this.editBoxMap.tx1=c,this.editBoxMap.ty1=l,this.editBoxMap.graphic=e,this.editBoxMap.w0=+i.getAttribute("width"),this.editBoxMap.h0=+i.getAttribute("height"),this.editBoxMap.img=i,this.editBoxMap.box=this.toolInstance.getBoxHandle(o),a.style.cssText+="display:block;width:"+p+"px;height:"+u+"px;transform:translate("+c+"px,"+l+"px);",a.children[4].style.cssText+="left:"+(p/2-n)+"px;",a.children[6].style.cssText+="left:"+(p/2-n)+"px;",a.children[5].style.cssText+="top:"+(u/2-n)+"px;",a.children[7].style.cssText+="top:"+(u/2-n)+"px;"}},e.prototype.hideEditBox=function(e){this.editBoxMap.target=null,this.editBoxMap.graphic=null,this.editBoxMap.interrupt=!!e;var t=this.editBoxMap.parent;t&&(t.style.display="none")},e.prototype.hideEditBoxByList=function(e){var t,o=null===(t=this.editBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e.graphic_id===o}))&&this.hideEditBox()},e.prototype.hideEditBoxByIds=function(e){var t,o=null===(t=this.editBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e===o}))&&this.hideEditBox()},e.prototype.moveEditTargetL=function(e,t,o){var i=this.editBoxMap,r=i.x,a=i.mx,n=i.w,s=i.h,d=i.tx,h=i.ty,c=i.parent,l=i.board;if(e<=a){e=r-e;var p=0|(o?e-n:e+n),u=0|(o?d-e+n:d-e);c.style.cssText+="width:"+p+"px;transform:translate("+u+"px,"+h+"px);",c.children[4].style.cssText+="left:"+(p/2-l)+"px;",c.children[6].style.cssText+="left:"+(p/2-l)+"px;",this.editBoxMap.tx1=u,this.editBoxMap.ty1=h,this.updateSVGImageAttr(p,s,u,h)}else this.moveEditTargetR(e,0,!0)},e.prototype.moveEditTargetR=function(e,t,o){var i=this.editBoxMap,r=i.x,a=i.mx,n=i.w,s=i.h,d=i.tx1,h=i.ty1,c=i.parent,l=i.board;e>a?(e=0|(o?e-r-n:e-r+n),c.style.cssText+="width:"+e+"px;",c.children[4].style.cssText+="left:"+(e/2-l)+"px;",c.children[6].style.cssText+="left:"+(e/2-l)+"px;",this.updateSVGImageAttr(e,s,d,h)):this.moveEditTargetL(e,0,!0)},e.prototype.moveEditTargetT=function(e,t,o){var i=this.editBoxMap,r=i.y,a=i.my,n=i.w,s=i.h,d=i.tx,h=i.ty,c=i.parent,l=i.board;if(t<=a){t=r-t;var p=0|(o?t-s:t+s),u=0|(o?h-t+s:h-t);c.style.cssText+="height:"+p+"px;transform:translate("+d+"px,"+u+"px);",c.children[5].style.cssText+="top:"+(p/2-l)+"px;",c.children[7].style.cssText+="top:"+(p/2-l)+"px;",this.editBoxMap.tx1=d,this.editBoxMap.ty1=u,this.updateSVGImageAttr(n,p,d,u)}else this.moveEditTargetB(0,t,!0)},e.prototype.moveEditTargetB=function(e,t,o){var i=this.editBoxMap,r=i.y,a=i.my,n=i.w,s=i.h,d=i.tx1,h=i.ty1,c=i.parent,l=i.board;t>a?(t=0|(o?t-r-s:t-r+s),c.style.cssText+="height:"+t+"px;",c.children[5].style.cssText+="top:"+(t/2-l)+"px;",c.children[7].style.cssText+="top:"+(t/2-l)+"px;",this.updateSVGImageAttr(n,t,d,h)):this.moveEditTargetT(0,t,!0)},e.prototype.moveEditTargetLT=function(e,t,o){var i=this.editBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,c=i.tx,l=i.ty,p=i.parent,u=i.board;if(e>r-4&&t>a-4||e<r-4&&t<a-4)if(d<=h&&e<=n||h<d&&t<=s){var g=0,f=0,v=0,m=0;if(o?(e=Math.min(r-e-d,a-t-h),h<d?(f=e,g=Math.round(d*f/h),m=l-e,v=Math.round(c-d*e/h)):(g=e,f=Math.round(g*h/d),v=c-e,m=Math.round(l-h*e/d))):(t-=a,e=(e-=r)<0||t<0?Math.max(e,t):Math.min(e,t),h<d?(f=h-e,g=Math.round(d*f/h),m=l+e,v=Math.round(c+d*e/h)):(g=d-e,f=Math.round(g*h/d),v=c+e,m=Math.round(l+h*e/d))),g<0||f<0)return;g|=0,f|=0,v|=0,m|=0,p.style.cssText+="width:"+g+"px;height:"+f+"px;transform:translate("+v+"px,"+m+"px);",p.children[4].style.cssText+="left:"+(g/2-u)+"px;",p.children[6].style.cssText+="left:"+(g/2-u)+"px;",p.children[5].style.cssText+="top:"+(f/2-u)+"px;",p.children[7].style.cssText+="top:"+(f/2-u)+"px;",this.editBoxMap.tx1=v,this.editBoxMap.ty1=m,this.updateSVGImageAttr(g,f,v,m)}else this.moveEditTargetRB(e,t,!0)},e.prototype.moveEditTargetRB=function(e,t,o){var i=this.editBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,c=i.tx1,l=i.ty1,p=i.parent,u=i.board;if(e>r-4&&t>a-4||e<r-4&&t<a-4)if(d<=h&&e>=n||h<d&&t>=s){e-=r,t-=a;var g=0,f=0;if(o?h<d?(f=Math.min(e,t)-h,g=Math.round(d*f/h)):(g=Math.min(e,t)-d,f=Math.round(g*h/d)):(e=e<0||t<0?Math.max(e,t):Math.min(e,t),h<d?(f=e+h,g=Math.round(d*f/h)):(g=e+d,f=Math.round(g*h/d))),g<0||f<0)return;g|=0,f|=0,p.style.cssText+="width:"+g+"px;height:"+f+"px;",p.children[4].style.cssText+="left:"+(g/2-u)+"px;",p.children[6].style.cssText+="left:"+(g/2-u)+"px;",p.children[5].style.cssText+="top:"+(f/2-u)+"px;",p.children[7].style.cssText+="top:"+(f/2-u)+"px;",this.updateSVGImageAttr(g,f,c,l)}else this.moveEditTargetLT(e,t,!0)},e.prototype.moveEditTargetLB=function(e,t,o){var i=this.editBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,c=i.tx,l=i.ty,p=i.parent,u=i.board;if(e<r-4&&t>a-4||e>r-4&&t<a-4)if(d<=h&&e<n||h<d&&t>s){var g=0,f=0,v=0,m=l;o?(e=Math.min(r-e-d,t-a-h),e=Math.abs(e),h<d?(f=e,g=Math.round(d*f/h)):(g=e,f=Math.round(g*h/d)),v=c-g,m=l+h):(t-=a,e=(e-=r)<0||t>0?Math.min(-e,t):-Math.min(e,-t),h<d?(f=h+e,v=c+d-(g=Math.round(d*f/h))):(g=d+e,f=Math.round(g*h/d),v=c-e)),g|=0,f|=0,v|=0,m|=0,p.style.cssText+="width:"+g+"px;height:"+f+"px;transform:translate("+v+"px,"+m+"px);",p.children[4].style.cssText+="left:"+(g/2-u)+"px;",p.children[6].style.cssText+="left:"+(g/2-u)+"px;",p.children[5].style.cssText+="top:"+(f/2-u)+"px;",p.children[7].style.cssText+="top:"+(f/2-u)+"px;",this.editBoxMap.tx1=v,this.editBoxMap.ty1=m,this.updateSVGImageAttr(g,f,v,m)}else this.moveEditTargetRT(e,t,!0)},e.prototype.moveEditTargetRT=function(e,t,o){var i=this.editBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,c=i.tx,l=i.ty,p=i.parent,u=i.board;if(e>r-4&&t<a-4||e<r-4&&t>a-4)if(d<=h&&e>n||h<d&&t<s){var g=0,f=0,v=c,m=0;o?(e=Math.min(e-r-d,a-t-h),e=Math.abs(e),h<d?(f=e,g=Math.round(d*f/h)):(g=e,f=Math.round(g*h/d)),v=c+d,m=l-f):(t-=a,e=(e-=r)<0||t>0?-Math.min(-e,t):Math.min(e,-t),h<d?(f=h+e,g=Math.round(d*f/h),m=l-e):(g=d+e,m=l+h-(f=Math.round(g*h/d)))),g|=0,f|=0,v|=0,m|=0,p.style.cssText+="width:"+g+"px;height:"+f+"px;transform:translate("+v+"px,"+m+"px);",p.children[4].style.cssText+="left:"+(g/2-u)+"px;",p.children[6].style.cssText+="left:"+(g/2-u)+"px;",p.children[5].style.cssText+="top:"+(f/2-u)+"px;",p.children[7].style.cssText+="top:"+(f/2-u)+"px;",this.editBoxMap.tx1=v,this.editBoxMap.ty1=m,this.updateSVGImageAttr(g,f,v,m)}else this.moveEditTargetLB(e,t,!0)},e.prototype.updateSVGImageAttr=function(e,t,o,i,r){var a=this.editBoxMap,n=a.w0,s=a.h0,d=a.wdiff,h=a.tdiff,c=a.img,l=a.box,p=a.graphic;if(c&&l){e|=0,t|=0,o|=0,i|=0,l.style.cssText+="width:"+e+"px;height:"+t+"px;left:"+o+"px;top:"+i+"px;",e-=d,t-=d,o+=h,i+=h;var u=Number((e/n).toFixed(7)),g=Number((t/s).toFixed(7));if(c.setAttribute("transform","translate("+o+", "+i+") scale("+u+", "+g+")"),!r){var f=null==p?void 0:p.data;f.x=o,f.y=i,f.ex=o+e,f.ey=i+t}}},e}();t.ImageTool=n},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,a){function n(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}d((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var o,i,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e],i=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),s=o(2),d=o(4),h=o(3),c=o(1),l=h.getLogAction.bind(null,"wb.v."),p=function(){function e(e,t){this.isRemote=!1,this.backgroundInfo={image:"",pos:"",mode:0},this.toolInstance=e,this.createContainer(t)}return e.prototype.createContainer=function(e){var t;this.graphicsBgConNode&&(this.graphicsBgConNode.innerHTML="");var o=this.toolInstance,i=o.whiteboardID,r=o.viewInfo,a=c.default.reservedPrefix,s=a.graphicsBgContainer,d=a.graphicsBgImageContainer,h=document.createElement("div");h.id=""+s+i;for(var l=0,p=r.pageCount||1;l<p;l++){var u=document.createElement("div");u.id=d+l+i,h.appendChild(u)}this.graphicsBgConNode=h,this.toolInstance.viewInfo.direction===n.ZegoWhiteboardViewScrollDirection.Vertical&&(this.graphicsBgConNode.style.flexDirection="column"),null===(t=e.firstChild)||void 0===t||t.before(h)},e.prototype.drawBackgroundImage=function(e,t){var o=this,i="";switch(t){case n.ZegoWhiteboardViewImageFitMode.ZegoWhiteboardViewImageFitModeLeft:i="left";break;case n.ZegoWhiteboardViewImageFitMode.ZegoWhiteboardViewImageFitModeRight:i="right";break;case n.ZegoWhiteboardViewImageFitMode.ZegoWhiteboardViewImageFitModeBottom:i="bottom";break;case n.ZegoWhiteboardViewImageFitMode.ZegoWhiteboardViewImageFitModeTop:i="top";break;case n.ZegoWhiteboardViewImageFitMode.ZegoWhiteboardViewImageFitModeCenter:i="center"}var r=new Image;r.setAttribute("crossOrigin","anonymous"),r.onload=function(){for(var r=o.graphicsBgConNode.childNodes,a=0,n=r.length;a<n;a++){var s=r[a];s.style.backgroundImage="url("+e+")",s.style.backgroundPosition=i,s.style.backgroundRepeat="no-repeat",s.style.backgroundSize="contain"}o.backgroundInfo.image=e,o.backgroundInfo.pos=i,o.backgroundInfo.mode=t},r.src=e},e.prototype.clearBackgroundImageLocal=function(){var e=this,t=this.toolInstance.graphicList.filter((function(e){return e.type===n.GraphicType.BgImage}));this.backgroundInfo.image="",this.backgroundInfo.pos="",this.backgroundInfo.mode=0,t.map((function(t){e.toolInstance.deleteHandle(t.graphic_id)}));for(var o=this.graphicsBgConNode.childNodes,i=0,r=o.length;i<r;i++){o[i].style.backgroundImage="none"}},e.prototype.backgroundImageUpdateToRemote=function(e,t){if(this.isRemote)this.isRemote=!1;else{var o=t?n.Action.Update:n.Action.Create;this.toolInstance.updateToRemoteNewHandle([e],o)}},e.prototype.updateToLocal=function(e){return this.isRemote=e,this},e.prototype.setBackgroundColor=function(e){this.graphicsBgConNode.style.backgroundColor=e},e.prototype.setBackgroundImage=function(e,t,o){var i=this;if(!e||t>4){var r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);return Promise.reject(r)}if(!this.toolInstance.enableDraw)return Promise.reject({});if(!this.toolInstance.getUserAuth().create){r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthCreateGraphic);return Promise.reject(r)}var a=!!this.backgroundInfo.image,s=this.toolInstance.graphicList.find((function(e){return e.type==n.GraphicType.BgImage}));if(a&&s&&!this.toolInstance.getUserAuth().update&&s.creator_id!==this.toolInstance.getUserID()){r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthUpdateGraphic);return Promise.reject(r)}if("string"==typeof e){var c=e;if(!c.startsWith("https://")){r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl);return Promise.reject(r)}return new Promise((function(o,r){var a=!0,s=new XMLHttpRequest;s.open("HEAD",c,!0),s.onreadystatechange=function(){if(4==s.readyState){if(200!=s.status){a=!1;var o=404===s.status?n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl:n.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp;return r(d.transError(o))}var p=(s.getResponseHeader("Content-Type")||"").replace("image/",""),u=+s.getResponseHeader("Content-Length");if(!"jpg,jpeg,png".includes(p)){var g=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return r(g)}if(u>10485760){g=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return r(g)}h.Logger.info(l("mod.setBackgroundImage"),JSON.stringify({params:{address:e}})),i.addBackgroundImageGraphic(c,t)}},s.onerror=function(){if(a){var e=404===s.status?n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl:n.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp;r(d.transError(e))}},s.send(null)}))}if(this.toolInstance.serviceHandle.isElectron&&"object"==typeof e){if(!/(\.jpg|\.jpeg|\.png)$/.test((e=e).path)){r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(r)}return h.Logger.info(l("mod.setBackgroundImage"),JSON.stringify({params:{address:e.path}})),this.toolInstance.serviceHandle.uploadImage(e.path,o).then((function(e){return i.addBackgroundImageGraphic(e,t)}))}var p=(e=e).type.replace("image/","");if(!"jpg,jpeg,png".includes(p)){r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(r)}if(e.size>10485760){r=d.transError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return Promise.reject(r)}return h.Logger.info(l("mod.setBackgroundImage"),JSON.stringify({params:{address:e.name}})),this.toolInstance.serviceHandle.uploadImage(e,o).then((function(e){return i.addBackgroundImageGraphic(e,t)}))},e.prototype.remoteAddBackgroundImageGraphic=function(e){var t=this.toolInstance.graphicList,o=t.find((function(e){return e.type===n.GraphicType.BgImage}));o?(o=Object.assign(o,e),this.toolInstance.setDataToGraphicList(o.graphic_id,{data:o.data})):t.push(e);var i=e.data,r=i.url,a=i.fit_mode;this.drawBackgroundImage(r,a)},e.prototype.addBackgroundImageGraphic=function(e,t){var o=this.toolInstance.graphicList,r={x:0,y:0,ex:0,ey:0,url:e,fit_mode:t,hash:""},a=s.createGraphicId(),d=o.find((function(e){return e.type===n.GraphicType.BgImage})),h=!!d;if(d){var l=d.data;d=i(i({},d),{data:r,oldData:l,operate_id:s.createGraphicId()}),this.toolInstance.setDataToGraphicList(d.graphic_id,{data:r})}else{d=i(i({graphic_id:a,operate_id:a,creator_id:this.toolInstance.getUserID()},c.default.basicState),{type:n.GraphicType.BgImage,x:0,y:0,initX:0,initY:0,data:r,oldData:{},zorder:0,layer:1,is_end_draw:!0});var p=JSON.parse(JSON.stringify(d));o.push(p)}return this.drawBackgroundImage(e,t),this.backgroundImageUpdateToRemote(d,h),Promise.resolve(e)},e.prototype.clearBackgroundImage=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){return this.isRemote?(this.clearBackgroundImageLocal(),this.isRemote=!1,[2]):this.toolInstance.enableDraw?(e=this.toolInstance.graphicList.find((function(e){return e.type==n.GraphicType.BgImage})),this.backgroundInfo.image&&e&&!this.toolInstance.getUserAuth().delete&&e.creator_id!==this.toolInstance.getUserID()?(this.toolInstance.sendError(n.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoAuthDeleteGraphic),[2]):(e&&(e.operate_id=s.createGraphicId(),this.clearBackgroundImageLocal(),this.toolInstance.updateToRemoteNewHandle([e],n.Action.Delete)),[2])):[2]}))}))},e}();t.Background=p},function(e,t,o){"use strict";var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,a){function n(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var o,i,r,a,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e],i=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var a=arguments[t],n=0,s=a.length;n<s;n++,r++)i[r]=a[n];return i};Object.defineProperty(t,"__esModule",{value:!0});var n=o(2),s=o(5),d=o(0),h=o(1),c=function(){function e(e,t){this.snapshotResult={image:""},this.canvasRatio=window.devicePixelRatio||1,this.toolInstance=e,this.backgroundInstance=t,this.file=this.toolInstance.serviceHandle.getFileInfo(this.toolInstance.whiteboardID),this.snapshotId=String(Date.now())}return e.prototype.snapshot=function(e){var t=this;return new Promise((function(o,a){return i(t,void 0,void 0,(function(){var t=this;return r(this,(function(i){return e&&(this.snapshotResult.userData=e),this.createCtx(),this.setWbBgColor(),this.setWbBgImage().then((function(){var e;if(t.file){var i={action:s.DomEventAction.Snapshot,ctx:t.docsCtx,snapshotId:t.snapshotId};t.toolInstance.conNode.dispatchEvent(new CustomEvent(s.DomEvent.Whiteboard,{detail:i}))}t.wbSnapshot();var r=null===(e=t.file)||void 0===e?void 0:e.fileType;r===d.FileType.PPTH5||r===d.FileType.CUSTOM_H5?t.snapshotResolve=o:(t.snapshotResult.image=t.mergeCanvas(),o(t.snapshotResult))})),[2]}))}))}))},e.prototype.getH5Snapshot=function(e){var t=this,o=this.toolInstance.viewInfo,i=o.viewWidth,r=o.viewHeight,a=new Image;a.src=e,a.onload=function(){t.docsCtx.drawImage(a,0,0,i,r),t.snapshotResult.image=t.mergeCanvas(),t.snapshotResolve(t.snapshotResult)}},e.prototype.mergeCanvas=function(){var e=this.toolInstance.viewInfo,t=e.viewWidth,o=e.viewHeight,i=document.createElement("canvas");i.width=t*this.canvasRatio,i.height=o*this.canvasRatio;var r=i.getContext("2d");return r.scale(this.canvasRatio,this.canvasRatio),r.drawImage(this.docsCanvas,0,0,t,o),r.drawImage(this.wbCanvas,0,0,t,o),i.toDataURL("image/png",1)},e.prototype.createCtx=function(){var e=this.toolInstance.viewInfo,t=e.viewWidth,o=e.viewHeight;this.wbCanvas=document.createElement("canvas"),this.wbCanvas.width=t*this.canvasRatio,this.wbCanvas.height=o*this.canvasRatio,this.wbCtx=this.wbCanvas.getContext("2d"),this.wbCtx.scale(this.canvasRatio,this.canvasRatio),this.docsCanvas=document.createElement("canvas"),this.docsCanvas.width=t*this.canvasRatio,this.docsCanvas.height=o*this.canvasRatio,this.docsCtx=this.docsCanvas.getContext("2d"),this.docsCtx.scale(this.canvasRatio,this.canvasRatio)},e.containImg=function(e,t,o,i,r,a,n){var s=e,d=t,h=o,c=i;return r>a?(c=a/r*h,r/a<=o/i&&(h=r/a*i)):r<=a&&(h=r/a*c),"top"==n?(d=0,s=e+(o-h)/2):"bottom"==n?(d=t+(i-c),s=e+(o-h)/2):"left"==n?(s=0,d=t+(i-c)/2):"right"==n?(s=e+(o-h),d=t+(i-c)/2):"center"==n&&(s=e+(o-h)/2,d=t+(i-c)/2),{dx:s,dy:d,dWidth:h,dHeight:c}},e.prototype.setWbBgColor=function(){var e=this.file?h.default.basicExtraState.defaultFileBgColor:h.default.basicState.bgColor;this.setBgColor(this.wbCtx,e)},e.prototype.setWbBgImage=function(){var t=this;return new Promise((function(o){var i=t.backgroundInstance.backgroundInfo,r=i.image,a=i.pos,n=t.toolInstance.viewInfo,s=n.viewWidth,d=n.height;if(r){var h=new Image;h.setAttribute("crossOrigin","Anonymous"),h.onload=function(){var i=e.containImg(0,0,s,d,h.width,h.height,a);t.wbCtx.drawImage(h,i.dx,i.dy,i.dWidth,i.dHeight),o()},h.src=r}else o()}))},e.prototype.setBgColor=function(e,t){var o=this.toolInstance.viewInfo,i=o.viewWidth,r=o.viewHeight;e.fillStyle=t,e.fillRect(0,0,i,r)},e.prototype.wbSnapshot=function(){var e=this.sortGraphics();if(e)for(var t=0,o=e;t<o.length;t++){var i=o[t],r=this.getCorrectData(i);switch(i.type){case d.GraphicType.Pencil:case d.GraphicType.Line:this.renderPencil(i,this.wbCtx,r);break;case d.GraphicType.Rect:this.renderRect(i,this.wbCtx,r);break;case d.GraphicType.Ellipse:this.renderEllipse(i,this.wbCtx,r);break;case d.GraphicType.Text:this.renderText(i,this.wbCtx,r);break;case d.GraphicType.Image:this.renderImage(i,this.wbCtx,r)}}},e.prototype.renderPencil=function(e,t,o){var i=n.transBezierBypointList(o);this.setCtxStyle(e,t),t.beginPath(),t.moveTo(i.moveTo[0],i.moveTo[1]),i.path.forEach((function(e){t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])})),t.stroke()},e.prototype.renderRect=function(e,t,o){var i=o[0],r=o[1],a=o[2]-i,n=o[3]-r;this.setCtxStyle(e,t),t.beginPath(),t.strokeRect(i,r,a,n)},e.prototype.renderEllipse=function(e,t,o){var i=o[0],r=o[1],a=(o[2]-i)/2,n=(o[3]-r)/2,s=i+a,d=r+n,h=a>n?Math.abs(a):Math.abs(n);this.setCtxStyle(e,t),t.beginPath(),t.save(),t.translate(s,d),t.scale(a/h,n/h),t.arc(0,0,h,0,2*Math.PI),t.restore(),t.stroke()},e.prototype.renderText=function(e,t,o){this.setCtxStyle(e,t);var i=o.split(","),r=i[0],a=i[1],n=i[2],s=this.toolInstance.getGraphicsHandle(e.graphic_id),d=this.getComputedFs(s.querySelector("pre")||s,"fontSize"),c=this.getComputedLh(s.querySelector("pre")||s,"lineHeight",d),l=(c-1)/2,p=n.split("\n"),u=h.default.textareaHPadding,g=h.default.textareaConBorderWidth;p.forEach((function(e,o){var i=+r+u+g,n=+a+d*c*o+d*l*1+g;t.fillText(""+e,i,n)}))},e.prototype.getComputedStyle=function(e,t,o){var i=window.getComputedStyle(e)[t];return o?o(i):i},e.prototype.getComputedLh=function(e,t,o){return this.getComputedStyle(e,t,(function(e){var t=1.2;return e.includes("px")&&(t=+e.replace(/px/,"")/o),t}))},e.prototype.getComputedFs=function(e,t){return this.getComputedStyle(e,t,(function(e){var t=12;return e.includes("px")&&(t=+e.replace(/px/,"")),t}))},e.prototype.renderImage=function(e,t,o){var i=o[0],r=o[1],a=o[2]-i,n=o[3]-r,s=this.toolInstance.graphicsConNode.querySelector("#"+h.default.reservedPrefix.graphics+e.graphic_id);"image"===(null==s?void 0:s.nodeName)&&t.drawImage(s,i,r,a,n)},e.prototype.setCtxStyle=function(e,t){var o=this.toolInstance.viewInfo.viewWidth,i=n.calSizeHandle(e.size,d.GraphicType.Pencil,o,!1);if(t.strokeStyle=e.color,t.fillStyle=e.color,e.type!==d.GraphicType.Text)t.lineWidth=i,t.lineJoin="round",t.lineCap="round";else{var r=this.toolInstance.getGraphicsHandle(e.graphic_id),a=this.getComputedFs(r.querySelector("pre")||r,"fontSize")+"px",s="string"==typeof e.attributes?JSON.parse(e.attributes):{},h=s.bold?"bold":"",c=s.italic?"italic":"",l=window.getComputedStyle(r.querySelector("pre")||r).fontFamily.replace(/"/g,"");t.textBaseline="hanging",t.font=c+" "+h+" "+a+" "+l+" "}},e.prototype.sortGraphics=function(){var e=this;return JSON.parse(JSON.stringify(this.toolInstance.graphicList)).filter((function(t){return e.toolInstance.getGraphicsHandle(t.graphic_id)})).sort((function(e,t){return(e.zorder||0)-(t.zorder||0)}))},e.prototype.getCorrectData=function(e){var t=e.type,o=e.data;switch(t){case d.GraphicType.Image:var i=e.data;o=this.correctData([i.x,i.y,i.ex,i.ey]);break;case d.GraphicType.Pencil:case d.GraphicType.Line:case d.GraphicType.Rect:case d.GraphicType.Ellipse:var r=this.correctData(e.data);o=this.getTransData(e,r);break;case d.GraphicType.Text:var n=e.data.split(","),s=n[2],h=this.correctData([+n[0],+n[1]]),c=this.getTransData(e,a(h));o=a(c,[s]).join(",")}return o},e.prototype.correctData=function(e){var t,o=this.toolInstance.viewInfo,i=o.direction,r=o.page,a=o.viewWidth,n=o.viewHeight,s=o.isScroll,h=o.zoom;if(i===d.ZegoWhiteboardViewScrollDirection.Center)return e;if(i===d.ZegoWhiteboardViewScrollDirection.Horizontal&&r)t=e.map((function(e,t){return t%2==0&&(e-=(r-1)*a),e}));else if(i===d.ZegoWhiteboardViewScrollDirection.Vertical&&r){var c=this.toolInstance.whiteboardNode.parentNode.scrollTop;t=e.map((function(e,t){return t%2==1&&(e-=s?c/h:(r-1)*n),e}))}return t},e.prototype.getTransData=function(e,t){var o=e.x,i=e.y;return t.map((function(e,t){return e+=t%2==0?o:i}))},e}();t.Snapshot=c},function(e,t,o){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=o(38),s=o(1),d=o(4),h=o(2),c=o(0),l=function(e){function t(t){var o=e.call(this,"electron")||this;return o.modIdMapData={},o.listenerList={},o.zorderSeq=1,o.graphicMap={},o.userAuthMap={model:{scale:1,scroll:1,update:1,delete:1,move:1,clear:1,create:1}},o.zegoAdapter=t,o}return r(t,e),t.prototype.updateMap=function(e){var t=this.getMap(e.whiteboardID);t?Object.assign(t,e):this.modIdMapData[e.whiteboardID]=a({direction:c.ZegoWhiteboardViewScrollDirection.Horizontal,width:0,height:0,viewWidth:0,viewHeight:0,horizontalPercent:0,verticalPercent:0,pptStep:1,modScale:{scale:1,ofs_x:0,ofs_y:0},modExtra:""},e)},t.prototype.getMap=function(e){return this.modIdMapData[e]},t.prototype.deleteMap=function(e){delete this.modIdMapData[e]},t.prototype.setGraphicMap=function(e){var t=this;e.forEach((function(e){var o=e.graphic_id,i=e.is_end_draw,r=e.server_timestamp,a=e.operate_id,n=e.type,s=e.data;t.graphicMap[o]={is_end_draw:!a||i,server_timestamp:+r||0,operate_id:a,type:n,pointData:{x:e.x||0,y:e.y||0,px:e.px||0,py:e.py||0,data:"object"==typeof s?JSON.parse(JSON.stringify(s)):s}}}))},t.prototype.getFullH5Target=function(e,t){var o=this.getH5Extra(e);if(o&&t&&t.includes("H5_target"))try{o=JSON.parse(o).H5_target;var i=JSON.parse(t).H5_target,r=i.p,a=i.s,n=i.e;if(o.p==r&&o.s==a){if(n[0].s){var s=n[0].id,d=o.e.findIndex((function(e){return e.id===s}));-1===d?o.e.push(n[0]):o.e[d]=n[0]}else o.e.push(n[0]);t=JSON.stringify(o)}}catch(n){}return t},t.prototype.actionListener=function(e){for(var t,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];this.listenerList[e]&&(t=this.listenerList)[e].apply(t,o)},t.prototype.bindListener=function(e,t){this.listenerList[e]=t},t.prototype.onRemotePush=function(){var e=this;this.zegoAdapter.onEventHandler("onPushDrawGraphics",(function(t){var o=t.resBody,i=o.graphic_list,r=o.del_graphic_id_list,a=void 0===r?[]:r,n=o.mod_id+"";i&&(i.forEach((function(t){t.zorder&&t.zorder>e.zorderSeq&&(e.zorderSeq=t.zorder),"number"!=typeof t.color?t.color=s.default.basicState.color:t.color=h.transColor(t.color,!0),t.is_end_draw=!t.operate_id||t.is_operate_finish})),e.setGraphicMap(i)),a=a.map(String),e.actionListener(c.ZegoServiceEventType.PushDrawPageGraphics,n,i||[],a)})),this.zegoAdapter.onEventHandler("onPushClearGraphics",(function(t){e.zegoAdapter.isClearDone=!0,e.graphicMap={},e.actionListener(c.ZegoServiceEventType.PushClearPageGraphics,t.resBody.mod_id+"")})),this.zegoAdapter.onEventHandler("onPushScrolled",(function(t){var o=t.whiteboard_id,i=t.horizontal_scroll_percent,r=t.vertical_scroll_percent,a=t.step;o+="",e.updateMap({whiteboardID:o,horizontalPercent:i,verticalPercent:r,pptStep:a,modExtra:""}),e.actionListener(c.ZegoServiceEventType.PushScroll,o,i,r,a)})),this.zegoAdapter.onEventHandler("onPushScaled",(function(t){var o=t.whiteboard_id,i=t.scalefactor,r=t.xoffsetpercent,a=t.yoffsetpercent;o+="",e.updateMap({whiteboardID:o,modScale:{scale:i,ofs_x:r,ofs_y:a}}),e.actionListener(c.ZegoServiceEventType.PushScale,o,i,r,a)})),this.zegoAdapter.onEventHandler("onPushSetMod",(function(t){var o=t.resBody.action_list,i=o[0],r=i.action,a=i.mod_id;2===r?(e.deleteMap(a),e.actionListener(c.ZegoServiceEventType.PushRemovedMod,a)):1===r&&(e.updateMap(o[0]),e.actionListener(c.ZegoServiceEventType.PushAddMod,a))})),this.zegoAdapter.onEventHandler("onPushH5Extra",(function(t){var o=t.resBody,i=o.mod_id,r=o.extra;e.updateMap({whiteboardID:i,modExtra:e.getFullH5Target(i,r)}),e.actionListener(c.ZegoServiceEventType.PushH5ExtraAppended,i,r)})),this.zegoAdapter.onEventHandler("onUserAuthUpdate",(function(t){var o=t.auth,i=t.type;"wb"==i&&(e.userAuthMap.model.scale=null==o?void 0:o.scale,e.userAuthMap.model.scroll=null==o?void 0:o.scroll,e.actionListener(c.ZegoServiceEventType.PushAuthChange,o,null)),"graphic"==i&&(e.userAuthMap.model.update=null==o?void 0:o.update,e.userAuthMap.model.delete=null==o?void 0:o.delete,e.userAuthMap.model.move=null==o?void 0:o.move,e.userAuthMap.model.clear=null==o?void 0:o.clear,e.userAuthMap.model.create=null==o?void 0:o.create,e.actionListener(c.ZegoServiceEventType.PushAuthChange,null,o))}))},t.prototype.getModName=function(e){var t=this.getMap(e);return t?t.name:""},t.prototype.getScrollPercent=function(e){var t=this.getMap(e);return{horizontalPercent:t.horizontalPercent,verticalPercent:t.verticalPercent,pptStep:t.pptStep,direction:t.direction}},t.prototype.getScale=function(e){var t=this.getMap(e).modScale;return{scaleFactor:t.scale,scaleOffsetX:t.ofs_x,scaleOffsetY:t.ofs_y}},t.prototype.getAspectRatio=function(e){var t=this.getMap(e);return t.aspectWidth+":"+t.aspectHeight},t.prototype.getRoomID=function(e){return this.getMap(e).roomID},t.prototype.getPageCount=function(e){return this.getMap(e).pageCount},t.prototype.getFileInfo=function(e){var t=this.getMap(e);return(null==t?void 0:t.fileInfo)||null},t.prototype.setSize=function(e,t,o){var i=this.getMap(e);return!!(i&&t&&o)&&(i.width=t,i.height=o,i.direction=t>=o?c.ZegoWhiteboardViewScrollDirection.Horizontal:c.ZegoWhiteboardViewScrollDirection.Vertical,this.zegoAdapter.setSize(+e,{width:t,height:o},{width:i.viewWidth,height:i.viewHeight}),!0)},t.prototype.setViewSize=function(e,t,o){var i=this.getMap(e);i&&t&&o&&(i.viewWidth=t,i.viewHeight=o,this.zegoAdapter.setSize(+e,{width:i.width,height:i.height},{width:t,height:o}))},t.prototype.undo=function(e){this.zegoAdapter.undo(+e)},t.prototype.redo=function(e){this.zegoAdapter.redo(+e)},t.prototype.createMod=function(e){var t=this;return new Promise((function(o,i){t.zegoAdapter.createMod(e,(function(r){var n=r.resBody,s=n.code,h=n.message,c=n.mod_id;0===s?(t.updateMap(a({whiteboardID:c},e)),o(c)):i(d.transError(s,h))}))}))},t.prototype.destroyMod=function(e){var t=this;return new Promise((function(o,i){t.zegoAdapter.destroyMod(+e,(function(e){var r=e.resBody,a=r.code,n=r.message,s=r.mod_id;0===a?(t.deleteMap(s+""),o()):i(d.transError(a,n))}))}))},t.prototype.clearView=function(e,t){var o=this;return new Promise((function(i){t&&1===t.length&&t.includes(1)?o.zegoAdapter.clearBackgroundImage(+e):o.zegoAdapter.clearView(+e),i(e)}))},t.prototype.updateToRemoteHandle=function(e,t,o,i){t[0]&&(t.forEach((function(e){e.color=h.transColor(e.color,!1)})),this.zegoAdapter.updateToRemoteHandle(+e,t),o&&o())},t.prototype.getModList=function(){var e=this;return new Promise((function(t,o){e.zegoAdapter.getModList((function(i){var r=i.resBody,a=r.code,n=r.message,s=r.mod_list;0===a?(s.forEach((function(t){e.updateMap(t)})),t(s.map((function(e){return e.whiteboardID+""})))):o(d.transError(a,n))}))}))},t.prototype.scroll=function(e,t,o,i,r){var a=this;if(r&&!r.scaleOffsetY){var n=this.getMap(e).modScale,s=n.scale,d=n.ofs_x;r.scaleFactor=s,r.scaleOffsetX=d}this.zegoAdapter.scroll({whiteboard_id:+e,horizontal_percent:t,vertical_percent:o,step:i},(function(e){var i=e.error_code,r=e.whiteboard_id,n=e.horizontal_scroll_percent,s=e.vertical_scroll_percent,d=e.step;r+="",a.updateMap({whiteboardID:r,horizontalPercent:t,verticalPercent:o,pptStep:d,modExtra:""}),0!=i&&a.actionListener(c.ZegoServiceEventType.PushScroll,r,n,s,d)}),r)},t.prototype.scale=function(e,t,o,i){var r=this;this.zegoAdapter.scale({whiteboard_id:+e,scalefactor:t,xoffsetpercent:o,yoffsetpercent:i},(function(e){var t=e.error_code,o=e.whiteboard_id,i=e.scalefactor,a=e.xoffsetpercent,n=e.yoffsetpercent;o+="",r.updateMap({whiteboardID:o,modScale:{scale:i,ofs_x:a,ofs_y:n}}),0!=t&&r.actionListener(c.ZegoServiceEventType.PushScale,o,i,a,n)}))},t.prototype.loadCurrentGraphics=function(e,t,o){this.zegoAdapter.loadCurrentGraphics({whiteboard_id:+e,horizontal_percent:t,vertical_percent:o})},t.prototype.getCreateTime=function(e){var t=this.getMap(e);return t?t.createTime:0},t.prototype.getUserID=function(){return this.zegoAdapter.getUserID()},t.prototype.appendH5Extra=function(e,t){var o=this;this.zegoAdapter.appendH5Extra({whiteboard_id:+e,extra:t},(function(i){var r=i.resBody,a=r.code,n=r.mod_id,s=r.oldExtra;e==n&&(0===a?o.updateMap({whiteboardID:n,modExtra:o.getFullH5Target(n,t)}):"string"==typeof s&&o.actionListener(c.ZegoServiceEventType.PushH5ExtraAppended,n,s))}))},t.prototype.getH5Extra=function(e){return this.getMap(e).modExtra},t.prototype.uploadImage=function(e,t){var o=this;return new Promise((function(i,r){"object"==typeof e&&(e=e.path);var a=o.zegoAdapter.uploadFile(e);if(!a){var n=d.transError(c.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl);r(n)}o.zegoAdapter.onEventHandler("onUploadFile"+a,(function(e){var n=e.resBody,s=n.url,h=n.finish,c=n.code;if(0!==c){var l=d.transError(c);r(l)}else t(e.resBody);h&&(o.zegoAdapter.onEventHandler("onUploadFile"+a,null),i(s))}))}))},t.prototype.createZorder=function(){return++this.zorderSeq},t.prototype.getGraphicIsEndDraw=function(e){try{var t=this.graphicMap[e],o=t.is_end_draw,i=t.server_timestamp;return!!(o||(new Date).getTime()<i)}catch(e){return!0}},t.prototype.getUserAuth=function(){return this.userAuthMap.model},t.prototype.enableHandwriting=function(e){this.zegoAdapter.enableHandwriting(e)},t.prototype.isAppendPathLimit=function(e,t){var o=t.oldData;return Promise.resolve(o.length>1e3)},t.prototype.reloadViewGraphics=function(e,t){},t}(n.ZegoWhiteboardServiceBase);t.ZegoWhiteboardService=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r=function(){function e(e){var t;this.isElectron=!1,this.customListenerList=((t={})[i.ZegoEventType.Error]=[],t[i.ZegoEventType.ViewAdd]=[],t[i.ZegoEventType.ViewRemoved]=[],t[i.ZegoEventType.ViewScroll]=[],t[i.ZegoEventType.WhiteboardAuthChange]=[],t[i.ZegoEventType.WhiteboardGraphicAuthChange]=[],t),this.isElectron="electron"===e}return e.prototype.bindCustomListener=function(e,t){return!!this.customListenerList[e]&&("function"==typeof t&&(-1==this.customListenerList[e].indexOf(t)&&this.customListenerList[e].push(t),!0))},e.prototype.deleteCustomListener=function(e,t){if(!this.customListenerList[e])return!1;var o=this.customListenerList[e];return t?o.splice(o.indexOf(t),1):this.customListenerList[e]=[],!0},e.prototype.actionCustomListener=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.customListenerList[e]&&this.customListenerList[e].forEach((function(e){e.apply(void 0,t)}))},e}();t.ZegoWhiteboardServiceBase=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r=o(3),a=r.getLogAction.bind(null,"wb.s."),n=function(e){},s={},d={},h=function(e){return s[e]||+e},c=function(e){return d[e]||+e},l=function(){function e(e){this.inited=!1,this.zegoClient=null,this.isBeginUpdate=!1,this.isBeginDraw=!1,this.isBeginDrawLine=!1,this.isClearDone=!1,this.lastPoint=null,this.eventHandler={onCreateMod:n,onDestroyMod:n,onGetModList:n,onSendScroll:n,onAppendH5Extra:n,onPushDrawGraphics:n,onPushClearGraphics:n,onPushSetMod:n,onPushScrolled:n,onPushH5Extra:n,onUploadFile:n,onUserAuthUpdate:n,onSendScale:n,onPushScaled:n},this.zegoClient=e,this.init()}return e.prototype.onEventHandler=function(e,t){this.eventHandler[e]=t},e.prototype.createMod=function(e,t){var o=e.name,i=e.aspectWidth,r=e.aspectHeight,a=e.roomID,n=e.pageCount,s=e.fileInfo;t&&this.onEventHandler("onCreateMod",t);var d=this.zegoClient.whiteboardModelMake({mode:1});this.zegoClient.whiteboardModelGetId({whiteboard_model:d});this.zegoClient.whiteboardModelSetName({whiteboard_model:d,name:o}),this.zegoClient.whiteboardModelSetAspectRatio({whiteboard_model:d,width:+i,height:+r}),this.setFileContent(d,a,n,s),this.zegoClient.whiteboardCreate({whiteboard_model:d,is_public:!0,width:+i,height:+r})},e.prototype.destroyMod=function(e,t){t&&this.onEventHandler("onDestroyMod",t),this.zegoClient.whiteboardDestroy({whiteboard_id:e})},e.prototype.getModList=function(e){e&&this.onEventHandler("onGetModList",e),this.zegoClient.whiteboardGetList()},e.prototype.undo=function(e){this.zegoClient.whiteboardCanvasUndo({whiteboard_id:e}),r.Logger.info(a("gra.undo"),JSON.stringify({params:e}))},e.prototype.redo=function(e){this.zegoClient.whiteboardCanvasRedo({whiteboard_id:e}),r.Logger.info(a("gra.redo"),JSON.stringify({params:e}))},e.prototype.clearView=function(e){this.isClearDone=!1,this.lastPoint=null,this.zegoClient.whiteboardCanvasClear({whiteboard_id:e}),r.Logger.info(a("gra.clear"),JSON.stringify({params:e}))},e.prototype.uploadFile=function(e){return r.Logger.info(a("gra.upload"),JSON.stringify({params:e})),this.zegoClient.whiteboardUploadFile({path:e})},e.prototype.clearBackgroundImage=function(e){r.Logger.info(a("gra.clear_bg_image"),JSON.stringify({params:e})),this.zegoClient.whiteboardCanvasCleanBackground({whiteboard_id:e})},e.prototype.updateToRemoteHandle=function(e,t){if(r.Logger.info(a("gra.draw"),JSON.stringify({mod_id:e,params:t})),t.length>1)if(t.every((function(e){return e.action==i.Action.Move})))try{this.moveGraphicListHandle(e,t)}catch(e){}else t.every((function(e){return e.action==i.Action.Delete}))&&this.deleteGraphicListHandle(e,t);else{var o=t[0];switch(o.action){case i.Action.Create:case i.Action.Append:this.executeDrawNewGraphic(e,o);break;case i.Action.Move:this.moveGraphicHandle(e,o);break;case i.Action.Delete:this.deleteGraphicHandle(e,o);break;case i.Action.Update:this.updateGraphicHandle(e,o)}}},e.prototype.setSize=function(e,t,o){e&&t.width&&t.height&&o.width&&o.height&&(r.Logger.info(a("mod.setSize"),JSON.stringify({params:{id:e,realSize:t,viewSize:o}})),this.zegoClient.whiteboardSetSize({whiteboard_id:e,width:t.width,height:t.height}),this.zegoClient.whiteboardSetViewportSize({whiteboard_id:e,width:o.width,height:o.height}))},e.prototype.scroll=function(e,t,o){this.zegoClient.whiteboardScrollCanvas(e),this.zegoClient.whiteboardAppendH5Extra({whiteboard_id:e.whiteboard_id,extra:""}),o&&this.zegoClient.whiteboardScaleCanvas({whiteboard_id:e.whiteboard_id,scalefactor:o.scaleFactor,xoffsetpercent:o.scaleOffsetX,yoffsetpercent:0}),t&&this.onEventHandler("onSendScroll",t)},e.prototype.loadCurrentGraphics=function(e){this.zegoClient.whiteboardLoadCurrentGraphics(e)},e.prototype.scale=function(e,t){this.zegoClient.whiteboardScaleCanvas(e),t&&this.onEventHandler("onSendScale",t)},e.prototype.appendH5Extra=function(e,t){t&&this.onEventHandler("onAppendH5Extra",t),this.zegoClient.whiteboardAppendH5Extra(e)},e.prototype.getGraphicOperateAuth=function(e){var t=e.operate_type,o=e.whiteboard_id,i=e.graphic_id_list;return this.zegoClient.whiteboardCanvasCanOperated({operate_type:t,whiteboard_id:o,graphic_id_list:i})},e.prototype.getWhiteboardOperateAuth=function(e){return this.zegoClient.whiteboardCanOperated({operate_type:e})},e.prototype.getUserID=function(){return this.zegoClient.getUserID()},e.prototype.enableHandwriting=function(e){this.zegoClient.whiteboardSettingsSetGraphicStroke({graphic_type:i.GraphicType.Pencil,is_stroke:e}),r.Logger.info(a("gra.enableHandwriting"),JSON.stringify({enable:e}))},e.prototype.init=function(){this.inited&&this.zegoClient.whiteboardUninit(),this.registerWhiteBoardEventCallBack(),this.inited=this.zegoClient.whiteboardInit(),this.inited||(this.callCreateModCallBack(-1,"createMod failed: whiteboard init failed",0),r.Logger.info(a("mod.init"),"init failed"))},e.prototype.deleteGraphicHandle=function(e,t){var o=c(t.graphic_id);this.zegoClient.whiteboardCanvasDeleteItem({whiteboard_id:e,graphic_id:o}),this.graphicEndDraw(e,!0),this.graphicEndUpdate(e,!0),r.Logger.info(a("gra.delete"),JSON.stringify({mod_id:e,gid:o,_gid:t.graphic_id}))},e.prototype.moveGraphicHandle=function(e,t){var o=t.x,r=t.y,a=c(t.graphic_id),n=t.is_end_draw;!this.isBeginUpdate&&n&&t.type==i.GraphicType.Image&&(n=!1),this.graphicBeginUpdate(e,n),this.zegoClient.whiteboardCanvasMoveItem({whiteboard_id:e,graphic_id:a,x:o,y:r}),this.graphicEndUpdate(e,t.is_end_draw)},e.prototype.updateGraphicHandle=function(e,t){var o=t.is_end_draw;switch(t.type){case i.GraphicType.Text:this.updateGraphicTextHandle(e,t);break;case i.GraphicType.Rect:case i.GraphicType.Ellipse:case i.GraphicType.Line:this.isBeginDraw&&(this.executeDrawNewGraphic(e,t),this.graphicEndDraw(e,o));break;case i.GraphicType.Laser:this.isBeginDraw?this.graphicEndDraw(e,!0):this.executeDrawNewGraphic(e,t);break;case i.GraphicType.Pencil:this.createGraphicPencilHandle(e,t,o),this.graphicEndDraw(e,o);break;case i.GraphicType.Image:this.updateImageGraphicHandle(e,t);break;case i.GraphicType.BgImage:this.updateGraphicBgImageHandle(e,t)}r.Logger.info(a("gra.update_"+t.type),JSON.stringify({mod_id:e,graphic:t}))},e.prototype.createGraphicPencilHandle=function(e,t,o){var i,n;void 0===o&&(o=!1);var s=t.data;if(o){if(!this.lastPoint)return;var d=this.lastPoint.data.slice(-2).join(","),h=(null===(i=s.join(","))||void 0===i?void 0:i.split(d))||[];s=(null===(n=h[h.length-1])||void 0===n?void 0:n.split(",").filter((function(e){return!!e})).map((function(e){return+e})))||d.split(","),r.Logger.info(a("gra.create_pencil"),JSON.stringify({str:d,array:s,data:t.data}))}for(var c=0;c<s.length;c+=2)this.zegoClient.whiteboardCanvasDrawPath({whiteboard_id:e,x:s[c],y:s[c+1]});this.lastPoint=t},e.prototype.updateGraphicTextHandle=function(e,t){var o=t.is_end_draw,i=c(t.graphic_id);this.setGraphicAttr(t.type,t.color,t.size,t.attributes);var r=t.data.split(",");this.isBeginDraw?(this.zegoClient.whiteboardCanvasDrawText({whiteboard_id:e,text:r.slice(2).join(",")}),this.graphicEndDraw(e,o)):(this.graphicBeginUpdate(e,o),this.isBeginUpdate&&this.zegoClient.whiteboardCanvasEditText({whiteboard_id:e,graphic_id:i,text:r.slice(2).join(",")}),this.graphicEndUpdate(e,o))},e.prototype.updateImageGraphicHandle=function(e,t){var o=c(t.graphic_id),i=t.data;this.graphicBeginUpdate(e,t.is_end_draw),this.zegoClient.whiteboardCanvasEditImage({whiteboard_id:e,graphic_id:o,pos_x:i.x,pos_y:i.y,epos_x:i.ex,epos_y:i.ey}),this.graphicEndUpdate(e,t.is_end_draw)},e.prototype.updateGraphicBgImageHandle=function(e,t){var o=t.data;this.createGraphicId(e,t.type,0,0),this.zegoClient.whiteboardCanvasSetBackground({whiteboard_id:e,path:o.url,hash:o.hash,fit_mode:o.fit_mode}),this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e})},e.prototype.moveGraphicListHandle=function(e,t){var o=[].concat(t.map((function(e){return{graphic_id:c(e.graphic_id),x:e.x,y:e.y}}))),i=t[0];this.graphicBeginUpdate(e,i.is_end_draw),this.zegoClient.whiteboardCanvasMoveItems({whiteboard_id:e,move_info_list:o}),this.graphicEndUpdate(e,i.is_end_draw)},e.prototype.deleteGraphicListHandle=function(e,t){var o=[].concat(t.map((function(e){return{graphic_id:c(e.graphic_id)}})));this.zegoClient.whiteboardCanvasDeleteItems({whiteboard_id:e,delete_list:o})},e.prototype.graphicBeginUpdate=function(e,t){this.isBeginUpdate||t||(this.zegoClient.whiteboardCanvasBeginUpdate({whiteboard_id:e}),this.isBeginUpdate=!0,r.Logger.warn(a("gra.beginUpdate"),JSON.stringify({mod_id:e,isBeginDraw:this.isBeginDraw})))},e.prototype.graphicEndUpdate=function(e,t){this.isBeginUpdate&&t&&(this.zegoClient.whiteboardCanvasEndUpdate({whiteboard_id:e}),this.isBeginUpdate=!1,r.Logger.warn(a("gra.endUpdate"),JSON.stringify({mod_id:e,isBeginDraw:this.isBeginDraw})))},e.prototype.graphicBeginDraw=function(e,t){var o=[i.GraphicType.Image,i.GraphicType.BgImage,i.GraphicType.Laser],n=t.type,h=t.graphic_id,c=t.data,l=t.is_end_draw,p=this.getGraphicBoundingClientRect(n,c),u=p.x1,g=p.y1,f=h;if(this.lastPoint&&t.type==i.GraphicType.Pencil&&this.lastPoint.graphic_id!==t.graphic_id&&this.graphicEndDraw(e,!0),!this.isBeginDraw&&!l||o.includes(n)||t.type==i.GraphicType.Text&&t.is_end_draw){n==i.GraphicType.BgImage&&(u=0,g=0),this.setGraphicAttr(n,t.color,t.size,t.attributes);var v=this.createGraphicId(e,n,u,g);s[v]=+f,d[f]=v,this.isBeginDraw=!0,r.Logger.warn(a("gra.beginDraw"),JSON.stringify({mod_id:e,isBeginDraw:this.isBeginDraw}))}},e.prototype.graphicEndDraw=function(e,t){this.isBeginDraw&&t&&(this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e}),this.isBeginDraw=!1,this.isBeginDrawLine=!1,this.lastPoint=null,r.Logger.warn(a("gra.endDraw"),JSON.stringify({mod_id:e,isBeginDraw:this.isBeginDraw})))},e.prototype.createGraphicId=function(e,t,o,i){return this.zegoClient.whiteboardCanvasBeginDraw({whiteboard_id:+e,graphic_type:t,x:o,y:i})},e.prototype.setGraphicAttr=function(e,t,o,r){this.zegoClient.whiteboardSettingsSetGraphicColor({graphic_type:e,color:t}),this.zegoClient.whiteboardSettingsSetGraphicSize({graphic_type:e,size_level:+o});var a=!1,n=!1;try{var s=JSON.parse(r||"{}");a=!!s.bold,n=!!s.italic}catch(e){}this.zegoClient.whiteboardSettingsSetGraphicBold({graphic_type:i.GraphicType.Text,is_bold:a}),this.zegoClient.whiteboardSettingsSetGraphicItalic({graphic_type:i.GraphicType.Text,is_italic:n})},e.prototype.getH5ExtraByModel=function(e){return this.zegoClient.whiteboardModelGetH5Extra?this.zegoClient.whiteboardModelGetH5Extra(e):""},e.prototype.getModInfo=function(e){var t={whiteboard_model:e},o=this.zegoClient.whiteboardModelGetScrollPercent({whiteboard_model:e,direction:2})||{},i=this.zegoClient.whiteboardModelGetScaleFactor({whiteboard_model:e})||{},n=this.zegoClient.whiteboardModelGetAspectRatio(t),s=n.width,d=n.height,h={whiteboardID:this.zegoClient.whiteboardModelGetId(t)+"",name:this.zegoClient.whiteboardModelGetName(t),aspectWidth:+s,aspectHeight:+d,horizontalPercent:o.horizontal_percent||0,verticalPercent:o.vertical_percent||0,pptStep:o.step||1,h5Extra:this.getH5ExtraByModel(t),scaleFactor:i.scalefactor||0,scaleOffsetX:i.xoffsetpercent||0,scaleOffsetY:i.yoffsetpercent||0},c=this.zegoClient.whiteboardModelGetContent(t);if(c)try{var l=JSON.parse(c);if(l){h.roomID=l.room_id,h.pageCount=l.whiteboard_page_count||1;var p=l.file_info;p&&(h.fileInfo={fileID:p.file_id,fileName:p.file_name,authKey:p.auth_key,fileType:p.file_type})}}catch(e){}return r.Logger.info(a("mod.info"),JSON.stringify({scroll:o,content:c,mod_item:h})),h},e.prototype.setFileContent=function(e,t,o,i){this.zegoClient.whiteboardModelSetContent({whiteboard_model:e,content:JSON.stringify({room_id:t,whiteboard_page_count:o||void 0,file_info:i?{file_id:i.fileID,file_name:i.fileName,auth_key:i.authKey,file_type:i.fileType}:void 0})})},e.prototype.getGraphicBoundingClientRect=function(e,t){if(e==i.GraphicType.Text){var o=t.split(",");return{x1:+o[0],y1:+o[1],x2:o.slice(2).join(",")}}if(e==i.GraphicType.Pencil||e==i.GraphicType.Line)return{x1:t[0],y1:t[1]};if(e==i.GraphicType.Image)return{x1:t.x,y1:t.y};var r=Math.min(t[0]),a=Math.min(t[1]);return{x1:r,y1:a,x2:t[2]?Math.max(t[2]):r,y2:t[3]?Math.max(t[3]):a}},e.prototype.getGraphicLeftTop=function(e,t){if(e==i.GraphicType.Laser)return{x:0,y:0};if(e==i.GraphicType.Text){var o=t.split(",");return{x:+o[0],y:+o[1]}}if(e==i.GraphicType.Pencil){for(var r=t[0],a=t[1],n=2;n<t.length;n+=2)t[n]<r&&(r=t[n]),t[n+1]<a&&(a=t[n+1]);return{x:r,y:a}}var s=t[0],d=t[1],h=t[2],c=t[3];return{x:Math.min(s,h),y:Math.min(d,c)}},e.prototype.executeDrawNewGraphic=function(e,t){e=+e;var o=t.type,n=t.data,s=this.getGraphicBoundingClientRect(o,n);this.graphicBeginDraw(e,t);var d=t.action;if(o==i.GraphicType.Pencil&&d==i.Action.Append)this.createGraphicPencilHandle(e,t);else if(o==i.GraphicType.Text)this.zegoClient.whiteboardCanvasDrawText({whiteboard_id:e,text:s.x2}),d==i.Action.Create&&t.is_end_draw&&this.isBeginDraw&&this.graphicEndDraw(e,t.is_end_draw);else if(o==i.GraphicType.Line)this.isBeginDrawLine?this.zegoClient.whiteboardCanvasDrawLine({whiteboard_id:e,x:t.data[2],y:t.data[3]}):(this.zegoClient.whiteboardCanvasDrawLine({whiteboard_id:e,x:t.data[0],y:t.data[1]}),this.isBeginDrawLine=!0);else if(o==i.GraphicType.Rect)this.zegoClient.whiteboardCanvasDrawRect({whiteboard_id:e,x:s.x2,y:s.y2});else if(o==i.GraphicType.Ellipse)this.zegoClient.whiteboardCanvasDrawEllipse({whiteboard_id:e,x:s.x2,y:s.y2});else if(o==i.GraphicType.Laser)this.graphicEndDraw(e,!0);else if(o==i.GraphicType.Image){var h="string"==typeof t.data?JSON.parse(t.data):t.data;this.zegoClient.whiteboardCanvasAddImage({whiteboard_id:e,path:h.url,pos_x:h.ex,pos_y:h.ey,hash:""}),this.graphicEndDraw(e,!0)}else if(o==i.GraphicType.BgImage){var c="string"==typeof t.data?JSON.parse(t.data):t.data;this.zegoClient.whiteboardCanvasSetBackground({whiteboard_id:e,path:c.url,hash:"",fit_mode:c.fit_mode}),this.graphicEndDraw(e,t.is_end_draw)}r.Logger.info(a("gra.create"),JSON.stringify({mod_id:e,type:o,_gid:t.graphic_id,data:t.data}))},e.prototype.callCreateModCallBack=function(e,t,o){var i={resBody:{code:e,message:t,mod_id:o+""}};this.eventHandler.onCreateMod(i)},e.prototype.callPushDrawGraphicsCallback=function(e,t){var o={resBody:{graphic_list:[t],mod_id:e.whiteboard_id+""}};this.eventHandler.onPushDrawGraphics(o)},e.prototype.onWhiteBoardCanvasPathUpdate=function(e){for(var t=e.points.length,o=new Array(2*t).fill(0),n=0;n<t;n++){var s=e.points[n],d=s.x,c=s.y;o[2*n]=d,o[2*n+1]=c}var l=e.pos_x,p=e.pos_y,u={_graphic_id:e.graphic_id+"",graphic_id:h(e.graphic_id)+"",data:o,x:l,y:p,type:i.GraphicType.Pencil,color:e.graphic_color,size:e.graphic_size,zorder:e.zorder,is_operate_finish:e.is_operate_finished,server_timestamp:e.operate_timeout,operate_id:e.operator_id,operate_name:e.operator_name,creator_id:e.creator_id,attributes:JSON.stringify({stroke:!!e.is_stroke})};this.callPushDrawGraphicsCallback(e,u),r.Logger.info(a("gra.update"),JSON.stringify({type:i.GraphicType.Pencil,result:u,rs:e}))},e.prototype.onWhiteBoardCanvasTextUpdate=function(e){var t=e.pos_x,o=e.pos_y,n={_graphic_id:e.graphic_id+"",graphic_id:h(e.graphic_id)+"",data:e.point_begin.x+","+e.point_begin.y+","+e.text,x:t,y:o,zorder:e.zorder,type:i.GraphicType.Text,color:e.graphic_color,size:e.graphic_size,attributes:JSON.stringify({bold:!!e.is_bold,italic:!!e.is_italic}),is_operate_finish:e.is_operate_finished,server_timestamp:e.operate_timeout,operate_id:e.operator_id,operate_name:e.operator_name,creator_id:e.creator_id};this.callPushDrawGraphicsCallback(e,n),r.Logger.info(a("gra.update"),JSON.stringify({type:i.GraphicType.Text,result:n,rs:e}))},e.prototype.onWhiteBoardCanvasImageUpdate=function(e){var t=e.pos_x,o=e.pos_y,n=e.point_begin,s=e.point_end,d={_graphic_id:e.graphic_id+"",graphic_id:h(e.graphic_id)+"",data:{x:n.x+t,y:n.y+o,ex:s.x+t,ey:s.y+o,url:e.path},x:t,y:o,initX:n.x,initY:n.y,zorder:e.zorder,path:e.path,type:i.GraphicType.Image,finished:e.is_finished,progress:e.progress,is_operate_finish:e.is_operate_finished,server_timestamp:e.operate_timeout,operate_id:e.operator_id,operate_name:e.operator_name,creator_id:e.creator_id};this.callPushDrawGraphicsCallback(e,d),r.Logger.info(a("gra.update"),JSON.stringify({type:i.GraphicType.Image,result:d,rs:e}))},e.prototype.onGraphicUpdate=function(e,t){var o=e===i.GraphicType.Laser?[t.point.x,t.point.y]:[t.point_begin.x,t.point_begin.y,t.point_end.x,t.point_end.y],n=t.pos_x,s=t.pos_y;e==i.GraphicType.Laser&&this.isClearDone&&(o[0]=-100,o[1]=-100,this.isClearDone=!1);var d={_graphic_id:t.graphic_id+"",graphic_id:h(t.graphic_id)+"",data:o,x:n,y:s,zorder:t.zorder,type:e,color:t.graphic_color,size:t.graphic_size,is_operate_finish:t.is_operate_finished,server_timestamp:t.operate_timeout,operate_id:t.operator_id,operate_name:t.operator_name,creator_id:t.creator_id};this.callPushDrawGraphicsCallback(t,d),r.Logger.info(a("gra.update"),JSON.stringify({type:e,result:d,rs:t}))},e.prototype.registerWhiteBoardEventCallBack=function(){var e=this;this.zegoClient.onEventHandler("onWhiteBoardCreate",(function(t){var o=t.error_code,i=(t.seq,t.whiteboard_model),n=e.zegoClient.whiteboardModelGetId({whiteboard_model:i});e.callCreateModCallBack(o,"",n),r.Logger.info(a("mod.create"),JSON.stringify({result:n,rs:t}))})),this.zegoClient.onEventHandler("onWhiteBoardAdded",(function(t){var o=e.getModInfo(t.whiteboard_model);o.action=1,o.mod_id=o.whiteboardID,e.eventHandler.onPushSetMod({resBody:{action_list:[o]}}),r.Logger.info(a("mod.added"),JSON.stringify({result:o,rs:t}))})),this.zegoClient.onEventHandler("onWhiteBoardDestroy",(function(t){r.Logger.info(a("mod.destroy"),JSON.stringify(t)),e.eventHandler.onDestroyMod({resBody:{code:t.error_code,message:"",mod_id:t.whiteboard_id+""}})})),this.zegoClient.onEventHandler("onWhiteBoardRemoved",(function(t){r.Logger.info(a("mod.removed"),JSON.stringify(t)),e.eventHandler.onPushSetMod({resBody:{action_list:[{action:2,mod_id:t.whiteboard_id+""}]}})})),this.zegoClient.onEventHandler("onWhiteBoardCanvasClear",(function(t){r.Logger.info(a("gra.clear"),JSON.stringify(t)),e.isClearDone=!0,e.eventHandler.onPushClearGraphics({resBody:{code:0,message:"ok",mod_id:t.whiteboard_id+""}})})),this.zegoClient.onEventHandler("onWhiteBoardGetList",(function(t){t.seq;for(var o=t.error_code,i=t.whiteboard_model_list,n=[],s=0;s<i.length;++s){var d=e.getModInfo(i[s].whiteboard_model);n.push(d)}var h={resBody:{code:o,message:"",mod_list:n}};e.eventHandler.onGetModList(h),r.Logger.info(a("mod.list"),JSON.stringify({result:n,rs:t}))})),this.zegoClient.onEventHandler("onWhiteBoardScrollCanvas",(function(t){e.eventHandler.onSendScroll(t)})),this.zegoClient.onEventHandler("onWhiteBoardCanvasScrolled",(function(t){e.eventHandler.onPushScrolled(t)})),this.zegoClient.onEventHandler("onWhiteBoardScaleCanvas",(function(t){e.eventHandler.onSendScale(t)})),this.zegoClient.onEventHandler("onWhiteBoardCanvasScaled",(function(t){e.eventHandler.onPushScaled(t)})),this.zegoClient.onEventHandler("onWhiteBoardCanvasItemDeleted",(function(t){var o={resBody:{del_graphic_id_list:[h(t.graphic_id)],mod_id:t.whiteboard_id+""}};e.eventHandler.onPushDrawGraphics(o),r.Logger.info(a("gra.deleted"),JSON.stringify({result:o.resBody,rs:t}))})),this.zegoClient.onEventHandler("onWhiteBoardAppendH5ExtraCallback2",(function(t){r.Logger.info(a("mod.append_h5extra"),JSON.stringify(t));var o={resBody:{code:t.error_code,mod_id:t.whiteboard_id+""}};0!==t.error_code&&t.extra&&t.extra.includes("H5_record")&&(o.resBody.oldExtra=t.extra),e.eventHandler.onAppendH5Extra(o)})),this.zegoClient.onEventHandler("onWhiteBoardH5ExtraAppendedNotify",(function(t){r.Logger.info(a("mod.update_h5extra"),JSON.stringify(t));var o={resBody:{extra:t.extra,mod_id:t.whiteboard_id+""}};e.eventHandler.onPushH5Extra(o)})),this.zegoClient.onEventHandler("onWhiteBoardUploadFile",(function(t){r.Logger.info(a("mod.update_file"),JSON.stringify(t));var o={resBody:{code:t.error_code,finish:t.finish,rate:t.rate,url:t.url,file_id:t.file_id,hash:t.hash,seq:t.seq}};e.eventHandler["onUploadFile"+t.seq](o)})),this.zegoClient.onEventHandler("onWhiteBoardCanvasBackgroundUpdate",(function(t){r.Logger.info(a("mod.update_background"),JSON.stringify(t));var o={url:t.path,hash:t.hash,fit_mode:t.fit_mode},n={graphic_id:h(t.graphic_id)+"",type:i.GraphicType.BgImage,x:t.pos_x,y:t.pos_y,zorder:t.zorder,data:o};e.callPushDrawGraphicsCallback(t,n)})),this.zegoClient.onEventHandler("onWhiteBoardCanvasPathUpdate",this.onWhiteBoardCanvasPathUpdate.bind(this)),this.zegoClient.onEventHandler("onWhiteBoardCanvasTextUpdate",this.onWhiteBoardCanvasTextUpdate.bind(this)),this.zegoClient.onEventHandler("onWhiteBoardCanvasImageUpdate",this.onWhiteBoardCanvasImageUpdate.bind(this));[{key:"wb",value:"onWhiteBoardAuthChangeNotify"},{key:"graphic",value:"onWhiteBoardGraphicAuthChangeNotify"}].forEach((function(t){e.zegoClient.onEventHandler(t.value,(function(o){r.Logger.info(a("mod."+t.value),JSON.stringify(o));var i={auth:o.auth&&JSON.parse(o.auth),type:t.key};e.eventHandler.onUserAuthUpdate(i)}))})),[{key:"Line",value:i.GraphicType.Line},{key:"Rect",value:i.GraphicType.Rect},{key:"Ellipse",value:i.GraphicType.Ellipse},{key:"Laser",value:i.GraphicType.Laser}].forEach((function(t){var o=t.key,i=t.value;e.zegoClient.onEventHandler("onWhiteBoardCanvas"+o+"Update",e.onGraphicUpdate.bind(e,i))}))},e}();t.ZegoAdapter=l},function(e,t,o){"use strict";o.r(t),o.d(t,"v1",(function(){return u})),o.d(t,"v3",(function(){return x})),o.d(t,"v4",(function(){return I})),o.d(t,"v5",(function(){return S}));var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16);function a(){if(!i)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}for(var n=[],s=0;s<256;++s)n[s]=(s+256).toString(16).substr(1);var d,h,c=function(e,t){var o=t||0,i=n;return[i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]]].join("")},l=0,p=0;var u=function(e,t,o){var i=t&&o||0,r=t||[],n=(e=e||{}).node||d,s=void 0!==e.clockseq?e.clockseq:h;if(null==n||null==s){var u=e.random||(e.rng||a)();null==n&&(n=d=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==s&&(s=h=16383&(u[6]<<8|u[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:p+1,v=g-l+(f-p)/1e4;if(v<0&&void 0===e.clockseq&&(s=s+1&16383),(v<0||g>l)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=g,p=f,h=s;var m=(1e4*(268435455&(g+=122192928e5))+f)%4294967296;r[i++]=m>>>24&255,r[i++]=m>>>16&255,r[i++]=m>>>8&255,r[i++]=255&m;var b=g/4294967296*1e4&268435455;r[i++]=b>>>8&255,r[i++]=255&b,r[i++]=b>>>24&15|16,r[i++]=b>>>16&255,r[i++]=s>>>8|128,r[i++]=255&s;for(var y=0;y<6;++y)r[i+y]=n[y];return t||c(r)};var g=function(e,t,o){var i=function(e,i,r,a){var n=r&&a||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),o=0;o<e.length;o++)t[o]=e.charCodeAt(o);return t}(e)),"string"==typeof i&&(i=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(i)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(i)||16!==i.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var s=o(i.concat(e));if(s[6]=15&s[6]|t,s[8]=63&s[8]|128,r)for(var d=0;d<16;++d)r[n+d]=s[d];return r||c(s)};try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i};function f(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function v(e,t,o,i,r,a){return f((n=f(f(t,e),f(i,a)))<<(s=r)|n>>>32-s,o);var n,s}function m(e,t,o,i,r,a,n){return v(t&o|~t&i,e,t,r,a,n)}function b(e,t,o,i,r,a,n){return v(t&i|o&~i,e,t,r,a,n)}function y(e,t,o,i,r,a,n){return v(t^o^i,e,t,r,a,n)}function w(e,t,o,i,r,a,n){return v(o^(t|~i),e,t,r,a,n)}var x=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var o=0;o<t.length;o++)e[o]=t.charCodeAt(o)}return function(e){var t,o,i,r=[],a=32*e.length;for(t=0;t<a;t+=8)o=e[t>>5]>>>t%32&255,i=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16),r.push(i);return r}(function(e,t){var o,i,r,a,n;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var s=1732584193,d=-271733879,h=-1732584194,c=271733878;for(o=0;o<e.length;o+=16)i=s,r=d,a=h,n=c,s=m(s,d,h,c,e[o],7,-680876936),c=m(c,s,d,h,e[o+1],12,-389564586),h=m(h,c,s,d,e[o+2],17,606105819),d=m(d,h,c,s,e[o+3],22,-1044525330),s=m(s,d,h,c,e[o+4],7,-176418897),c=m(c,s,d,h,e[o+5],12,1200080426),h=m(h,c,s,d,e[o+6],17,-1473231341),d=m(d,h,c,s,e[o+7],22,-45705983),s=m(s,d,h,c,e[o+8],7,1770035416),c=m(c,s,d,h,e[o+9],12,-1958414417),h=m(h,c,s,d,e[o+10],17,-42063),d=m(d,h,c,s,e[o+11],22,-1990404162),s=m(s,d,h,c,e[o+12],7,1804603682),c=m(c,s,d,h,e[o+13],12,-40341101),h=m(h,c,s,d,e[o+14],17,-1502002290),d=m(d,h,c,s,e[o+15],22,1236535329),s=b(s,d,h,c,e[o+1],5,-165796510),c=b(c,s,d,h,e[o+6],9,-1069501632),h=b(h,c,s,d,e[o+11],14,643717713),d=b(d,h,c,s,e[o],20,-373897302),s=b(s,d,h,c,e[o+5],5,-701558691),c=b(c,s,d,h,e[o+10],9,38016083),h=b(h,c,s,d,e[o+15],14,-660478335),d=b(d,h,c,s,e[o+4],20,-405537848),s=b(s,d,h,c,e[o+9],5,568446438),c=b(c,s,d,h,e[o+14],9,-1019803690),h=b(h,c,s,d,e[o+3],14,-187363961),d=b(d,h,c,s,e[o+8],20,1163531501),s=b(s,d,h,c,e[o+13],5,-1444681467),c=b(c,s,d,h,e[o+2],9,-51403784),h=b(h,c,s,d,e[o+7],14,1735328473),d=b(d,h,c,s,e[o+12],20,-1926607734),s=y(s,d,h,c,e[o+5],4,-378558),c=y(c,s,d,h,e[o+8],11,-2022574463),h=y(h,c,s,d,e[o+11],16,1839030562),d=y(d,h,c,s,e[o+14],23,-35309556),s=y(s,d,h,c,e[o+1],4,-1530992060),c=y(c,s,d,h,e[o+4],11,1272893353),h=y(h,c,s,d,e[o+7],16,-155497632),d=y(d,h,c,s,e[o+10],23,-1094730640),s=y(s,d,h,c,e[o+13],4,681279174),c=y(c,s,d,h,e[o],11,-358537222),h=y(h,c,s,d,e[o+3],16,-722521979),d=y(d,h,c,s,e[o+6],23,76029189),s=y(s,d,h,c,e[o+9],4,-640364487),c=y(c,s,d,h,e[o+12],11,-421815835),h=y(h,c,s,d,e[o+15],16,530742520),d=y(d,h,c,s,e[o+2],23,-995338651),s=w(s,d,h,c,e[o],6,-198630844),c=w(c,s,d,h,e[o+7],10,1126891415),h=w(h,c,s,d,e[o+14],15,-1416354905),d=w(d,h,c,s,e[o+5],21,-57434055),s=w(s,d,h,c,e[o+12],6,1700485571),c=w(c,s,d,h,e[o+3],10,-1894986606),h=w(h,c,s,d,e[o+10],15,-1051523),d=w(d,h,c,s,e[o+1],21,-2054922799),s=w(s,d,h,c,e[o+8],6,1873313359),c=w(c,s,d,h,e[o+15],10,-30611744),h=w(h,c,s,d,e[o+6],15,-1560198380),d=w(d,h,c,s,e[o+13],21,1309151649),s=w(s,d,h,c,e[o+4],6,-145523070),c=w(c,s,d,h,e[o+11],10,-1120210379),h=w(h,c,s,d,e[o+2],15,718787259),d=w(d,h,c,s,e[o+9],21,-343485551),s=f(s,i),d=f(d,r),h=f(h,a),c=f(c,n);return[s,d,h,c]}(function(e){var t,o=[];for(o[(e.length>>2)-1]=void 0,t=0;t<o.length;t+=1)o[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)o[t>>5]|=(255&e[t/8])<<t%32;return o}(e),8*e.length))}));var I=function(e,t,o){var i=t&&o||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var n=0;n<16;++n)t[i+n]=r[n];return t||c(r)};function E(e,t,o,i){switch(e){case 0:return t&o^~t&i;case 1:return t^o^i;case 2:return t&o^t&i^o&i;case 3:return t^o^i}}function T(e,t){return e<<t|e>>>32-t}var S=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=new Array(i.length);for(var r=0;r<i.length;r++)e[r]=i.charCodeAt(r)}e.push(128);var a=e.length/4+2,n=Math.ceil(a/16),s=new Array(n);for(r=0;r<n;r++){s[r]=new Array(16);for(var d=0;d<16;d++)s[r][d]=e[64*r+4*d]<<24|e[64*r+4*d+1]<<16|e[64*r+4*d+2]<<8|e[64*r+4*d+3]}for(s[n-1][14]=8*(e.length-1)/Math.pow(2,32),s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=8*(e.length-1)&4294967295,r=0;r<n;r++){for(var h=new Array(80),c=0;c<16;c++)h[c]=s[r][c];for(c=16;c<80;c++)h[c]=T(h[c-3]^h[c-8]^h[c-14]^h[c-16],1);var l=o[0],p=o[1],u=o[2],g=o[3],f=o[4];for(c=0;c<80;c++){var v=Math.floor(c/20),m=T(l,5)+E(v,p,u,g)+f+t[v]+h[c]>>>0;f=g,g=u,u=T(p,30)>>>0,p=l,l=m}o[0]=o[0]+l>>>0,o[1]=o[1]+p>>>0,o[2]=o[2]+u>>>0,o[3]=o[3]+g>>>0,o[4]=o[4]+f>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}))}]));